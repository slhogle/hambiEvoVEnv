<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Shane Hogle">
<meta name="dcterms.date" content="2025-03-25">

<title>Jensen-Shannon divergence of communities – hambiEvoVEnv</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../../">
<script src="../../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../../site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../../site_libs/bootstrap/bootstrap-1f23bf93a17969024013c136d185e5ce.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="../../../../site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="../../../../site_libs/pagedtable-1.1/js/pagedtable.js"></script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../../R/strep_only/communities/amplicon_sp_counts/01_format_rbec_tab.html">Community composition workflow</a></li><li class="breadcrumb-item"><a href="../../../../R/strep_only/communities/amplicon_sp_counts/05_JSD_analysis.html">5) Community JSD divergences</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../../../">hambiEvoVEnv</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Community densities workflow</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../R/strep_only/communities/cell_density/01_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1) Process and plot densities</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Community composition workflow</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../R/strep_only/communities/amplicon_sp_counts/01_format_rbec_tab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1) Amplicon data wrangling</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../R/strep_only/communities/amplicon_sp_counts/02_composition_plotting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2) Community composition barplot</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../R/strep_only/communities/amplicon_sp_counts/03_ordination_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3) Community ordination</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../R/strep_only/communities/amplicon_sp_counts/04_diversity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">4) Community diversity</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../R/strep_only/communities/amplicon_sp_counts/05_JSD_analysis.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">5) Community JSD divergences</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Clones workflow</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../R/strep_only/monocultures/clone_phenotyping/01_growth_curve_qc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1) Inspect/Smooth curves</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../R/strep_only/monocultures/clone_phenotyping/02_growthrate_auc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2) Summarize curves</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../R/strep_only/monocultures/clone_phenotyping/03_growth_summary_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3) Analysis and plot</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#setup" id="toc-setup" class="nav-link active" data-scroll-target="#setup"><span class="header-section-number">1</span> Setup</a></li>
  <li><a href="#read" id="toc-read" class="nav-link" data-scroll-target="#read"><span class="header-section-number">2</span> Read</a></li>
  <li><a href="#formatting" id="toc-formatting" class="nav-link" data-scroll-target="#formatting"><span class="header-section-number">3</span> Formatting</a></li>
  <li><a href="#distances-between-communities" id="toc-distances-between-communities" class="nav-link" data-scroll-target="#distances-between-communities"><span class="header-section-number">4</span> Distances between communities</a>
  <ul class="collapse">
  <li><a href="#jsd-to-ancestor-no-samples-filtered" id="toc-jsd-to-ancestor-no-samples-filtered" class="nav-link" data-scroll-target="#jsd-to-ancestor-no-samples-filtered"><span class="header-section-number">4.1</span> JSD to ancestor no samples filtered</a></li>
  <li><a href="#jsd-to-ancestor---idiosyncratic-samples-filtered" id="toc-jsd-to-ancestor---idiosyncratic-samples-filtered" class="nav-link" data-scroll-target="#jsd-to-ancestor---idiosyncratic-samples-filtered"><span class="header-section-number">4.2</span> JSD to ancestor - idiosyncratic samples filtered</a></li>
  <li><a href="#jsd-to-ysk-founder-community" id="toc-jsd-to-ysk-founder-community" class="nav-link" data-scroll-target="#jsd-to-ysk-founder-community"><span class="header-section-number">4.3</span> JSD to YSK founder community</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../../R/strep_only/communities/amplicon_sp_counts/01_format_rbec_tab.html">Community composition workflow</a></li><li class="breadcrumb-item"><a href="../../../../R/strep_only/communities/amplicon_sp_counts/05_JSD_analysis.html">5) Community JSD divergences</a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Jensen-Shannon divergence of communities</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
<p class="subtitle lead">Community composition workflow</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Shane Hogle </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">March 25, 2025</p>
    </div>
  </div>
  
    
  </div>
  
<div>
  <div class="abstract">
    <div class="block-title">Abstract</div>
    This notebook compares the response of different YSK evolutionary histories to the ancestral community in each experimental measurement environment using pairwise Jensen-Shannon divergences.
  </div>
</div>


</header>


<section id="setup" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Setup</h1>
<p>Loads required libraries and sets global variables</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show/hide code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">library</span>(here)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="fu">library</span>(fs)</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="fu">library</span>(scales)</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="fu">library</span>(philentropy)</span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="fu">source</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"R"</span>, <span class="st">"utils_generic.R"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="read" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Read</h1>
<p>Read species abundance data (16S v3 amplicon counts) and do some light formatting of metadata</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show/hide code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>sptable <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_tsv</span>(here<span class="sc">::</span><span class="fu">here</span>(data_sp, <span class="st">"species_counts_md.tsv"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2-2"><a href="#cb2-2"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">transfer =</span> day<span class="sc">/</span><span class="dv">7</span>)</span>
<span id="cb2-3"><a href="#cb2-3"></a></span>
<span id="cb2-4"><a href="#cb2-4"></a>counts_f <span class="ot">&lt;-</span> sptable <span class="sc">%&gt;%</span> </span>
<span id="cb2-5"><a href="#cb2-5"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(sample) <span class="sc">%&gt;%</span> </span>
<span id="cb2-6"><a href="#cb2-6"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">f=</span>count_correct<span class="sc">/</span><span class="fu">sum</span>(count_correct)) <span class="sc">%&gt;%</span> </span>
<span id="cb2-7"><a href="#cb2-7"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb2-8"><a href="#cb2-8"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">measure_env_short =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(measure_env <span class="sc">==</span> <span class="st">"bact"</span> <span class="sc">~</span> <span class="st">"Meas: B"</span>,</span>
<span id="cb2-9"><a href="#cb2-9"></a>                                       measure_env <span class="sc">==</span> <span class="st">"bact_strep"</span> <span class="sc">~</span> <span class="st">"Meas: BS"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2-10"><a href="#cb2-10"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">home_env_short =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb2-11"><a href="#cb2-11"></a>                                    evolution_env <span class="sc">==</span> <span class="st">"anc"</span> <span class="sc">~</span> <span class="st">"Home: Anc"</span>,</span>
<span id="cb2-12"><a href="#cb2-12"></a>                                    evolution_env <span class="sc">==</span> <span class="st">"bact"</span> <span class="sc">~</span> <span class="st">"Home: B"</span>,</span>
<span id="cb2-13"><a href="#cb2-13"></a>                                    evolution_env <span class="sc">==</span> <span class="st">"bact_strep"</span> <span class="sc">~</span> <span class="st">"Home: BS"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2-14"><a href="#cb2-14"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb2-15"><a href="#cb2-15"></a>    <span class="at">measure_env_short =</span> <span class="fu">factor</span>(measure_env_short, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Meas: B"</span>, <span class="st">"Meas: BS"</span>)),</span>
<span id="cb2-16"><a href="#cb2-16"></a>    <span class="at">home_env_short =</span> <span class="fu">factor</span>(home_env_short, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Home: Anc"</span>, <span class="st">"Home: B"</span>, <span class="st">"Home: BS"</span>)),</span>
<span id="cb2-17"><a href="#cb2-17"></a>         <span class="at">day =</span> <span class="fu">factor</span>(day),</span>
<span id="cb2-18"><a href="#cb2-18"></a>         <span class="at">replicate =</span> <span class="fu">factor</span>(replicate),</span>
<span id="cb2-19"><a href="#cb2-19"></a>         <span class="at">strainID =</span> <span class="fu">factor</span>(strainID, <span class="at">levels =</span> <span class="fu">names</span>(hambi_colors)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="formatting" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Formatting</h1>
<p>Some light formatting to subset data into distinct tibbles for later plotting</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show/hide code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># these are communities of a (supposedly) known composition. Can be used with metacal</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>pos_ctrl_samples <span class="ot">&lt;-</span> counts_f <span class="sc">%&gt;%</span> </span>
<span id="cb3-3"><a href="#cb3-3"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">str_detect</span>(sample, <span class="st">"pos_ctrl"</span>))</span>
<span id="cb3-4"><a href="#cb3-4"></a></span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="co"># these are samples taken directly from YSK and represent the composition of the communities used to start the experiment</span></span>
<span id="cb3-6"><a href="#cb3-6"></a>t0_samples <span class="ot">&lt;-</span> counts_f <span class="sc">%&gt;%</span> </span>
<span id="cb3-7"><a href="#cb3-7"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">str_detect</span>(sample, <span class="st">"pos_ctrl"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb3-8"><a href="#cb3-8"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(day <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb3-9"><a href="#cb3-9"></a></span>
<span id="cb3-10"><a href="#cb3-10"></a><span class="co"># only samples from the experiment</span></span>
<span id="cb3-11"><a href="#cb3-11"></a>counts_f_experiment <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">anti_join</span>(counts_f, pos_ctrl_samples) <span class="sc">%&gt;%</span> </span>
<span id="cb3-12"><a href="#cb3-12"></a>  dplyr<span class="sc">::</span><span class="fu">anti_join</span>(., t0_samples) <span class="sc">%&gt;%</span> </span>
<span id="cb3-13"><a href="#cb3-13"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb3-14"><a href="#cb3-14"></a>    <span class="at">measure_env_short =</span> <span class="fu">factor</span>(measure_env_short, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Meas: B"</span>, <span class="st">"Meas: BS"</span>)),</span>
<span id="cb3-15"><a href="#cb3-15"></a>    <span class="at">home_env_short =</span> <span class="fu">factor</span>(home_env_short, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Home: Anc"</span>, <span class="st">"Home: B"</span>, <span class="st">"Home: BS"</span>)),</span>
<span id="cb3-16"><a href="#cb3-16"></a>         <span class="at">day =</span> <span class="fu">factor</span>(day),</span>
<span id="cb3-17"><a href="#cb3-17"></a>         <span class="at">replicate =</span> <span class="fu">factor</span>(replicate),</span>
<span id="cb3-18"><a href="#cb3-18"></a>         <span class="at">strainID =</span> <span class="fu">factor</span>(strainID, <span class="at">levels =</span> <span class="fu">names</span>(hambi_colors)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="distances-between-communities" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Distances between communities</h1>
<p>The Jensen–Shannon divergence (JSD) is a symmetrized and smoothed version of the <a href="https://en.wikipedia.org/wiki/Kullback%E2%80%93Leibler_divergence" title="Kullback–Leibler divergence">Kullback–Leibler divergence</a>. It is defined as:</p>
<p><span id="eq-JSD"><span class="math display">\[
D_{\text{JS}}(P \parallel Q) = \frac{1}{2} D_{\text{KL}}(P \parallel M) + \frac{1}{2} D_{\text{KL}}(Q \parallel M)
\tag{1}\]</span></span></p>
<p><span id="eq-avg_dist"><span class="math display">\[
M = \frac{1}{2}(P + Q)
\tag{2}\]</span></span></p>
<p>Here, (<span class="math inline">\(D_{\text{KL}}\)</span>) denotes the Kullback-Leibler divergence which is defined as:</p>
<p><span id="eq-KLD"><span class="math display">\[
D_{KL}(P \parallel Q) = \sum_{x \in \mathcal{X}} P(x) \log \frac{P(x)}{Q(x)}
\tag{3}\]</span></span></p>
<section id="jsd-to-ancestor-no-samples-filtered" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="jsd-to-ancestor-no-samples-filtered"><span class="header-section-number">4.1</span> JSD to ancestor no samples filtered</h2>
<div class="cell">
<details open="" class="code-fold">
<summary>Show/hide code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="co"># create a matrix of species frequencies</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>prob_mat <span class="ot">&lt;-</span> counts_f <span class="sc">%&gt;%</span> </span>
<span id="cb4-3"><a href="#cb4-3"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(sample, strainID, f) <span class="sc">%&gt;%</span> </span>
<span id="cb4-4"><a href="#cb4-4"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> strainID, <span class="at">values_from =</span> f) <span class="sc">%&gt;%</span> </span>
<span id="cb4-5"><a href="#cb4-5"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="at">var =</span> <span class="st">"sample"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb4-6"><a href="#cb4-6"></a>  <span class="fu">as.matrix</span>()</span>
<span id="cb4-7"><a href="#cb4-7"></a></span>
<span id="cb4-8"><a href="#cb4-8"></a><span class="co"># calculate JSD between all pairs using philentropy::JSD</span></span>
<span id="cb4-9"><a href="#cb4-9"></a>jsd_mat <span class="ot">&lt;-</span> philentropy<span class="sc">::</span><span class="fu">JSD</span>(prob_mat)</span>
<span id="cb4-10"><a href="#cb4-10"></a></span>
<span id="cb4-11"><a href="#cb4-11"></a><span class="co"># get nonredundant pairings</span></span>
<span id="cb4-12"><a href="#cb4-12"></a>ind <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">upper.tri</span>(jsd_mat, <span class="at">diag =</span> <span class="cn">TRUE</span>), <span class="at">arr.ind =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-13"><a href="#cb4-13"></a>nn <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">rownames</span>(prob_mat), <span class="fu">rownames</span>(prob_mat))</span>
<span id="cb4-14"><a href="#cb4-14"></a>jsddf <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">sample.x =</span> nn[[<span class="dv">1</span>]][ind[, <span class="dv">1</span>]],</span>
<span id="cb4-15"><a href="#cb4-15"></a>           <span class="at">sample.y =</span> nn[[<span class="dv">2</span>]][ind[, <span class="dv">2</span>]],</span>
<span id="cb4-16"><a href="#cb4-16"></a>           <span class="at">jsd =</span> jsd_mat[ind])</span>
<span id="cb4-17"><a href="#cb4-17"></a></span>
<span id="cb4-18"><a href="#cb4-18"></a><span class="co"># metadata for joining</span></span>
<span id="cb4-19"><a href="#cb4-19"></a>md <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">distinct</span>(counts_f, sample, replicate, transfer, measure_env_short, home_env_short)</span>
<span id="cb4-20"><a href="#cb4-20"></a></span>
<span id="cb4-21"><a href="#cb4-21"></a><span class="co"># convert to long format</span></span>
<span id="cb4-22"><a href="#cb4-22"></a>jsddf_long_md <span class="ot">&lt;-</span> jsddf <span class="sc">%&gt;%</span> </span>
<span id="cb4-23"><a href="#cb4-23"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(md, <span class="at">by =</span> <span class="fu">join_by</span>(sample.x<span class="sc">==</span>sample)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-24"><a href="#cb4-24"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(md, <span class="at">by =</span> <span class="fu">join_by</span>(sample.y<span class="sc">==</span>sample))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Filter JSD pairs to only those that are relative to ancestral community in each measurement environment. Also calculate mean and boostrapped 95CI using HMisc</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show/hide code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>jsddf_long_md_filt <span class="ot">&lt;-</span> jsddf_long_md <span class="sc">%&gt;%</span> </span>
<span id="cb5-2"><a href="#cb5-2"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(measure_env_short.x <span class="sc">==</span> measure_env_short.y) <span class="sc">%&gt;%</span> </span>
<span id="cb5-3"><a href="#cb5-3"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(home_env_short.x <span class="sc">!=</span> home_env_short.y <span class="sc">&amp;</span> transfer.x <span class="sc">==</span> transfer.y <span class="sc">&amp;</span> home_env_short.x <span class="sc">==</span> <span class="st">"Home: Anc"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb5-4"><a href="#cb5-4"></a>  dplyr<span class="sc">::</span><span class="fu">summarize</span>(ggplot2<span class="sc">::</span><span class="fu">mean_cl_boot</span>(jsd), <span class="at">.by=</span><span class="fu">c</span>(transfer.y, home_env_short.y, measure_env_short.y)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-5"><a href="#cb5-5"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">home_env_short.y =</span> <span class="fu">factor</span>(home_env_short.y))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Hmmm…. not sure what exactly this is telling, but I am calculating the within home/measurement divergence as some kind of variability baseline.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show/hide code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>intrarepvar <span class="ot">&lt;-</span> jsddf_long_md <span class="sc">%&gt;%</span> </span>
<span id="cb6-2"><a href="#cb6-2"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(measure_env_short.x <span class="sc">==</span> measure_env_short.y <span class="sc">&amp;</span> home_env_short.x <span class="sc">==</span> home_env_short.y <span class="sc">&amp;</span> transfer.x <span class="sc">==</span> transfer.y) <span class="sc">%&gt;%</span> </span>
<span id="cb6-3"><a href="#cb6-3"></a>  dplyr<span class="sc">::</span><span class="fu">summarize</span>(ggplot2<span class="sc">::</span><span class="fu">mean_cl_boot</span>(jsd), <span class="at">.by=</span><span class="fu">c</span>(transfer.y, home_env_short.y, measure_env_short.y)) <span class="sc">%&gt;%</span> </span>
<span id="cb6-4"><a href="#cb6-4"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(home_env_short.y <span class="sc">!=</span> <span class="st">"Home: Anc"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-5"><a href="#cb6-5"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">home_env_short.y =</span> <span class="fu">factor</span>(home_env_short.y))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Make plot of JSD to ancestral communities in each condition and save in raster/vector format</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show/hide code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>plot_jsd <span class="ot">&lt;-</span> <span class="cf">function</span>(intra_df, df){</span>
<span id="cb7-2"><a href="#cb7-2"></a>  mycols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Home: B"</span> <span class="ot">=</span> <span class="st">"#66c2a5"</span>, <span class="st">"Home: BS"</span> <span class="ot">=</span> <span class="st">"#fc8d62"</span>)</span>
<span id="cb7-3"><a href="#cb7-3"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb7-4"><a href="#cb7-4"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_ribbon</span>(<span class="at">data =</span> intra_df, </span>
<span id="cb7-5"><a href="#cb7-5"></a>              <span class="fu">aes</span>(<span class="at">x =</span> transfer.y, <span class="at">ymin =</span> ymin, <span class="at">ymax=</span>ymax, <span class="at">fill =</span> home_env_short.y), <span class="at">alpha=</span><span class="fl">0.25</span>) <span class="sc">+</span> </span>
<span id="cb7-6"><a href="#cb7-6"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_line</span>(<span class="at">data =</span> intra_df, </span>
<span id="cb7-7"><a href="#cb7-7"></a>            <span class="fu">aes</span>(<span class="at">x =</span> transfer.y, <span class="at">y=</span>y, <span class="at">color =</span> home_env_short.y), <span class="at">alpha=</span><span class="fl">0.5</span>, <span class="at">lty=</span><span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb7-8"><a href="#cb7-8"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">data =</span> df, <span class="fu">aes</span>(<span class="at">x =</span> transfer.y, <span class="at">y =</span> y, <span class="at">group =</span> home_env_short.y, <span class="at">color =</span> home_env_short.y)) <span class="sc">+</span></span>
<span id="cb7-9"><a href="#cb7-9"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_linerange</span>(<span class="at">data =</span> df, </span>
<span id="cb7-10"><a href="#cb7-10"></a>                 <span class="fu">aes</span>(<span class="at">x =</span> transfer.y, <span class="at">ymin =</span> ymin, <span class="at">ymax =</span> ymax, <span class="at">color =</span> home_env_short.y)) <span class="sc">+</span> </span>
<span id="cb7-11"><a href="#cb7-11"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_line</span>(<span class="at">data=</span> df, </span>
<span id="cb7-12"><a href="#cb7-12"></a>            <span class="fu">aes</span>(<span class="at">x =</span> transfer.y, <span class="at">y =</span> y, <span class="at">group =</span> home_env_short.y, <span class="at">color =</span> home_env_short.y)) <span class="sc">+</span> </span>
<span id="cb7-13"><a href="#cb7-13"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(measure_env_short.y <span class="sc">~</span> home_env_short.y, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span> </span>
<span id="cb7-14"><a href="#cb7-14"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Growth Cycles"</span>, <span class="at">y =</span> <span class="st">"Jensen-Shannon Divergence relative to ancestor"</span>, <span class="at">color =</span> <span class="st">"Home</span><span class="sc">\n</span><span class="st">Environment"</span>, <span class="at">fill =</span> <span class="st">"Home</span><span class="sc">\n</span><span class="st">Environment"</span>) <span class="sc">+</span></span>
<span id="cb7-15"><a href="#cb7-15"></a>  <span class="co">#ggplot2::scale_y_sqrt() +</span></span>
<span id="cb7-16"><a href="#cb7-16"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">8</span>, <span class="dv">12</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">3.5</span>, <span class="fl">12.5</span>)) <span class="sc">+</span></span>
<span id="cb7-17"><a href="#cb7-17"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_color_manual</span>(<span class="at">values=</span>mycols) <span class="sc">+</span></span>
<span id="cb7-18"><a href="#cb7-18"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_manual</span>(<span class="at">values=</span>mycols) <span class="sc">+</span></span>
<span id="cb7-19"><a href="#cb7-19"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb7-20"><a href="#cb7-20"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb7-21"><a href="#cb7-21"></a>    <span class="co">#panel.grid.major = element_blank(),</span></span>
<span id="cb7-22"><a href="#cb7-22"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb7-23"><a href="#cb7-23"></a>    <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb7-24"><a href="#cb7-24"></a>    <span class="at">strip.placement =</span> <span class="st">'outside'</span>,</span>
<span id="cb7-25"><a href="#cb7-25"></a>    <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb7-26"><a href="#cb7-26"></a>  )</span>
<span id="cb7-27"><a href="#cb7-27"></a>}</span>
<span id="cb7-28"><a href="#cb7-28"></a></span>
<span id="cb7-29"><a href="#cb7-29"></a>pjsd <span class="ot">&lt;-</span> <span class="fu">plot_jsd</span>(intrarepvar, jsddf_long_md_filt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Show/hide code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(</span>
<span id="cb8-2"><a href="#cb8-2"></a>  here<span class="sc">::</span><span class="fu">here</span>(figs, <span class="st">"community_jsd_to_anc.svg"</span>),</span>
<span id="cb8-3"><a href="#cb8-3"></a>  pjsd,</span>
<span id="cb8-4"><a href="#cb8-4"></a>  <span class="at">width =</span> <span class="dv">8</span>,</span>
<span id="cb8-5"><a href="#cb8-5"></a>  <span class="at">height =</span> <span class="dv">6</span>,</span>
<span id="cb8-6"><a href="#cb8-6"></a>  <span class="at">units =</span> <span class="st">"in"</span>,</span>
<span id="cb8-7"><a href="#cb8-7"></a>  <span class="at">device =</span> <span class="st">"svg"</span></span>
<span id="cb8-8"><a href="#cb8-8"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="fig-03" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-03-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="05_JSD_analysis_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-03-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Mean <span class="math inline">\(\pm\)</span> 95% CI of the pairwise Jensen-Shannon Divergence between the ancestral/clonal community composition (<strong>?@fig-01</strong> C) and the community composition in YSK Home environments (Home, grid columns) for each measurement environment (Meas, grid rows) in the transplantation experiment (see also <strong>?@fig-01</strong> D). Mean divergences are nested within Growth Cycles (horizontal axis) where one growth cycle is 7 days. Dashed lines indicate mean and ribbons indicate 95% CI for the mean within-condition Jensen-Shannon Divergence and is meant as an indicator of replicate variability within each Home/Measurement treatment combination.
</figcaption>
</figure>
</div>
</section>
<section id="jsd-to-ancestor---idiosyncratic-samples-filtered" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="jsd-to-ancestor---idiosyncratic-samples-filtered"><span class="header-section-number">4.2</span> JSD to ancestor - idiosyncratic samples filtered</h2>
<p>In <strong>?@fig-01</strong> is it clear that some of the replicates in samples from YSK have a very different composition from the others. This is likely due to rapid resistance evolution of HAMBI 1972 in those particular replicates from YSK (will need to verify with the metagenomes). HAMBI_1972 is normally very sensitive to STR. The idea in this section is to repeat the JSD to ancestor analysis but exclude these idiosyncratic replicates - A and F from YSK BS, C and E from YSK B. We want to make sure that the trends in JSD relative to the ancestral community is not being driven primarily by these outlier replicates.</p>
<p>Filter JSD pairs to only those that are relative to ancestral community in each measurement environment. Also exclude the replicates mentioned above. Finally calculate mean and boostrapped 95CI using HMisc.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show/hide code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>jsddf_long_md_filt2 <span class="ot">&lt;-</span> jsddf_long_md <span class="sc">%&gt;%</span> </span>
<span id="cb9-2"><a href="#cb9-2"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(measure_env_short.x <span class="sc">==</span> measure_env_short.y) <span class="sc">%&gt;%</span> </span>
<span id="cb9-3"><a href="#cb9-3"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(home_env_short.x <span class="sc">!=</span> home_env_short.y <span class="sc">&amp;</span> transfer.x <span class="sc">==</span> transfer.y <span class="sc">&amp;</span> home_env_short.x <span class="sc">==</span> <span class="st">"Home: Anc"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb9-4"><a href="#cb9-4"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span>((measure_env_short.x <span class="sc">==</span> <span class="st">"Meas: BS"</span> <span class="sc">&amp;</span> home_env_short.y <span class="sc">==</span> <span class="st">"Home: BS"</span>) <span class="sc">&amp;</span> <span class="fu">str_detect</span>(replicate.x, <span class="st">"A|F"</span>) <span class="sc">|</span> <span class="fu">str_detect</span>(replicate.y, <span class="st">"A|F"</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb9-5"><a href="#cb9-5"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span>((measure_env_short.x <span class="sc">==</span> <span class="st">"Meas: BS"</span> <span class="sc">&amp;</span> home_env_short.y <span class="sc">==</span> <span class="st">"Home: B"</span>) <span class="sc">&amp;</span> <span class="fu">str_detect</span>(replicate.x, <span class="st">"C|E"</span>) <span class="sc">|</span> <span class="fu">str_detect</span>(replicate.y, <span class="st">"C|E"</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb9-6"><a href="#cb9-6"></a>  dplyr<span class="sc">::</span><span class="fu">summarize</span>(ggplot2<span class="sc">::</span><span class="fu">mean_cl_boot</span>(jsd), <span class="at">.by=</span><span class="fu">c</span>(transfer.y, home_env_short.y, measure_env_short.y)) <span class="sc">%&gt;%</span> </span>
<span id="cb9-7"><a href="#cb9-7"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">home_env_short.y =</span> <span class="fu">factor</span>(home_env_short.y))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Calculating the within home/measurement divergence as some kind of variability baseline but with the outlier replicates excluded.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show/hide code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>intrarepvar2 <span class="ot">&lt;-</span> jsddf_long_md <span class="sc">%&gt;%</span> </span>
<span id="cb10-2"><a href="#cb10-2"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(measure_env_short.x <span class="sc">==</span> measure_env_short.y <span class="sc">&amp;</span> home_env_short.x <span class="sc">==</span> home_env_short.y <span class="sc">&amp;</span> transfer.x <span class="sc">==</span> transfer.y) <span class="sc">%&gt;%</span> </span>
<span id="cb10-3"><a href="#cb10-3"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span>((measure_env_short.x <span class="sc">==</span> <span class="st">"Meas: BS"</span> <span class="sc">&amp;</span> home_env_short.y <span class="sc">==</span> <span class="st">"Home: BS"</span>) <span class="sc">&amp;</span> <span class="fu">str_detect</span>(replicate.x, <span class="st">"A|F"</span>) <span class="sc">|</span> <span class="fu">str_detect</span>(replicate.y, <span class="st">"A|F"</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb10-4"><a href="#cb10-4"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span>((measure_env_short.x <span class="sc">==</span> <span class="st">"Meas: BS"</span> <span class="sc">&amp;</span> home_env_short.y <span class="sc">==</span> <span class="st">"Home: B"</span>) <span class="sc">&amp;</span> <span class="fu">str_detect</span>(replicate.x, <span class="st">"C|E"</span>) <span class="sc">|</span> <span class="fu">str_detect</span>(replicate.y, <span class="st">"C|E"</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb10-5"><a href="#cb10-5"></a>  dplyr<span class="sc">::</span><span class="fu">summarize</span>(ggplot2<span class="sc">::</span><span class="fu">mean_cl_boot</span>(jsd), <span class="at">.by=</span><span class="fu">c</span>(transfer.y, home_env_short.y, measure_env_short.y)) <span class="sc">%&gt;%</span> </span>
<span id="cb10-6"><a href="#cb10-6"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(home_env_short.y <span class="sc">!=</span> <span class="st">"Home: Anc"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb10-7"><a href="#cb10-7"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">home_env_short.y =</span> <span class="fu">factor</span>(home_env_short.y))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Make plot of JSD to ancestral communities in each condition and save in raster/vector format</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show/hide code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>pjsd2 <span class="ot">&lt;-</span> <span class="fu">plot_jsd</span>(intrarepvar2, jsddf_long_md_filt2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="fig-04" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-04-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="05_JSD_analysis_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-04-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Same as in <a href="#fig-03" class="quarto-xref">Figure&nbsp;1</a> but with excluding the idiosyncratic replicates A and F from YSK Strep and C and E from YSK Bact.
</figcaption>
</figure>
</div>
<p>So here it does appear that the trends still hold but now the JSD to ancestor always exceeds variation within each environment/evolutionary history.</p>
</section>
<section id="jsd-to-ysk-founder-community" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="jsd-to-ysk-founder-community"><span class="header-section-number">4.3</span> JSD to YSK founder community</h2>
<p>Here I just wanted to check how each community with an YSK evolutionary history compares to the original YSK source material</p>
<details open="" class="code-fold">
<summary>Show/hide code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>jsddf_long_md <span class="sc">%&gt;%</span> </span>
<span id="cb12-2"><a href="#cb12-2"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(transfer.x <span class="sc">==</span> <span class="dv">0</span> <span class="sc">|</span> transfer.y <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb12-3"><a href="#cb12-3"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(home_env_short.x <span class="sc">!=</span> <span class="st">"Home: Anc"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb12-4"><a href="#cb12-4"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">str_remove</span>(measure_env_short.y, <span class="st">"Meas: "</span>) <span class="sc">==</span> <span class="fu">str_remove</span>(home_env_short.y, <span class="st">"Home: "</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb12-5"><a href="#cb12-5"></a>  <span class="co">#dplyr::filter(home_env_short.x == home_env_short.y) %&gt;% </span></span>
<span id="cb12-6"><a href="#cb12-6"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(replicate.x <span class="sc">==</span> replicate.y) <span class="sc">%&gt;%</span> </span>
<span id="cb12-7"><a href="#cb12-7"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span> replicate.x, <span class="at">y =</span> jsd)) <span class="sc">+</span></span>
<span id="cb12-8"><a href="#cb12-8"></a>  <span class="fu">geom_jitter</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(transfer.y)), <span class="at">height =</span> <span class="fl">0.01</span>, <span class="at">width =</span> <span class="fl">0.1</span>) <span class="sc">+</span> </span>
<span id="cb12-9"><a href="#cb12-9"></a>  <span class="fu">facet_grid</span>(measure_env_short.y <span class="sc">~</span> home_env_short.x) <span class="sc">+</span></span>
<span id="cb12-10"><a href="#cb12-10"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Replicate microcosm"</span>, <span class="at">y =</span> <span class="st">"Jensen-Shannon Divergence relative YSK source"</span>, <span class="at">color =</span> <span class="st">"Transfer"</span>) <span class="sc">+</span></span>
<span id="cb12-11"><a href="#cb12-11"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb12-12"><a href="#cb12-12"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb12-13"><a href="#cb12-13"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb12-14"><a href="#cb12-14"></a>    <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb12-15"><a href="#cb12-15"></a>    <span class="at">strip.placement =</span> <span class="st">'outside'</span>,</span>
<span id="cb12-16"><a href="#cb12-16"></a>    <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb12-17"><a href="#cb12-17"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-05" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-05-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="05_JSD_analysis_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-05-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: JSD relative to 58 week YSK source material (nested by replicate) for each treatment/YSK history and transfer in the main experiment. Excludes sames that were inoculated with the ancestral community.
</figcaption>
</figure>
</div>


<!-- -->

</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb13" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb13-1"><a href="#cb13-1"></a><span class="co">---</span></span>
<span id="cb13-2"><a href="#cb13-2"></a><span class="an">title:</span><span class="co"> "Jensen-Shannon divergence of communities"</span></span>
<span id="cb13-3"><a href="#cb13-3"></a><span class="an">subtitle:</span><span class="co"> "Community composition workflow"</span></span>
<span id="cb13-4"><a href="#cb13-4"></a><span class="an">author:</span><span class="co"> "Shane Hogle"</span></span>
<span id="cb13-5"><a href="#cb13-5"></a><span class="an">date:</span><span class="co"> today</span></span>
<span id="cb13-6"><a href="#cb13-6"></a><span class="an">abstract:</span><span class="co"> "This notebook compares the response of different YSK evolutionary histories to the ancestral community in each experimental measurement environment using pairwise Jensen-Shannon divergences."</span></span>
<span id="cb13-7"><a href="#cb13-7"></a><span class="co">---</span></span>
<span id="cb13-8"><a href="#cb13-8"></a></span>
<span id="cb13-9"><a href="#cb13-9"></a><span class="fu"># Setup</span></span>
<span id="cb13-10"><a href="#cb13-10"></a></span>
<span id="cb13-11"><a href="#cb13-11"></a>Loads required libraries and sets global variables</span>
<span id="cb13-12"><a href="#cb13-12"></a></span>
<span id="cb13-15"><a href="#cb13-15"></a><span class="in">```{r}</span></span>
<span id="cb13-16"><a href="#cb13-16"></a><span class="co">#| output: false</span></span>
<span id="cb13-17"><a href="#cb13-17"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb13-18"><a href="#cb13-18"></a><span class="fu">library</span>(here)</span>
<span id="cb13-19"><a href="#cb13-19"></a><span class="fu">library</span>(fs)</span>
<span id="cb13-20"><a href="#cb13-20"></a><span class="fu">library</span>(scales)</span>
<span id="cb13-21"><a href="#cb13-21"></a><span class="fu">library</span>(philentropy)</span>
<span id="cb13-22"><a href="#cb13-22"></a><span class="fu">source</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"R"</span>, <span class="st">"utils_generic.R"</span>))</span>
<span id="cb13-23"><a href="#cb13-23"></a><span class="in">```</span></span>
<span id="cb13-24"><a href="#cb13-24"></a></span>
<span id="cb13-25"><a href="#cb13-25"></a><span class="fu"># Read</span></span>
<span id="cb13-26"><a href="#cb13-26"></a></span>
<span id="cb13-27"><a href="#cb13-27"></a>Read species abundance data (16S v3 amplicon counts) and do some light formatting of metadata </span>
<span id="cb13-28"><a href="#cb13-28"></a></span>
<span id="cb13-31"><a href="#cb13-31"></a><span class="in">```{r}</span></span>
<span id="cb13-32"><a href="#cb13-32"></a><span class="co">#| output: false</span></span>
<span id="cb13-33"><a href="#cb13-33"></a><span class="co">#| warning: false</span></span>
<span id="cb13-34"><a href="#cb13-34"></a>sptable <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_tsv</span>(here<span class="sc">::</span><span class="fu">here</span>(data_sp, <span class="st">"species_counts_md.tsv"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb13-35"><a href="#cb13-35"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">transfer =</span> day<span class="sc">/</span><span class="dv">7</span>)</span>
<span id="cb13-36"><a href="#cb13-36"></a></span>
<span id="cb13-37"><a href="#cb13-37"></a>counts_f <span class="ot">&lt;-</span> sptable <span class="sc">%&gt;%</span> </span>
<span id="cb13-38"><a href="#cb13-38"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(sample) <span class="sc">%&gt;%</span> </span>
<span id="cb13-39"><a href="#cb13-39"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">f=</span>count_correct<span class="sc">/</span><span class="fu">sum</span>(count_correct)) <span class="sc">%&gt;%</span> </span>
<span id="cb13-40"><a href="#cb13-40"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb13-41"><a href="#cb13-41"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">measure_env_short =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(measure_env <span class="sc">==</span> <span class="st">"bact"</span> <span class="sc">~</span> <span class="st">"Meas: B"</span>,</span>
<span id="cb13-42"><a href="#cb13-42"></a>                                       measure_env <span class="sc">==</span> <span class="st">"bact_strep"</span> <span class="sc">~</span> <span class="st">"Meas: BS"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb13-43"><a href="#cb13-43"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">home_env_short =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb13-44"><a href="#cb13-44"></a>                                    evolution_env <span class="sc">==</span> <span class="st">"anc"</span> <span class="sc">~</span> <span class="st">"Home: Anc"</span>,</span>
<span id="cb13-45"><a href="#cb13-45"></a>                                    evolution_env <span class="sc">==</span> <span class="st">"bact"</span> <span class="sc">~</span> <span class="st">"Home: B"</span>,</span>
<span id="cb13-46"><a href="#cb13-46"></a>                                    evolution_env <span class="sc">==</span> <span class="st">"bact_strep"</span> <span class="sc">~</span> <span class="st">"Home: BS"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb13-47"><a href="#cb13-47"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb13-48"><a href="#cb13-48"></a>    <span class="at">measure_env_short =</span> <span class="fu">factor</span>(measure_env_short, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Meas: B"</span>, <span class="st">"Meas: BS"</span>)),</span>
<span id="cb13-49"><a href="#cb13-49"></a>    <span class="at">home_env_short =</span> <span class="fu">factor</span>(home_env_short, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Home: Anc"</span>, <span class="st">"Home: B"</span>, <span class="st">"Home: BS"</span>)),</span>
<span id="cb13-50"><a href="#cb13-50"></a>         <span class="at">day =</span> <span class="fu">factor</span>(day),</span>
<span id="cb13-51"><a href="#cb13-51"></a>         <span class="at">replicate =</span> <span class="fu">factor</span>(replicate),</span>
<span id="cb13-52"><a href="#cb13-52"></a>         <span class="at">strainID =</span> <span class="fu">factor</span>(strainID, <span class="at">levels =</span> <span class="fu">names</span>(hambi_colors)))</span>
<span id="cb13-53"><a href="#cb13-53"></a><span class="in">```</span></span>
<span id="cb13-54"><a href="#cb13-54"></a></span>
<span id="cb13-55"><a href="#cb13-55"></a><span class="fu"># Formatting</span></span>
<span id="cb13-56"><a href="#cb13-56"></a></span>
<span id="cb13-57"><a href="#cb13-57"></a>Some light formatting to subset data into distinct tibbles for later plotting</span>
<span id="cb13-58"><a href="#cb13-58"></a></span>
<span id="cb13-61"><a href="#cb13-61"></a><span class="in">```{r}</span></span>
<span id="cb13-62"><a href="#cb13-62"></a><span class="co">#| output: false</span></span>
<span id="cb13-63"><a href="#cb13-63"></a><span class="co">#| warning: false</span></span>
<span id="cb13-64"><a href="#cb13-64"></a><span class="co"># these are communities of a (supposedly) known composition. Can be used with metacal</span></span>
<span id="cb13-65"><a href="#cb13-65"></a>pos_ctrl_samples <span class="ot">&lt;-</span> counts_f <span class="sc">%&gt;%</span> </span>
<span id="cb13-66"><a href="#cb13-66"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">str_detect</span>(sample, <span class="st">"pos_ctrl"</span>))</span>
<span id="cb13-67"><a href="#cb13-67"></a></span>
<span id="cb13-68"><a href="#cb13-68"></a><span class="co"># these are samples taken directly from YSK and represent the composition of the communities used to start the experiment</span></span>
<span id="cb13-69"><a href="#cb13-69"></a>t0_samples <span class="ot">&lt;-</span> counts_f <span class="sc">%&gt;%</span> </span>
<span id="cb13-70"><a href="#cb13-70"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">str_detect</span>(sample, <span class="st">"pos_ctrl"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb13-71"><a href="#cb13-71"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(day <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb13-72"><a href="#cb13-72"></a></span>
<span id="cb13-73"><a href="#cb13-73"></a><span class="co"># only samples from the experiment</span></span>
<span id="cb13-74"><a href="#cb13-74"></a>counts_f_experiment <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">anti_join</span>(counts_f, pos_ctrl_samples) <span class="sc">%&gt;%</span> </span>
<span id="cb13-75"><a href="#cb13-75"></a>  dplyr<span class="sc">::</span><span class="fu">anti_join</span>(., t0_samples) <span class="sc">%&gt;%</span> </span>
<span id="cb13-76"><a href="#cb13-76"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb13-77"><a href="#cb13-77"></a>    <span class="at">measure_env_short =</span> <span class="fu">factor</span>(measure_env_short, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Meas: B"</span>, <span class="st">"Meas: BS"</span>)),</span>
<span id="cb13-78"><a href="#cb13-78"></a>    <span class="at">home_env_short =</span> <span class="fu">factor</span>(home_env_short, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Home: Anc"</span>, <span class="st">"Home: B"</span>, <span class="st">"Home: BS"</span>)),</span>
<span id="cb13-79"><a href="#cb13-79"></a>         <span class="at">day =</span> <span class="fu">factor</span>(day),</span>
<span id="cb13-80"><a href="#cb13-80"></a>         <span class="at">replicate =</span> <span class="fu">factor</span>(replicate),</span>
<span id="cb13-81"><a href="#cb13-81"></a>         <span class="at">strainID =</span> <span class="fu">factor</span>(strainID, <span class="at">levels =</span> <span class="fu">names</span>(hambi_colors)))</span>
<span id="cb13-82"><a href="#cb13-82"></a><span class="in">```</span></span>
<span id="cb13-83"><a href="#cb13-83"></a></span>
<span id="cb13-84"><a href="#cb13-84"></a></span>
<span id="cb13-85"><a href="#cb13-85"></a><span class="fu"># Distances between communities</span></span>
<span id="cb13-86"><a href="#cb13-86"></a></span>
<span id="cb13-87"><a href="#cb13-87"></a>The Jensen–Shannon divergence (JSD) is a symmetrized and smoothed version of the <span class="co">[</span><span class="ot">Kullback–Leibler divergence</span><span class="co">](https://en.wikipedia.org/wiki/Kullback%E2%80%93Leibler_divergence "Kullback–Leibler divergence")</span>. It is defined as:</span>
<span id="cb13-88"><a href="#cb13-88"></a></span>
<span id="cb13-89"><a href="#cb13-89"></a>$$</span>
<span id="cb13-90"><a href="#cb13-90"></a>D_{\text{JS}}(P \parallel Q) = \frac{1}{2} D_{\text{KL}}(P \parallel M) + \frac{1}{2} D_{\text{KL}}(Q \parallel M)</span>
<span id="cb13-91"><a href="#cb13-91"></a>$$ {#eq-JSD}</span>
<span id="cb13-92"><a href="#cb13-92"></a></span>
<span id="cb13-93"><a href="#cb13-93"></a>$$</span>
<span id="cb13-94"><a href="#cb13-94"></a>M = \frac{1}{2}(P + Q)</span>
<span id="cb13-95"><a href="#cb13-95"></a>$$ {#eq-avg_dist}</span>
<span id="cb13-96"><a href="#cb13-96"></a></span>
<span id="cb13-97"><a href="#cb13-97"></a>Here, ($D_{\text{KL}}$) denotes the Kullback-Leibler divergence which is defined as:</span>
<span id="cb13-98"><a href="#cb13-98"></a></span>
<span id="cb13-99"><a href="#cb13-99"></a>$$</span>
<span id="cb13-100"><a href="#cb13-100"></a>D_{KL}(P \parallel Q) = \sum_{x \in \mathcal{X}} P(x) \log \frac{P(x)}{Q(x)}</span>
<span id="cb13-101"><a href="#cb13-101"></a>$$ {#eq-KLD}</span>
<span id="cb13-102"><a href="#cb13-102"></a></span>
<span id="cb13-103"><a href="#cb13-103"></a><span class="fu">## JSD to ancestor no samples filtered</span></span>
<span id="cb13-104"><a href="#cb13-104"></a></span>
<span id="cb13-107"><a href="#cb13-107"></a><span class="in">```{r}</span></span>
<span id="cb13-108"><a href="#cb13-108"></a><span class="co">#| output: false</span></span>
<span id="cb13-109"><a href="#cb13-109"></a><span class="co">#| warning: false</span></span>
<span id="cb13-110"><a href="#cb13-110"></a><span class="co"># create a matrix of species frequencies</span></span>
<span id="cb13-111"><a href="#cb13-111"></a>prob_mat <span class="ot">&lt;-</span> counts_f <span class="sc">%&gt;%</span> </span>
<span id="cb13-112"><a href="#cb13-112"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(sample, strainID, f) <span class="sc">%&gt;%</span> </span>
<span id="cb13-113"><a href="#cb13-113"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> strainID, <span class="at">values_from =</span> f) <span class="sc">%&gt;%</span> </span>
<span id="cb13-114"><a href="#cb13-114"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="at">var =</span> <span class="st">"sample"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb13-115"><a href="#cb13-115"></a>  <span class="fu">as.matrix</span>()</span>
<span id="cb13-116"><a href="#cb13-116"></a></span>
<span id="cb13-117"><a href="#cb13-117"></a><span class="co"># calculate JSD between all pairs using philentropy::JSD</span></span>
<span id="cb13-118"><a href="#cb13-118"></a>jsd_mat <span class="ot">&lt;-</span> philentropy<span class="sc">::</span><span class="fu">JSD</span>(prob_mat)</span>
<span id="cb13-119"><a href="#cb13-119"></a></span>
<span id="cb13-120"><a href="#cb13-120"></a><span class="co"># get nonredundant pairings</span></span>
<span id="cb13-121"><a href="#cb13-121"></a>ind <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">upper.tri</span>(jsd_mat, <span class="at">diag =</span> <span class="cn">TRUE</span>), <span class="at">arr.ind =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-122"><a href="#cb13-122"></a>nn <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">rownames</span>(prob_mat), <span class="fu">rownames</span>(prob_mat))</span>
<span id="cb13-123"><a href="#cb13-123"></a>jsddf <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">sample.x =</span> nn[[<span class="dv">1</span>]][ind[, <span class="dv">1</span>]],</span>
<span id="cb13-124"><a href="#cb13-124"></a>           <span class="at">sample.y =</span> nn[[<span class="dv">2</span>]][ind[, <span class="dv">2</span>]],</span>
<span id="cb13-125"><a href="#cb13-125"></a>           <span class="at">jsd =</span> jsd_mat[ind])</span>
<span id="cb13-126"><a href="#cb13-126"></a></span>
<span id="cb13-127"><a href="#cb13-127"></a><span class="co"># metadata for joining</span></span>
<span id="cb13-128"><a href="#cb13-128"></a>md <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">distinct</span>(counts_f, sample, replicate, transfer, measure_env_short, home_env_short)</span>
<span id="cb13-129"><a href="#cb13-129"></a></span>
<span id="cb13-130"><a href="#cb13-130"></a><span class="co"># convert to long format</span></span>
<span id="cb13-131"><a href="#cb13-131"></a>jsddf_long_md <span class="ot">&lt;-</span> jsddf <span class="sc">%&gt;%</span> </span>
<span id="cb13-132"><a href="#cb13-132"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(md, <span class="at">by =</span> <span class="fu">join_by</span>(sample.x<span class="sc">==</span>sample)) <span class="sc">%&gt;%</span> </span>
<span id="cb13-133"><a href="#cb13-133"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(md, <span class="at">by =</span> <span class="fu">join_by</span>(sample.y<span class="sc">==</span>sample))</span>
<span id="cb13-134"><a href="#cb13-134"></a><span class="in">```</span></span>
<span id="cb13-135"><a href="#cb13-135"></a></span>
<span id="cb13-136"><a href="#cb13-136"></a>Filter JSD pairs to only those that are relative to ancestral community in each measurement environment. Also calculate mean and boostrapped 95CI using HMisc</span>
<span id="cb13-137"><a href="#cb13-137"></a></span>
<span id="cb13-140"><a href="#cb13-140"></a><span class="in">```{r}</span></span>
<span id="cb13-141"><a href="#cb13-141"></a><span class="co">#| output: false</span></span>
<span id="cb13-142"><a href="#cb13-142"></a><span class="co">#| warning: false</span></span>
<span id="cb13-143"><a href="#cb13-143"></a>jsddf_long_md_filt <span class="ot">&lt;-</span> jsddf_long_md <span class="sc">%&gt;%</span> </span>
<span id="cb13-144"><a href="#cb13-144"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(measure_env_short.x <span class="sc">==</span> measure_env_short.y) <span class="sc">%&gt;%</span> </span>
<span id="cb13-145"><a href="#cb13-145"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(home_env_short.x <span class="sc">!=</span> home_env_short.y <span class="sc">&amp;</span> transfer.x <span class="sc">==</span> transfer.y <span class="sc">&amp;</span> home_env_short.x <span class="sc">==</span> <span class="st">"Home: Anc"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb13-146"><a href="#cb13-146"></a>  dplyr<span class="sc">::</span><span class="fu">summarize</span>(ggplot2<span class="sc">::</span><span class="fu">mean_cl_boot</span>(jsd), <span class="at">.by=</span><span class="fu">c</span>(transfer.y, home_env_short.y, measure_env_short.y)) <span class="sc">%&gt;%</span> </span>
<span id="cb13-147"><a href="#cb13-147"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">home_env_short.y =</span> <span class="fu">factor</span>(home_env_short.y))</span>
<span id="cb13-148"><a href="#cb13-148"></a><span class="in">```</span></span>
<span id="cb13-149"><a href="#cb13-149"></a></span>
<span id="cb13-150"><a href="#cb13-150"></a>Hmmm.... not sure what exactly this is telling, but I am calculating the within home/measurement divergence as some kind of variability baseline.</span>
<span id="cb13-151"><a href="#cb13-151"></a></span>
<span id="cb13-154"><a href="#cb13-154"></a><span class="in">```{r}</span></span>
<span id="cb13-155"><a href="#cb13-155"></a>intrarepvar <span class="ot">&lt;-</span> jsddf_long_md <span class="sc">%&gt;%</span> </span>
<span id="cb13-156"><a href="#cb13-156"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(measure_env_short.x <span class="sc">==</span> measure_env_short.y <span class="sc">&amp;</span> home_env_short.x <span class="sc">==</span> home_env_short.y <span class="sc">&amp;</span> transfer.x <span class="sc">==</span> transfer.y) <span class="sc">%&gt;%</span> </span>
<span id="cb13-157"><a href="#cb13-157"></a>  dplyr<span class="sc">::</span><span class="fu">summarize</span>(ggplot2<span class="sc">::</span><span class="fu">mean_cl_boot</span>(jsd), <span class="at">.by=</span><span class="fu">c</span>(transfer.y, home_env_short.y, measure_env_short.y)) <span class="sc">%&gt;%</span> </span>
<span id="cb13-158"><a href="#cb13-158"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(home_env_short.y <span class="sc">!=</span> <span class="st">"Home: Anc"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb13-159"><a href="#cb13-159"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">home_env_short.y =</span> <span class="fu">factor</span>(home_env_short.y))</span>
<span id="cb13-160"><a href="#cb13-160"></a><span class="in">```</span></span>
<span id="cb13-161"><a href="#cb13-161"></a></span>
<span id="cb13-162"><a href="#cb13-162"></a>Make plot of JSD to ancestral communities in each condition and save in raster/vector format</span>
<span id="cb13-163"><a href="#cb13-163"></a></span>
<span id="cb13-166"><a href="#cb13-166"></a><span class="in">```{r}</span></span>
<span id="cb13-167"><a href="#cb13-167"></a>plot_jsd <span class="ot">&lt;-</span> <span class="cf">function</span>(intra_df, df){</span>
<span id="cb13-168"><a href="#cb13-168"></a>  mycols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Home: B"</span> <span class="ot">=</span> <span class="st">"#66c2a5"</span>, <span class="st">"Home: BS"</span> <span class="ot">=</span> <span class="st">"#fc8d62"</span>)</span>
<span id="cb13-169"><a href="#cb13-169"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb13-170"><a href="#cb13-170"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_ribbon</span>(<span class="at">data =</span> intra_df, </span>
<span id="cb13-171"><a href="#cb13-171"></a>              <span class="fu">aes</span>(<span class="at">x =</span> transfer.y, <span class="at">ymin =</span> ymin, <span class="at">ymax=</span>ymax, <span class="at">fill =</span> home_env_short.y), <span class="at">alpha=</span><span class="fl">0.25</span>) <span class="sc">+</span> </span>
<span id="cb13-172"><a href="#cb13-172"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_line</span>(<span class="at">data =</span> intra_df, </span>
<span id="cb13-173"><a href="#cb13-173"></a>            <span class="fu">aes</span>(<span class="at">x =</span> transfer.y, <span class="at">y=</span>y, <span class="at">color =</span> home_env_short.y), <span class="at">alpha=</span><span class="fl">0.5</span>, <span class="at">lty=</span><span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb13-174"><a href="#cb13-174"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">data =</span> df, <span class="fu">aes</span>(<span class="at">x =</span> transfer.y, <span class="at">y =</span> y, <span class="at">group =</span> home_env_short.y, <span class="at">color =</span> home_env_short.y)) <span class="sc">+</span></span>
<span id="cb13-175"><a href="#cb13-175"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_linerange</span>(<span class="at">data =</span> df, </span>
<span id="cb13-176"><a href="#cb13-176"></a>                 <span class="fu">aes</span>(<span class="at">x =</span> transfer.y, <span class="at">ymin =</span> ymin, <span class="at">ymax =</span> ymax, <span class="at">color =</span> home_env_short.y)) <span class="sc">+</span> </span>
<span id="cb13-177"><a href="#cb13-177"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_line</span>(<span class="at">data=</span> df, </span>
<span id="cb13-178"><a href="#cb13-178"></a>            <span class="fu">aes</span>(<span class="at">x =</span> transfer.y, <span class="at">y =</span> y, <span class="at">group =</span> home_env_short.y, <span class="at">color =</span> home_env_short.y)) <span class="sc">+</span> </span>
<span id="cb13-179"><a href="#cb13-179"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(measure_env_short.y <span class="sc">~</span> home_env_short.y, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span> </span>
<span id="cb13-180"><a href="#cb13-180"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Growth Cycles"</span>, <span class="at">y =</span> <span class="st">"Jensen-Shannon Divergence relative to ancestor"</span>, <span class="at">color =</span> <span class="st">"Home</span><span class="sc">\n</span><span class="st">Environment"</span>, <span class="at">fill =</span> <span class="st">"Home</span><span class="sc">\n</span><span class="st">Environment"</span>) <span class="sc">+</span></span>
<span id="cb13-181"><a href="#cb13-181"></a>  <span class="co">#ggplot2::scale_y_sqrt() +</span></span>
<span id="cb13-182"><a href="#cb13-182"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">8</span>, <span class="dv">12</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">3.5</span>, <span class="fl">12.5</span>)) <span class="sc">+</span></span>
<span id="cb13-183"><a href="#cb13-183"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_color_manual</span>(<span class="at">values=</span>mycols) <span class="sc">+</span></span>
<span id="cb13-184"><a href="#cb13-184"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_manual</span>(<span class="at">values=</span>mycols) <span class="sc">+</span></span>
<span id="cb13-185"><a href="#cb13-185"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb13-186"><a href="#cb13-186"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb13-187"><a href="#cb13-187"></a>    <span class="co">#panel.grid.major = element_blank(),</span></span>
<span id="cb13-188"><a href="#cb13-188"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb13-189"><a href="#cb13-189"></a>    <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb13-190"><a href="#cb13-190"></a>    <span class="at">strip.placement =</span> <span class="st">'outside'</span>,</span>
<span id="cb13-191"><a href="#cb13-191"></a>    <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb13-192"><a href="#cb13-192"></a>  )</span>
<span id="cb13-193"><a href="#cb13-193"></a>}</span>
<span id="cb13-194"><a href="#cb13-194"></a></span>
<span id="cb13-195"><a href="#cb13-195"></a>pjsd <span class="ot">&lt;-</span> <span class="fu">plot_jsd</span>(intrarepvar, jsddf_long_md_filt)</span>
<span id="cb13-196"><a href="#cb13-196"></a><span class="in">```</span></span>
<span id="cb13-197"><a href="#cb13-197"></a></span>
<span id="cb13-200"><a href="#cb13-200"></a><span class="in">```{r}</span></span>
<span id="cb13-201"><a href="#cb13-201"></a><span class="co">#| warning: false</span></span>
<span id="cb13-202"><a href="#cb13-202"></a><span class="co">#| eval: false</span></span>
<span id="cb13-203"><a href="#cb13-203"></a>ggplot2<span class="sc">::</span><span class="fu">ggsave</span>(</span>
<span id="cb13-204"><a href="#cb13-204"></a>  here<span class="sc">::</span><span class="fu">here</span>(figs, <span class="st">"community_jsd_to_anc.svg"</span>),</span>
<span id="cb13-205"><a href="#cb13-205"></a>  pjsd,</span>
<span id="cb13-206"><a href="#cb13-206"></a>  <span class="at">width =</span> <span class="dv">8</span>,</span>
<span id="cb13-207"><a href="#cb13-207"></a>  <span class="at">height =</span> <span class="dv">6</span>,</span>
<span id="cb13-208"><a href="#cb13-208"></a>  <span class="at">units =</span> <span class="st">"in"</span>,</span>
<span id="cb13-209"><a href="#cb13-209"></a>  <span class="at">device =</span> <span class="st">"svg"</span></span>
<span id="cb13-210"><a href="#cb13-210"></a>)</span>
<span id="cb13-211"><a href="#cb13-211"></a><span class="in">```</span></span>
<span id="cb13-212"><a href="#cb13-212"></a></span>
<span id="cb13-213"><a href="#cb13-213"></a>::: {#fig-03}</span>
<span id="cb13-216"><a href="#cb13-216"></a><span class="in">```{r}</span></span>
<span id="cb13-217"><a href="#cb13-217"></a><span class="co">#| fig.width: 8</span></span>
<span id="cb13-218"><a href="#cb13-218"></a><span class="co">#| fig.height: 6</span></span>
<span id="cb13-219"><a href="#cb13-219"></a><span class="co">#| echo: false</span></span>
<span id="cb13-220"><a href="#cb13-220"></a><span class="co">#| warning: false</span></span>
<span id="cb13-221"><a href="#cb13-221"></a>pjsd</span>
<span id="cb13-222"><a href="#cb13-222"></a><span class="in">```</span></span>
<span id="cb13-223"><a href="#cb13-223"></a>Mean $\pm$ 95% CI of the pairwise Jensen-Shannon Divergence between the ancestral/clonal community composition (@fig-01 C) and the community composition in YSK Home environments (Home, grid columns) for each measurement environment (Meas, grid rows) in the transplantation experiment (see also @fig-01 D). Mean divergences are nested within Growth Cycles (horizontal axis) where one growth cycle is 7 days. Dashed lines indicate mean and ribbons indicate 95% CI for the mean within-condition Jensen-Shannon Divergence and is meant as an indicator of replicate variability within each Home/Measurement treatment combination.</span>
<span id="cb13-224"><a href="#cb13-224"></a>:::</span>
<span id="cb13-225"><a href="#cb13-225"></a></span>
<span id="cb13-226"><a href="#cb13-226"></a><span class="fu">## JSD to ancestor - idiosyncratic samples filtered </span></span>
<span id="cb13-227"><a href="#cb13-227"></a></span>
<span id="cb13-228"><a href="#cb13-228"></a>In @fig-01 is it clear that some of the replicates in samples from YSK have a very different composition from the others. This is likely due to rapid resistance evolution of HAMBI 1972 in those particular replicates from YSK (will need to verify with the metagenomes). HAMBI_1972 is normally very sensitive to STR. The idea in this section is to repeat the JSD to ancestor analysis but exclude these idiosyncratic replicates - A and F from YSK BS, C and E from YSK B. We want to make sure that the trends in JSD relative to the ancestral community is not being driven primarily by these outlier replicates.</span>
<span id="cb13-229"><a href="#cb13-229"></a></span>
<span id="cb13-230"><a href="#cb13-230"></a>Filter JSD pairs to only those that are relative to ancestral community in each measurement environment. Also exclude the replicates mentioned above. Finally calculate mean and boostrapped 95CI using HMisc.</span>
<span id="cb13-231"><a href="#cb13-231"></a></span>
<span id="cb13-234"><a href="#cb13-234"></a><span class="in">```{r}</span></span>
<span id="cb13-235"><a href="#cb13-235"></a><span class="co">#| output: false</span></span>
<span id="cb13-236"><a href="#cb13-236"></a><span class="co">#| warning: false</span></span>
<span id="cb13-237"><a href="#cb13-237"></a>jsddf_long_md_filt2 <span class="ot">&lt;-</span> jsddf_long_md <span class="sc">%&gt;%</span> </span>
<span id="cb13-238"><a href="#cb13-238"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(measure_env_short.x <span class="sc">==</span> measure_env_short.y) <span class="sc">%&gt;%</span> </span>
<span id="cb13-239"><a href="#cb13-239"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(home_env_short.x <span class="sc">!=</span> home_env_short.y <span class="sc">&amp;</span> transfer.x <span class="sc">==</span> transfer.y <span class="sc">&amp;</span> home_env_short.x <span class="sc">==</span> <span class="st">"Home: Anc"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb13-240"><a href="#cb13-240"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span>((measure_env_short.x <span class="sc">==</span> <span class="st">"Meas: BS"</span> <span class="sc">&amp;</span> home_env_short.y <span class="sc">==</span> <span class="st">"Home: BS"</span>) <span class="sc">&amp;</span> <span class="fu">str_detect</span>(replicate.x, <span class="st">"A|F"</span>) <span class="sc">|</span> <span class="fu">str_detect</span>(replicate.y, <span class="st">"A|F"</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb13-241"><a href="#cb13-241"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span>((measure_env_short.x <span class="sc">==</span> <span class="st">"Meas: BS"</span> <span class="sc">&amp;</span> home_env_short.y <span class="sc">==</span> <span class="st">"Home: B"</span>) <span class="sc">&amp;</span> <span class="fu">str_detect</span>(replicate.x, <span class="st">"C|E"</span>) <span class="sc">|</span> <span class="fu">str_detect</span>(replicate.y, <span class="st">"C|E"</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb13-242"><a href="#cb13-242"></a>  dplyr<span class="sc">::</span><span class="fu">summarize</span>(ggplot2<span class="sc">::</span><span class="fu">mean_cl_boot</span>(jsd), <span class="at">.by=</span><span class="fu">c</span>(transfer.y, home_env_short.y, measure_env_short.y)) <span class="sc">%&gt;%</span> </span>
<span id="cb13-243"><a href="#cb13-243"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">home_env_short.y =</span> <span class="fu">factor</span>(home_env_short.y))</span>
<span id="cb13-244"><a href="#cb13-244"></a>  </span>
<span id="cb13-245"><a href="#cb13-245"></a><span class="in">```</span></span>
<span id="cb13-246"><a href="#cb13-246"></a></span>
<span id="cb13-247"><a href="#cb13-247"></a>Calculating the within home/measurement divergence as some kind of variability baseline but with the outlier replicates excluded.</span>
<span id="cb13-248"><a href="#cb13-248"></a></span>
<span id="cb13-251"><a href="#cb13-251"></a><span class="in">```{r}</span></span>
<span id="cb13-252"><a href="#cb13-252"></a>intrarepvar2 <span class="ot">&lt;-</span> jsddf_long_md <span class="sc">%&gt;%</span> </span>
<span id="cb13-253"><a href="#cb13-253"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(measure_env_short.x <span class="sc">==</span> measure_env_short.y <span class="sc">&amp;</span> home_env_short.x <span class="sc">==</span> home_env_short.y <span class="sc">&amp;</span> transfer.x <span class="sc">==</span> transfer.y) <span class="sc">%&gt;%</span> </span>
<span id="cb13-254"><a href="#cb13-254"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span>((measure_env_short.x <span class="sc">==</span> <span class="st">"Meas: BS"</span> <span class="sc">&amp;</span> home_env_short.y <span class="sc">==</span> <span class="st">"Home: BS"</span>) <span class="sc">&amp;</span> <span class="fu">str_detect</span>(replicate.x, <span class="st">"A|F"</span>) <span class="sc">|</span> <span class="fu">str_detect</span>(replicate.y, <span class="st">"A|F"</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb13-255"><a href="#cb13-255"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span>((measure_env_short.x <span class="sc">==</span> <span class="st">"Meas: BS"</span> <span class="sc">&amp;</span> home_env_short.y <span class="sc">==</span> <span class="st">"Home: B"</span>) <span class="sc">&amp;</span> <span class="fu">str_detect</span>(replicate.x, <span class="st">"C|E"</span>) <span class="sc">|</span> <span class="fu">str_detect</span>(replicate.y, <span class="st">"C|E"</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb13-256"><a href="#cb13-256"></a>  dplyr<span class="sc">::</span><span class="fu">summarize</span>(ggplot2<span class="sc">::</span><span class="fu">mean_cl_boot</span>(jsd), <span class="at">.by=</span><span class="fu">c</span>(transfer.y, home_env_short.y, measure_env_short.y)) <span class="sc">%&gt;%</span> </span>
<span id="cb13-257"><a href="#cb13-257"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(home_env_short.y <span class="sc">!=</span> <span class="st">"Home: Anc"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb13-258"><a href="#cb13-258"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">home_env_short.y =</span> <span class="fu">factor</span>(home_env_short.y))</span>
<span id="cb13-259"><a href="#cb13-259"></a><span class="in">```</span></span>
<span id="cb13-260"><a href="#cb13-260"></a></span>
<span id="cb13-261"><a href="#cb13-261"></a>Make plot of JSD to ancestral communities in each condition and save in raster/vector format</span>
<span id="cb13-262"><a href="#cb13-262"></a></span>
<span id="cb13-265"><a href="#cb13-265"></a><span class="in">```{r}</span></span>
<span id="cb13-266"><a href="#cb13-266"></a>pjsd2 <span class="ot">&lt;-</span> <span class="fu">plot_jsd</span>(intrarepvar2, jsddf_long_md_filt2)</span>
<span id="cb13-267"><a href="#cb13-267"></a><span class="in">```</span></span>
<span id="cb13-268"><a href="#cb13-268"></a></span>
<span id="cb13-269"><a href="#cb13-269"></a>::: {#fig-04}</span>
<span id="cb13-272"><a href="#cb13-272"></a><span class="in">```{r}</span></span>
<span id="cb13-273"><a href="#cb13-273"></a><span class="co">#| fig.width: 8</span></span>
<span id="cb13-274"><a href="#cb13-274"></a><span class="co">#| fig.height: 6</span></span>
<span id="cb13-275"><a href="#cb13-275"></a><span class="co">#| echo: false</span></span>
<span id="cb13-276"><a href="#cb13-276"></a><span class="co">#| warning: false</span></span>
<span id="cb13-277"><a href="#cb13-277"></a>pjsd2</span>
<span id="cb13-278"><a href="#cb13-278"></a><span class="in">```</span></span>
<span id="cb13-279"><a href="#cb13-279"></a>Same as in @fig-03 but with excluding the idiosyncratic replicates A and F from YSK Strep and C and E from YSK Bact.</span>
<span id="cb13-280"><a href="#cb13-280"></a>:::</span>
<span id="cb13-281"><a href="#cb13-281"></a></span>
<span id="cb13-282"><a href="#cb13-282"></a>So here it does appear that the trends still hold but now the JSD to ancestor always exceeds variation within each environment/evolutionary history.</span>
<span id="cb13-283"><a href="#cb13-283"></a></span>
<span id="cb13-284"><a href="#cb13-284"></a><span class="fu">## JSD to YSK founder community</span></span>
<span id="cb13-285"><a href="#cb13-285"></a></span>
<span id="cb13-286"><a href="#cb13-286"></a>Here I just wanted to check how each community with an YSK evolutionary history compares to the original YSK source material</span>
<span id="cb13-287"><a href="#cb13-287"></a></span>
<span id="cb13-288"><a href="#cb13-288"></a>::: {#fig-05}</span>
<span id="cb13-291"><a href="#cb13-291"></a><span class="in">```{r}</span></span>
<span id="cb13-292"><a href="#cb13-292"></a><span class="co">#| fig.width: 8</span></span>
<span id="cb13-293"><a href="#cb13-293"></a><span class="co">#| fig.height: 6</span></span>
<span id="cb13-294"><a href="#cb13-294"></a><span class="co">#| warning: false</span></span>
<span id="cb13-295"><a href="#cb13-295"></a>jsddf_long_md <span class="sc">%&gt;%</span> </span>
<span id="cb13-296"><a href="#cb13-296"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(transfer.x <span class="sc">==</span> <span class="dv">0</span> <span class="sc">|</span> transfer.y <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb13-297"><a href="#cb13-297"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(home_env_short.x <span class="sc">!=</span> <span class="st">"Home: Anc"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb13-298"><a href="#cb13-298"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">str_remove</span>(measure_env_short.y, <span class="st">"Meas: "</span>) <span class="sc">==</span> <span class="fu">str_remove</span>(home_env_short.y, <span class="st">"Home: "</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb13-299"><a href="#cb13-299"></a>  <span class="co">#dplyr::filter(home_env_short.x == home_env_short.y) %&gt;% </span></span>
<span id="cb13-300"><a href="#cb13-300"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(replicate.x <span class="sc">==</span> replicate.y) <span class="sc">%&gt;%</span> </span>
<span id="cb13-301"><a href="#cb13-301"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span> replicate.x, <span class="at">y =</span> jsd)) <span class="sc">+</span></span>
<span id="cb13-302"><a href="#cb13-302"></a>  <span class="fu">geom_jitter</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(transfer.y)), <span class="at">height =</span> <span class="fl">0.01</span>, <span class="at">width =</span> <span class="fl">0.1</span>) <span class="sc">+</span> </span>
<span id="cb13-303"><a href="#cb13-303"></a>  <span class="fu">facet_grid</span>(measure_env_short.y <span class="sc">~</span> home_env_short.x) <span class="sc">+</span></span>
<span id="cb13-304"><a href="#cb13-304"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Replicate microcosm"</span>, <span class="at">y =</span> <span class="st">"Jensen-Shannon Divergence relative YSK source"</span>, <span class="at">color =</span> <span class="st">"Transfer"</span>) <span class="sc">+</span></span>
<span id="cb13-305"><a href="#cb13-305"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb13-306"><a href="#cb13-306"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb13-307"><a href="#cb13-307"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb13-308"><a href="#cb13-308"></a>    <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb13-309"><a href="#cb13-309"></a>    <span class="at">strip.placement =</span> <span class="st">'outside'</span>,</span>
<span id="cb13-310"><a href="#cb13-310"></a>    <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb13-311"><a href="#cb13-311"></a>  )</span>
<span id="cb13-312"><a href="#cb13-312"></a></span>
<span id="cb13-313"><a href="#cb13-313"></a><span class="in">```</span></span>
<span id="cb13-314"><a href="#cb13-314"></a>JSD relative to 58 week YSK source material (nested by replicate) for each treatment/YSK history and transfer in the main experiment. Excludes sames that were inoculated with the ancestral community.</span>
<span id="cb13-315"><a href="#cb13-315"></a>:::</span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>