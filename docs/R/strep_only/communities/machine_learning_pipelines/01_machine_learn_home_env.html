<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Shane Hogle">
<meta name="dcterms.date" content="2025-03-25">

<title>Machine learning evolutionary history from community structure – hambiEvoVEnv</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../../">
<script src="../../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../../site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../../site_libs/bootstrap/bootstrap-1f23bf93a17969024013c136d185e5ce.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="../../../../site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="../../../../site_libs/pagedtable-1.1/js/pagedtable.js"></script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">
      hambiEvoVEnv
      </li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../../../">hambiEvoVEnv</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Community densities workflow</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../R/strep_only/communities/cell_density/01_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1) Process and plot densities</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Community composition workflow</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../R/strep_only/communities/amplicon_sp_counts/01_format_rbec_tab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1) Amplicon data wrangling</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../R/strep_only/communities/amplicon_sp_counts/02_composition_plotting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2) Community composition barplot</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../R/strep_only/communities/amplicon_sp_counts/03_ordination_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3) Community ordination</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../R/strep_only/communities/amplicon_sp_counts/04_diversity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">4) Community diversity</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../R/strep_only/communities/amplicon_sp_counts/05_JSD_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">5) Community JSD divergences</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Clones workflow</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../R/strep_only/monocultures/clone_phenotyping/01_growth_curve_qc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1) Inspect/Smooth curves</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../R/strep_only/monocultures/clone_phenotyping/02_growthrate_auc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2) Summarize curves</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../../R/strep_only/monocultures/clone_phenotyping/03_growth_summary_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3) Analysis and plot</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#setup" id="toc-setup" class="nav-link active" data-scroll-target="#setup"><span class="header-section-number">1</span> Setup</a></li>
  <li><a href="#read" id="toc-read" class="nav-link" data-scroll-target="#read"><span class="header-section-number">2</span> Read</a></li>
  <li><a href="#data-formatting" id="toc-data-formatting" class="nav-link" data-scroll-target="#data-formatting"><span class="header-section-number">3</span> Data formatting</a></li>
  <li><a href="#data-normalization" id="toc-data-normalization" class="nav-link" data-scroll-target="#data-normalization"><span class="header-section-number">4</span> Data normalization</a></li>
  <li><a href="#machine-learning-the-home-environment" id="toc-machine-learning-the-home-environment" class="nav-link" data-scroll-target="#machine-learning-the-home-environment"><span class="header-section-number">5</span> Machine learning the home environment</a>
  <ul class="collapse">
  <li><a href="#classes-ancestral-b-bs" id="toc-classes-ancestral-b-bs" class="nav-link" data-scroll-target="#classes-ancestral-b-bs"><span class="header-section-number">5.1</span> 3 classes (ancestral, B, BS)</a>
  <ul class="collapse">
  <li><a href="#sec-split" id="toc-sec-split" class="nav-link" data-scroll-target="#sec-split"><span class="header-section-number">5.1.1</span> Spliting</a></li>
  <li><a href="#sec-recipe" id="toc-sec-recipe" class="nav-link" data-scroll-target="#sec-recipe"><span class="header-section-number">5.1.2</span> Recipe</a></li>
  <li><a href="#sec-specs" id="toc-sec-specs" class="nav-link" data-scroll-target="#sec-specs"><span class="header-section-number">5.1.3</span> Model specifications</a></li>
  <li><a href="#sec-wf" id="toc-sec-wf" class="nav-link" data-scroll-target="#sec-wf"><span class="header-section-number">5.1.4</span> Create workflow set</a></li>
  <li><a href="#sec-tune" id="toc-sec-tune" class="nav-link" data-scroll-target="#sec-tune"><span class="header-section-number">5.1.5</span> Tune</a></li>
  <li><a href="#best-tuning-parameters-and-best-performing-models" id="toc-best-tuning-parameters-and-best-performing-models" class="nav-link" data-scroll-target="#best-tuning-parameters-and-best-performing-models"><span class="header-section-number">5.1.6</span> Best tuning parameters and best performing models</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion"><span class="header-section-number">6</span> Conclusion</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Machine learning evolutionary history from community structure</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
<p class="subtitle lead">From the STR community composition workflow</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Shane Hogle </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">March 25, 2025</p>
    </div>
  </div>
  
    
  </div>
  
<div>
  <div class="abstract">
    <div class="block-title">Abstract</div>
    Here we ask whether there is a signal of the evolutionary history of each community in its response to the different experimental treatmensts. If we can use a machine learning algorithm to skillfully classify the evolutionary history of each treatment then it implies that there is a signal of the past in the present community structure.
  </div>
</div>


</header>


<section id="setup" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Setup</h1>
<p>Loads required libraries and sets global variables</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show/hide code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">library</span>(here)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="fu">library</span>(fs)</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="fu">source</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"R"</span>, <span class="st">"utils_generic.R"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="read" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Read</h1>
<p>Read and format 16S amplicon data</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show/hide code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>sptable <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_tsv</span>(here<span class="sc">::</span><span class="fu">here</span>(data_sp, <span class="st">"species_counts_md.tsv"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2-2"><a href="#cb2-2"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">transfer =</span> day<span class="sc">/</span><span class="dv">7</span>)</span>
<span id="cb2-3"><a href="#cb2-3"></a></span>
<span id="cb2-4"><a href="#cb2-4"></a>counts_f <span class="ot">&lt;-</span> sptable <span class="sc">%&gt;%</span> </span>
<span id="cb2-5"><a href="#cb2-5"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(sample) <span class="sc">%&gt;%</span> </span>
<span id="cb2-6"><a href="#cb2-6"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">f=</span>count_correct<span class="sc">/</span><span class="fu">sum</span>(count_correct)) <span class="sc">%&gt;%</span> </span>
<span id="cb2-7"><a href="#cb2-7"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb2-8"><a href="#cb2-8"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">measure_env_short =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb2-9"><a href="#cb2-9"></a>                                      measure_env <span class="sc">==</span> <span class="st">"bact"</span> <span class="sc">~</span> <span class="st">"Meas: B"</span>,</span>
<span id="cb2-10"><a href="#cb2-10"></a>                                      measure_env <span class="sc">==</span> <span class="st">"bact_strep"</span> <span class="sc">~</span> <span class="st">"Meas: BS"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2-11"><a href="#cb2-11"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">home_env_short =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb2-12"><a href="#cb2-12"></a>                                    evolution_env <span class="sc">==</span> <span class="st">"anc"</span> <span class="sc">~</span> <span class="st">"Home: Anc"</span>,</span>
<span id="cb2-13"><a href="#cb2-13"></a>                                    evolution_env <span class="sc">==</span> <span class="st">"bact"</span> <span class="sc">~</span> <span class="st">"Home: B"</span>,</span>
<span id="cb2-14"><a href="#cb2-14"></a>                                    evolution_env <span class="sc">==</span> <span class="st">"bact_strep"</span> <span class="sc">~</span> <span class="st">"Home: BS"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2-15"><a href="#cb2-15"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">measure_env_short =</span> <span class="fu">factor</span>(measure_env_short, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Meas: B"</span>, <span class="st">"Meas: BS"</span>)),</span>
<span id="cb2-16"><a href="#cb2-16"></a>         <span class="at">home_env_short =</span> <span class="fu">factor</span>(home_env_short, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Home: Anc"</span>, <span class="st">"Home: B"</span>, <span class="st">"Home: BS"</span>)),</span>
<span id="cb2-17"><a href="#cb2-17"></a>         <span class="at">day =</span> <span class="fu">factor</span>(day),</span>
<span id="cb2-18"><a href="#cb2-18"></a>         <span class="at">replicate =</span> <span class="fu">factor</span>(replicate),</span>
<span id="cb2-19"><a href="#cb2-19"></a>         <span class="at">strainID =</span> <span class="fu">factor</span>(strainID, <span class="at">levels =</span> <span class="fu">names</span>(hambi_colors)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Read population density data</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show/hide code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>celldens <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_tsv</span>(here<span class="sc">::</span><span class="fu">here</span>(data_ml, <span class="st">"density4ML.tsv"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="data-formatting" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Data formatting</h1>
<p>Separate the samples to only include those from the experiment. These are the samples that will be used in the machine learning pipeline</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show/hide code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="co"># these are communities of a (supposedly) known composition. Can be used with metacal</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>pos_ctrl_samples <span class="ot">&lt;-</span> counts_f <span class="sc">%&gt;%</span> </span>
<span id="cb4-3"><a href="#cb4-3"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">str_detect</span>(sample, <span class="st">"pos_ctrl"</span>))</span>
<span id="cb4-4"><a href="#cb4-4"></a></span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="co"># these are samples taken directly from YSK and represent the composition of the communities used to start the experiment</span></span>
<span id="cb4-6"><a href="#cb4-6"></a>t0_samples <span class="ot">&lt;-</span> counts_f <span class="sc">%&gt;%</span> </span>
<span id="cb4-7"><a href="#cb4-7"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">str_detect</span>(sample, <span class="st">"pos_ctrl"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-8"><a href="#cb4-8"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(day <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb4-9"><a href="#cb4-9"></a></span>
<span id="cb4-10"><a href="#cb4-10"></a><span class="co"># only samples from the experiment</span></span>
<span id="cb4-11"><a href="#cb4-11"></a>counts_f_experiment <span class="ot">&lt;-</span> <span class="fu">anti_join</span>(counts_f, pos_ctrl_samples, </span>
<span id="cb4-12"><a href="#cb4-12"></a>                                 <span class="at">by =</span> <span class="fu">join_by</span>(sample, strainID, genus, species, count, count_correct, replicate, </span>
<span id="cb4-13"><a href="#cb4-13"></a>                                              day, measure_env, evolution_env, transfer, f, </span>
<span id="cb4-14"><a href="#cb4-14"></a>                                              measure_env_short, home_env_short)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-15"><a href="#cb4-15"></a>  dplyr<span class="sc">::</span><span class="fu">anti_join</span>(., t0_samples, </span>
<span id="cb4-16"><a href="#cb4-16"></a>                   <span class="at">by =</span> <span class="fu">join_by</span>(sample, strainID, genus, species, count, count_correct, </span>
<span id="cb4-17"><a href="#cb4-17"></a>                                replicate, day, measure_env, evolution_env, transfer, f, </span>
<span id="cb4-18"><a href="#cb4-18"></a>                                measure_env_short, home_env_short)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-19"><a href="#cb4-19"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">measure_env_short =</span> <span class="fu">factor</span>(measure_env_short, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Meas: B"</span>, <span class="st">"Meas: BS"</span>)),</span>
<span id="cb4-20"><a href="#cb4-20"></a>         <span class="at">home_env_short =</span> <span class="fu">factor</span>(home_env_short, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Home: Anc"</span>, <span class="st">"Home: B"</span>, <span class="st">"Home: BS"</span>)),</span>
<span id="cb4-21"><a href="#cb4-21"></a>         <span class="at">day =</span> <span class="fu">factor</span>(day),</span>
<span id="cb4-22"><a href="#cb4-22"></a>         <span class="at">replicate =</span> <span class="fu">factor</span>(replicate),</span>
<span id="cb4-23"><a href="#cb4-23"></a>         <span class="at">strainID =</span> <span class="fu">factor</span>(strainID, <span class="at">levels =</span> <span class="fu">names</span>(hambi_colors)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="data-normalization" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Data normalization</h1>
<p>Here we’ll use the same filtering criteria as in <a href="../amplicon_sp_counts/02_composition_analysis.qmd">the t-SNE analysis from section 3 of the last analysis.</a></p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show/hide code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>counts_f_experiment <span class="sc">%&gt;%</span> </span>
<span id="cb5-2"><a href="#cb5-2"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(strainID) <span class="sc">%&gt;%</span> </span>
<span id="cb5-3"><a href="#cb5-3"></a>  dplyr<span class="sc">::</span><span class="fu">summarize</span>(<span class="at">n_samples =</span> <span class="fu">n</span>(),</span>
<span id="cb5-4"><a href="#cb5-4"></a>            <span class="at">n_gt0 =</span> <span class="fu">sum</span>(count <span class="sc">&gt;</span> <span class="dv">0</span>),</span>
<span id="cb5-5"><a href="#cb5-5"></a>            <span class="at">p_gt0 =</span> n_gt0 <span class="sc">/</span> n_samples) <span class="sc">%&gt;%</span> </span>
<span id="cb5-6"><a href="#cb5-6"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb5-7"><a href="#cb5-7"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(n_gt0)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["strainID"],"name":[1],"type":["fct"],"align":["left"]},{"label":["n_samples"],"name":[2],"type":["int"],"align":["right"]},{"label":["n_gt0"],"name":[3],"type":["int"],"align":["right"]},{"label":["p_gt0"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"HAMBI_2792","2":"107","3":"0","4":"0.000000000"},{"1":"HAMBI_0097","2":"107","3":"1","4":"0.009345794"},{"1":"HAMBI_0262","2":"107","3":"2","4":"0.018691589"},{"1":"HAMBI_1988","2":"107","3":"6","4":"0.056074766"},{"1":"HAMBI_1299","2":"107","3":"25","4":"0.233644860"},{"1":"HAMBI_3237","2":"107","3":"29","4":"0.271028037"},{"1":"HAMBI_1279","2":"107","3":"30","4":"0.280373832"},{"1":"HAMBI_2159","2":"107","3":"67","4":"0.626168224"},{"1":"HAMBI_2443","2":"107","3":"83","4":"0.775700935"},{"1":"HAMBI_2494","2":"107","3":"84","4":"0.785046729"},{"1":"HAMBI_0006","2":"107","3":"95","4":"0.887850467"},{"1":"HAMBI_2164","2":"107","3":"99","4":"0.925233645"},{"1":"HAMBI_1972","2":"107","3":"103","4":"0.962616822"},{"1":"HAMBI_1292","2":"107","3":"106","4":"0.990654206"},{"1":"HAMBI_3031","2":"107","3":"106","4":"0.990654206"},{"1":"HAMBI_2160","2":"107","3":"106","4":"0.990654206"},{"1":"HAMBI_1287","2":"107","3":"107","4":"1.000000000"},{"1":"HAMBI_1977","2":"107","3":"107","4":"1.000000000"},{"1":"HAMBI_0403","2":"107","3":"107","4":"1.000000000"},{"1":"HAMBI_2659","2":"107","3":"107","4":"1.000000000"},{"1":"HAMBI_1896","2":"107","3":"107","4":"1.000000000"},{"1":"HAMBI_0105","2":"107","3":"107","4":"1.000000000"},{"1":"HAMBI_1842","2":"107","3":"107","4":"1.000000000"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Briefly, we will use the <a href="https://en.wikipedia.org/wiki/Compositional_data#Center_log_ratio_transform">centered log-ratio transformation</a> for the species abundances. The centered log-ratio can be interpreted as the log-fold change of species i relative to the average microbe in a sample. The formula for the transformation is:</p>
<p><span class="math display">\[
\text{clr}(\mathbf x)= \left(log
\frac{x_i}{g(\mathbf x)} \right)_{i=1,...,D} \qquad \text{with} \quad
g(\mathbf x) = \left(\prod_{i=1}^Dx_i\right)^{1/D} =
\exp\left(\frac{1}{D}\sum_{i=1}^D \log x_i\right)\text{,}
\]</span></p>
<p>We will use the implementation of centered log-ratio transform in the <code>compositions</code> package</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show/hide code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="fu">set.seed</span>(<span class="dv">12353</span>)</span>
<span id="cb6-2"><a href="#cb6-2"></a></span>
<span id="cb6-3"><a href="#cb6-3"></a>lowstrainsv <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb6-4"><a href="#cb6-4"></a>  <span class="st">"HAMBI_0097"</span>,</span>
<span id="cb6-5"><a href="#cb6-5"></a>  <span class="st">"HAMBI_2792"</span></span>
<span id="cb6-6"><a href="#cb6-6"></a>)</span>
<span id="cb6-7"><a href="#cb6-7"></a></span>
<span id="cb6-8"><a href="#cb6-8"></a>mymat <span class="ot">&lt;-</span> counts_f_experiment <span class="sc">%&gt;%</span> </span>
<span id="cb6-9"><a href="#cb6-9"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span>(strainID <span class="sc">%in%</span> lowstrainsv)) <span class="sc">%&gt;%</span> </span>
<span id="cb6-10"><a href="#cb6-10"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(sample, strainID, count) <span class="sc">%&gt;%</span> </span>
<span id="cb6-11"><a href="#cb6-11"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">count =</span> count <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-12"><a href="#cb6-12"></a>  <span class="co"># important to arrange by sample as this makes some later joins easier</span></span>
<span id="cb6-13"><a href="#cb6-13"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(sample) <span class="sc">%&gt;%</span> </span>
<span id="cb6-14"><a href="#cb6-14"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">"strainID"</span>, <span class="at">values_from =</span> <span class="st">"count"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-15"><a href="#cb6-15"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="at">var =</span> <span class="st">"sample"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-16"><a href="#cb6-16"></a>  <span class="fu">data.frame</span>()</span>
<span id="cb6-17"><a href="#cb6-17"></a></span>
<span id="cb6-18"><a href="#cb6-18"></a><span class="co"># calculate clr transform</span></span>
<span id="cb6-19"><a href="#cb6-19"></a>balclr <span class="ot">&lt;-</span> compositions<span class="sc">::</span><span class="fu">clr</span>(mymat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="machine-learning-the-home-environment" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Machine learning the home environment</h1>
<p>The goal is to see if we can reliably predict which home environment a community came from (either ancestral clonal, or co-evolved in YSK) using only the species abundances, knowledge of the experiment structure (e.g., replicate and experimental transfer), and the measurement environment. The motivation behind this is that if we can learn the evolutionary home environment there must be some kind of “ecological signal” embedded in the community data that is a function of the evolutionary home environment. We are using machine learning approaches because they are flexible, powerful, and we are most interested in prediction. We care less about which features/variables are driving the signal…</p>
<p>Load the <code>tidymodels</code> ecosystem. We are using <a href="https://www.tidymodels.org/"><code>tidymodels</code></a> because it allows us to work with familiar <code>tidyverse</code> syntax while making sure we adhere to best practices in training and assessing the performance of machine learning models.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show/hide code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="fu">library</span>(discrim)</span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="fu">library</span>(themis)</span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="fu">tidymodels_prefer</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>First doing some basic data preparations. We will create some additional classification structures that we will investigate further below</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show/hide code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>balclr_md <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(balclr) <span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2"></a>  tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"sample"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-3"><a href="#cb8-3"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(<span class="fu">distinct</span>(dplyr<span class="sc">::</span><span class="fu">select</span>(counts_f_experiment, sample, replicate, transfer, measure_env, evolution_env)), </span>
<span id="cb8-4"><a href="#cb8-4"></a>                   <span class="at">by =</span> <span class="fu">join_by</span>(sample)) <span class="sc">%&gt;%</span></span>
<span id="cb8-5"><a href="#cb8-5"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(celldens, <span class="at">by =</span> <span class="fu">join_by</span>(replicate, transfer, measure_env, evolution_env)) <span class="sc">%&gt;%</span> </span>
<span id="cb8-6"><a href="#cb8-6"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">replicate =</span> <span class="fu">factor</span>(replicate),</span>
<span id="cb8-7"><a href="#cb8-7"></a>         <span class="at">transfer =</span> <span class="fu">factor</span>(transfer),</span>
<span id="cb8-8"><a href="#cb8-8"></a>         <span class="at">measure_env =</span> <span class="fu">factor</span>(measure_env),</span>
<span id="cb8-9"><a href="#cb8-9"></a>         <span class="at">home_env_3c =</span> <span class="fu">factor</span>(evolution_env),</span>
<span id="cb8-10"><a href="#cb8-10"></a>         <span class="co"># whether sample is from YSK or not</span></span>
<span id="cb8-11"><a href="#cb8-11"></a>         <span class="at">home_env_ae =</span> <span class="fu">factor</span>(<span class="fu">if_else</span>(evolution_env <span class="sc">==</span> <span class="st">"anc"</span>, <span class="st">"anc"</span>, <span class="st">"evo"</span>)),</span>
<span id="cb8-12"><a href="#cb8-12"></a>         <span class="co"># whether sample had streptomycin present</span></span>
<span id="cb8-13"><a href="#cb8-13"></a>         <span class="at">home_env_sns =</span> <span class="fu">factor</span>(<span class="fu">case_when</span>(evolution_env <span class="sc">==</span> <span class="st">"bact_strep"</span> <span class="sc">~</span> <span class="st">"strep"</span>, </span>
<span id="cb8-14"><a href="#cb8-14"></a>                                         evolution_env <span class="sc">==</span> <span class="st">"anc"</span> <span class="sc">~</span> <span class="cn">NA_character_</span>,</span>
<span id="cb8-15"><a href="#cb8-15"></a>                                         <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"nostrep"</span>))) <span class="sc">%&gt;%</span>  </span>
<span id="cb8-16"><a href="#cb8-16"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>sample, <span class="sc">-</span>evolution_env)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="classes-ancestral-b-bs" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="classes-ancestral-b-bs"><span class="header-section-number">5.1</span> 3 classes (ancestral, B, BS)</h2>
<p>First were going to try and predict all 3 different home evolution environments. We are going to train and analyze the performance of many different types of models</p>
<section id="sec-split" class="level3" data-number="5.1.1">
<h3 data-number="5.1.1" class="anchored" data-anchor-id="sec-split"><span class="header-section-number">5.1.1</span> Spliting</h3>
<p>Split the data using the default 3:1 ratio of training-to-test. Here we also set the strata argument. This argument makes sure that both sides of the split have roughly the same distribution for each value of strata. If a numeric variable is passed to strata then it is binned and distributions are matched within bins. In this case there will be roughly the same distribution of the 3 classes within each side of the test/train split.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show/hide code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>balclr_3c <span class="ot">&lt;-</span> balclr_md <span class="sc">%&gt;%</span> </span>
<span id="cb9-2"><a href="#cb9-2"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>home_env_ae, <span class="sc">-</span>home_env_sns) <span class="sc">%&gt;%</span> </span>
<span id="cb9-3"><a href="#cb9-3"></a>  tidyr<span class="sc">::</span><span class="fu">drop_na</span>()</span>
<span id="cb9-4"><a href="#cb9-4"></a></span>
<span id="cb9-5"><a href="#cb9-5"></a><span class="fu">table</span>(balclr_3c<span class="sc">$</span>home_env_3c)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
       anc       bact bact_strep 
        36         35         36 </code></pre>
</div>
</div>
<p>The data is balanced</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show/hide code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="fu">set.seed</span>(<span class="dv">1501</span>)</span>
<span id="cb11-2"><a href="#cb11-2"></a>balclr_3c_split <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">initial_split</span>(balclr_3c, <span class="at">strata =</span> home_env_3c)</span>
<span id="cb11-3"><a href="#cb11-3"></a>balclr_3c_train <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">training</span>(balclr_3c_split)</span>
<span id="cb11-4"><a href="#cb11-4"></a>balclr_3c_test  <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">testing</span>(balclr_3c_split)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Resample the training set using five repeats of 10-fold cross-validation</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show/hide code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="fu">set.seed</span>(<span class="dv">1502</span>)</span>
<span id="cb12-2"><a href="#cb12-2"></a>balclr_3c_folds <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">vfold_cv</span>(balclr_3c_train, <span class="at">strata =</span> home_env_3c)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="sec-recipe" class="level3" data-number="5.1.2">
<h3 data-number="5.1.2" class="anchored" data-anchor-id="sec-recipe"><span class="header-section-number">5.1.2</span> Recipe</h3>
<p>First we need to preprocess the data so that it is in optimal format for Ml. Some useful steps include:</p>
<ul>
<li><code>step_novel():</code> converts all nominal variables to factors and takes care of other issues related to categorical variables.</li>
<li><code>step_normalize():</code> normalizes (center and scales) the numeric variables to have a standard deviation of one and a mean of zero. (i.e., z-standardization).</li>
<li><code>step_dummy():</code> converts our factor column ocean_proximity into numeric binary (0 and 1) variables.
<ul>
<li>Note that this step may cause problems if your categorical variable has too many levels - especially if some of the levels are very infrequent. In this case you should either drop the variable or pool infrequently occurring values into an “other” category with step_other. This steps has to be performed before step_dummy.</li>
</ul></li>
<li><code>step_zv():</code> removes any numeric variables that have zero variance.</li>
<li><code>step_corr():</code> will remove predictor variables that have large correlations with other predictor variables.</li>
</ul>
<p><strong>Edit: data is already in centered log-ratio transform and further normalization doesn’t really help.</strong></p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show/hide code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>balclr_3c_rec <span class="ot">&lt;-</span> recipes<span class="sc">::</span><span class="fu">recipe</span>(home_env_3c <span class="sc">~</span> ., <span class="at">data =</span> balclr_3c_train) <span class="sc">%&gt;%</span> </span>
<span id="cb13-2"><a href="#cb13-2"></a>  recipes<span class="sc">::</span><span class="fu">step_normalize</span>(od600) <span class="sc">%&gt;%</span> </span>
<span id="cb13-3"><a href="#cb13-3"></a>  recipes<span class="sc">::</span><span class="fu">step_dummy</span>(<span class="fu">all_nominal</span>(), <span class="sc">-</span><span class="fu">all_outcomes</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb13-4"><a href="#cb13-4"></a>  recipes<span class="sc">::</span><span class="fu">step_zv</span>(od600)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>You can take a peek at the what the preprocessing recipe does using <code>prep</code> and <code>bake</code></p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show/hide code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>balclr_3c_rec <span class="sc">%&gt;%</span> </span>
<span id="cb14-2"><a href="#cb14-2"></a>  <span class="co"># perform the recipe on training data</span></span>
<span id="cb14-3"><a href="#cb14-3"></a>  recipes<span class="sc">::</span><span class="fu">prep</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb14-4"><a href="#cb14-4"></a>  <span class="co"># extract only the preprocessed dataframe </span></span>
<span id="cb14-5"><a href="#cb14-5"></a>  recipes<span class="sc">::</span><span class="fu">bake</span>(<span class="at">new_data =</span> <span class="cn">NULL</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["HAMBI_0006"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["HAMBI_0105"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["HAMBI_0262"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["HAMBI_0403"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["HAMBI_1279"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["HAMBI_1287"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["HAMBI_1292"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["HAMBI_1299"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["HAMBI_1842"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["HAMBI_1896"],"name":[10],"type":["dbl"],"align":["right"]},{"label":["HAMBI_1972"],"name":[11],"type":["dbl"],"align":["right"]},{"label":["HAMBI_1977"],"name":[12],"type":["dbl"],"align":["right"]},{"label":["HAMBI_1988"],"name":[13],"type":["dbl"],"align":["right"]},{"label":["HAMBI_2159"],"name":[14],"type":["dbl"],"align":["right"]},{"label":["HAMBI_2160"],"name":[15],"type":["dbl"],"align":["right"]},{"label":["HAMBI_2164"],"name":[16],"type":["dbl"],"align":["right"]},{"label":["HAMBI_2443"],"name":[17],"type":["dbl"],"align":["right"]},{"label":["HAMBI_2494"],"name":[18],"type":["dbl"],"align":["right"]},{"label":["HAMBI_2659"],"name":[19],"type":["dbl"],"align":["right"]},{"label":["HAMBI_3031"],"name":[20],"type":["dbl"],"align":["right"]},{"label":["HAMBI_3237"],"name":[21],"type":["dbl"],"align":["right"]},{"label":["od600"],"name":[22],"type":["dbl"],"align":["right"]},{"label":["home_env_3c"],"name":[23],"type":["fct"],"align":["left"]},{"label":["replicate_B"],"name":[24],"type":["dbl"],"align":["right"]},{"label":["replicate_C"],"name":[25],"type":["dbl"],"align":["right"]},{"label":["replicate_D"],"name":[26],"type":["dbl"],"align":["right"]},{"label":["replicate_E"],"name":[27],"type":["dbl"],"align":["right"]},{"label":["replicate_F"],"name":[28],"type":["dbl"],"align":["right"]},{"label":["transfer_X8"],"name":[29],"type":["dbl"],"align":["right"]},{"label":["transfer_X12"],"name":[30],"type":["dbl"],"align":["right"]},{"label":["measure_env_bact_strep"],"name":[31],"type":["dbl"],"align":["right"]}],"data":[{"1":"4.3986221","2":"2.1276058","3":"-3.397847","4":"0.098660398","5":"-3.3978472","6":"3.17163426","7":"-0.564633820","8":"-3.3978472","9":"0.59113688","10":"4.381201","11":"5.95503389","12":"3.34621202","13":"-3.397847","14":"-1.3184056","15":"0.6094860215","16":"-1.788409251","17":"-0.50747541","18":"-2.299235","19":"-1.45193701","20":"0.23973900","21":"-3.3978472","22":"0.67055787","23":"anc","24":"0","25":"0","26":"0","27":"0","28":"0","29":"0","30":"0","31":"0"},{"1":"4.3334985","2":"1.8042839","3":"-3.725145","4":"-0.547091350","5":"-3.7251452","6":"2.78956751","7":"-0.011573113","8":"-3.7251452","9":"1.11113673","10":"4.367094","11":"5.74840525","12":"2.43606214","13":"-3.725145","14":"-3.0319980","15":"1.3052927413","16":"-1.327249907","17":"-0.39294067","18":"-1.327250","19":"-1.16019582","20":"0.22609854","21":"-1.4225601","22":"-0.35449875","23":"anc","24":"0","25":"0","26":"0","27":"0","28":"0","29":"1","30":"0","31":"0"},{"1":"4.3861622","2":"1.9625819","3":"-3.731150","4":"0.006519361","5":"-2.6325380","6":"2.28744296","7":"0.053039377","8":"-2.6325380","9":"1.47833590","10":"4.087280","11":"5.52550102","12":"1.92133892","13":"-3.731150","14":"-3.0380031","15":"0.4585044851","16":"-1.785240108","17":"-0.78671128","18":"-1.939391","19":"0.16067004","20":"-0.39894575","21":"-1.6517087","22":"-0.18365598","23":"anc","24":"0","25":"0","26":"0","27":"0","28":"0","29":"0","30":"1","31":"0"},{"1":"4.0896048","2":"1.9983288","3":"-3.611143","4":"0.150057145","5":"-2.9179958","6":"3.01822028","7":"-0.114635409","8":"-3.6111430","9":"0.88866670","10":"4.292084","11":"5.79763834","12":"3.33583302","13":"-3.611143","14":"-1.5317014","15":"0.6515369068","16":"-1.819383501","17":"-0.05579491","18":"-2.512531","19":"-1.12623632","20":"0.30088004","21":"-3.6111430","22":"0.67055787","23":"anc","24":"1","25":"0","26":"0","27":"0","28":"0","29":"0","30":"0","31":"0"},{"1":"4.4357774","2":"1.9380910","3":"-3.801702","4":"-0.666207689","5":"-3.8017019","6":"2.89656615","7":"0.130123728","8":"-3.8017019","9":"1.13994052","10":"4.069609","11":"5.71051926","12":"2.42877954","13":"-3.801702","14":"-2.4154075","15":"0.9078282967","16":"-1.604477327","17":"-0.66620769","18":"-1.604477","19":"-0.91133015","20":"-0.11282245","21":"-0.4694974","22":"-0.46839393","23":"anc","24":"1","25":"0","26":"0","27":"0","28":"0","29":"1","30":"0","31":"0"},{"1":"4.4542702","2":"2.3310381","3":"-3.764787","4":"-0.051214441","5":"-3.7647865","6":"2.35551091","7":"-0.027116889","8":"-3.7647865","9":"1.27216609","10":"3.984536","11":"5.61925504","12":"2.17010769","13":"-3.764787","14":"-3.0716393","15":"0.3460873566","16":"-1.462201415","17":"-0.26827895","18":"-2.666174","19":"1.91879326","20":"0.12703379","21":"-1.9730270","22":"0.27192474","23":"anc","24":"1","25":"0","26":"0","27":"0","28":"0","29":"0","30":"1","31":"0"},{"1":"4.2618285","2":"2.1222989","3":"-3.673759","4":"0.132903652","5":"-2.5751465","6":"2.78457945","7":"-0.118410776","8":"-2.5751465","9":"0.68294999","10":"4.354370","11":"6.01758692","12":"3.56903909","13":"-3.673759","14":"-1.4765343","15":"0.9009521408","16":"-1.727848689","17":"-0.34155433","18":"-3.673759","19":"-1.10880948","20":"-0.20802293","21":"-3.6737588","22":"-0.06976080","23":"anc","24":"0","25":"1","26":"0","27":"0","28":"0","29":"0","30":"0","31":"0"},{"1":"4.4031433","2":"2.1352288","3":"-3.614164","4":"-0.523121718","5":"-3.6141642","6":"2.65113704","7":"0.235983430","8":"-3.6141642","9":"0.70332394","10":"4.355539","11":"5.92006965","12":"2.51488604","13":"-3.614164","14":"-2.2278698","15":"1.1649593217","16":"-2.004726259","17":"-0.72379241","18":"-1.668254","19":"-1.66825402","20":"-0.03064523","21":"-0.7809508","22":"-0.81007947","23":"anc","24":"0","25":"1","26":"0","27":"0","28":"0","29":"1","30":"0","31":"0"},{"1":"3.9667229","2":"2.1224318","3":"-3.715299","4":"0.504209069","5":"-2.3290043","6":"3.34431899","7":"-0.419461771","8":"-2.3290043","9":"0.29203455","10":"4.330290","11":"5.94993173","12":"3.25824438","13":"-3.022151","14":"-3.0221515","15":"0.6414101900","16":"-2.105860724","17":"-0.21879108","18":"-2.616686","19":"-0.41946177","20":"-0.49642281","21":"-3.7152986","22":"0.38581992","23":"anc","24":"0","25":"0","26":"1","27":"0","28":"0","29":"0","30":"0","31":"0"},{"1":"4.5743734","2":"2.1382115","3":"-3.478560","4":"0.076788470","5":"-3.4785596","6":"2.84579937","7":"0.017947970","8":"-3.4785596","9":"1.15616940","10":"4.440069","11":"5.91817736","12":"2.55692184","13":"-3.478560","14":"-2.3799473","15":"1.2836143429","16":"-1.532649443","17":"-0.58818783","18":"-1.686800","19":"-1.53264944","20":"0.10495935","21":"-3.4785596","22":"-0.63923670","23":"anc","24":"0","25":"0","26":"1","27":"0","28":"0","29":"1","30":"0","31":"0"},{"1":"4.2492812","2":"1.9597218","3":"-3.581542","4":"-0.085034201","5":"-1.9721038","6":"2.31561211","7":"0.107337692","8":"-1.6356316","9":"1.70166197","10":"3.985804","11":"5.39142935","12":"1.86087595","13":"-3.581542","14":"-3.5815418","15":"0.2470996342","16":"-1.635631613","17":"-0.58580949","18":"-2.888395","19":"-0.44604755","20":"-0.32344522","21":"-1.5021002","22":"0.15802956","23":"anc","24":"0","25":"0","26":"1","27":"0","28":"0","29":"0","30":"1","31":"0"},{"1":"4.4045959","2":"2.1953664","3":"-3.579185","4":"0.547949242","5":"-2.4805729","6":"3.25384659","7":"0.481257868","8":"-3.5791851","9":"0.13438692","10":"4.409018","11":"5.98209375","12":"2.94143598","13":"-2.886038","14":"-2.8860380","15":"0.8152640118","16":"-2.480572854","17":"-0.63474616","18":"-2.192891","19":"-1.38196057","20":"-0.17798776","21":"-2.8860380","22":"0.67055787","23":"anc","24":"0","25":"0","26":"0","27":"1","28":"0","29":"0","30":"0","31":"0"},{"1":"4.3523836","2":"1.7576760","3":"-3.494597","4":"-0.316543556","5":"-2.3959851","6":"2.10011399","7":"-0.060610182","8":"-2.3959851","9":"1.45416250","10":"3.736690","11":"5.36362905","12":"1.25899280","13":"-3.494597","14":"-2.3959851","15":"0.2189746801","16":"-1.702837917","17":"-0.78654719","18":"-2.395985","19":"0.73950912","20":"-0.12730156","21":"-1.4151558","22":"0.38581992","23":"anc","24":"0","25":"0","26":"0","27":"1","28":"0","29":"0","30":"1","31":"0"},{"1":"4.4011526","2":"1.9438676","3":"-3.616814","4":"-0.182826861","5":"-2.9236669","6":"2.97211241","7":"0.233333536","8":"-2.9236669","9":"1.48913141","10":"3.986086","11":"5.77826161","12":"2.22091638","13":"-3.616814","14":"-2.9236669","15":"0.7776350894","16":"-1.537372524","17":"-0.35871753","18":"-2.007376","19":"-0.28460956","20":"0.18984842","21":"-3.6168141","22":"-0.81007947","23":"anc","24":"0","25":"0","26":"0","27":"0","28":"1","29":"1","30":"0","31":"0"},{"1":"4.3929610","2":"2.0250028","3":"-3.543342","4":"1.120097361","5":"-3.5433417","6":"2.41508296","7":"-0.324465908","8":"-3.5433417","9":"1.46729356","10":"4.086634","11":"5.54911560","12":"1.58062225","13":"-3.543342","14":"-2.1570474","15":"0.0401772058","16":"-1.751582263","17":"-0.36528790","18":"-1.933904","19":"0.55100283","20":"-0.07760583","21":"-2.4447294","22":"-0.35449875","23":"anc","24":"0","25":"0","26":"0","27":"0","28":"1","29":"0","30":"1","31":"0"},{"1":"-1.9351111","2":"2.0492326","3":"-3.321405","4":"2.492725081","5":"-3.3214055","6":"6.26345961","7":"0.316180709","8":"-3.3214055","9":"1.45771804","10":"4.831081","11":"-0.61335525","12":"1.80255853","13":"-3.321405","14":"-3.3214055","15":"1.9464527083","16":"-0.756456093","17":"-0.32567318","18":"-1.375495","19":"3.33532107","20":"0.43979466","21":"-3.3214055","22":"-0.41144634","23":"anc","24":"0","25":"0","26":"0","27":"0","28":"0","29":"0","30":"0","31":"1"},{"1":"-2.2755136","2":"1.9537503","3":"-3.374126","4":"2.838480189","5":"-3.3741259","6":"6.42926503","7":"-0.006830077","8":"-3.3741259","9":"1.56034803","10":"4.925657","11":"-0.73506858","12":"2.01950164","13":"-3.374126","14":"-0.2830835","15":"2.3847758673","16":"-0.735068577","17":"-3.37412591","18":"-1.764688","19":"3.59378330","20":"0.33944616","21":"-3.3741259","22":"-0.41144634","23":"anc","24":"1","25":"0","26":"0","27":"0","28":"0","29":"0","30":"0","31":"1"},{"1":"-1.5138705","2":"1.6388656","3":"-3.123308","4":"2.261186688","5":"-3.1233084","6":"5.96418617","7":"0.565571080","8":"-3.1233084","9":"2.77384549","10":"4.022676","11":"-0.72541310","12":"4.63245880","13":"-3.123308","14":"-0.8207233","15":"0.9542290696","16":"-1.043866833","17":"-2.43016119","18":"-2.430161","19":"0.46021056","20":"1.30750842","21":"-3.1233084","22":"-0.63923670","23":"anc","24":"1","25":"0","26":"0","27":"0","28":"0","29":"1","30":"0","31":"1"},{"1":"-3.4243040","2":"2.1440405","3":"-3.424304","4":"2.554581758","5":"-3.4243040","6":"6.23513551","7":"0.945143846","8":"-3.4243040","9":"3.59499265","10":"4.414434","11":"-0.20542818","12":"5.14263128","13":"-3.424304","14":"-0.9393974","15":"1.1606634722","16":"0.009683198","17":"-3.42430401","18":"-1.478394","19":"-0.71625381","20":"1.10829549","21":"-3.4243040","22":"-0.24060357","23":"anc","24":"1","25":"0","26":"0","27":"0","28":"0","29":"0","30":"1","31":"1"},{"1":"-0.7941292","2":"1.4676339","3":"-3.096714","4":"2.323820697","5":"-3.0967143","6":"6.57955892","7":"1.062168781","8":"-3.0967143","9":"1.17995182","10":"5.069502","11":"-1.15080415","12":"3.36787400","13":"-3.096714","14":"-3.0967143","15":"2.1711438563","16":"-1.304954834","17":"-3.09671430","18":"-3.096714","19":"3.30354314","20":"1.49840555","21":"-3.0967143","22":"-0.12670839","23":"anc","24":"0","25":"1","26":"0","27":"0","28":"0","29":"0","30":"0","31":"1"},{"1":"-2.3742160","2":"1.9695894","3":"-3.067363","4":"1.720128571","5":"-3.0673632","6":"6.30126218","7":"0.957988519","8":"-3.0673632","9":"3.24799483","10":"4.433719","11":"-0.29477445","12":"5.07876634","13":"-3.067363","14":"-1.4579253","15":"0.8446598341","16":"-0.669467899","17":"-3.06736317","18":"-2.374216","19":"-0.02284073","20":"1.04351069","21":"-3.0673632","22":"-0.58228911","23":"anc","24":"0","25":"1","26":"0","27":"0","28":"0","29":"1","30":"0","31":"1"},{"1":"-1.6658286","2":"2.4218269","3":"-3.275267","4":"2.553679058","5":"-3.2752666","6":"6.27204592","7":"1.202070255","8":"-3.2752666","9":"3.78606781","10":"4.758716","11":"-3.27526656","12":"5.30790162","13":"-3.275267","14":"-3.2752666","15":"1.8367212292","16":"-0.384894801","17":"-3.27526656","18":"-1.195825","19":"-0.38489480","20":"1.69454674","21":"-3.2752666","22":"-0.18365598","23":"anc","24":"0","25":"1","26":"0","27":"0","28":"0","29":"0","30":"1","31":"1"},{"1":"-0.1124727","2":"2.1108631","3":"-3.156995","4":"2.826941189","5":"-3.1569951","6":"6.44071430","7":"0.453922821","8":"-3.1569951","9":"1.97880335","10":"4.936773","11":"-3.15699509","12":"3.73361403","13":"-3.156995","14":"-3.1569951","15":"1.9846684646","16":"-0.517937762","17":"-3.15699509","18":"-1.365236","19":"2.99786300","20":"-0.21255611","21":"-3.1569951","22":"-0.35449875","23":"anc","24":"0","25":"0","26":"1","27":"0","28":"0","29":"0","30":"0","31":"1"},{"1":"-3.4692970","2":"2.3297957","3":"-3.469297","4":"2.283275657","5":"-3.4692970","6":"6.32994055","7":"0.442726024","8":"-3.4692970","9":"2.94579998","10":"4.068666","11":"-2.77614980","12":"5.16461201","13":"-3.469297","14":"-1.5233868","15":"1.1358732046","16":"0.673837745","17":"-3.46929698","18":"-1.859859","19":"3.32975888","20":"1.74018917","21":"-3.4692970","22":"-0.18365598","23":"anc","24":"0","25":"0","26":"1","27":"0","28":"0","29":"0","30":"1","31":"1"},{"1":"-0.5947892","2":"1.5864351","3":"-3.233846","4":"2.422145320","5":"-3.2338465","6":"6.20410743","7":"0.321501571","8":"-3.2338465","9":"0.94054078","10":"4.802727","11":"-2.13523420","12":"1.77009982","13":"-3.233846","14":"-0.4612578","15":"2.0288436982","16":"-0.594789161","17":"-3.23384649","18":"-2.540699","19":"3.91056069","20":"1.74288725","21":"-3.2338465","22":"-0.18365598","23":"anc","24":"0","25":"0","26":"0","27":"1","28":"0","29":"0","30":"0","31":"1"},{"1":"-1.0571339","2":"1.9242096","3":"-3.696191","4":"2.852027839","5":"-3.6961913","6":"6.15779087","7":"0.634542076","8":"-3.6961913","9":"3.29406524","10":"4.332264","11":"-0.43809473","12":"4.64115730","13":"-3.696191","14":"-1.6167497","15":"0.9287815492","16":"0.836408229","17":"-3.69619126","18":"-1.904432","19":"0.39815330","20":"1.19415786","21":"-3.6961913","22":"-0.41144634","23":"anc","24":"0","25":"0","26":"0","27":"1","28":"0","29":"0","30":"1","31":"1"},{"1":"-1.4807808","2":"1.9036095","3":"-3.272540","4":"2.643661788","5":"-3.2725403","6":"6.23225915","7":"-0.328101295","8":"-3.2725403","9":"1.53148077","10":"5.153414","11":"-0.38216852","12":"1.69030436","13":"-3.272540","14":"-0.3821685","15":"1.9532063992","16":"-1.075315697","17":"-3.27254027","18":"-1.480781","19":"3.26559955","20":"0.39102137","21":"-3.2725403","22":"-0.24060357","23":"anc","24":"0","25":"0","26":"0","27":"0","28":"1","29":"0","30":"0","31":"1"},{"1":"3.2651986","2":"2.2385237","3":"-3.784924","4":"1.867565238","5":"-2.1754860","6":"3.30515289","7":"-0.047254324","8":"-1.8390138","9":"-0.78919167","10":"3.436912","11":"5.69039266","12":"2.47082610","13":"-3.091777","14":"-2.1754860","15":"0.3894633275","16":"-1.839013793","17":"-1.01233522","18":"-3.091777","19":"1.35087449","20":"-0.38372656","21":"-3.7849239","22":"1.06919100","23":"bact","24":"0","25":"0","26":"0","27":"0","28":"0","29":"0","30":"0","31":"0"},{"1":"3.7456218","2":"2.2797922","3":"-4.350891","4":"1.978829740","5":"-1.2153969","6":"1.64307026","7":"-1.055054299","8":"-1.2153969","9":"-0.29044815","10":"3.338480","11":"5.57465138","12":"2.02413365","13":"-4.350891","14":"-2.4049810","15":"0.4932959210","16":"-2.741453253","17":"-1.30636873","18":"-2.964597","19":"2.09641470","20":"-0.36190712","21":"-0.9169040","22":"-1.83513609","23":"bact","24":"0","25":"0","26":"0","27":"0","28":"0","29":"1","30":"0","31":"0"},{"1":"3.8960226","2":"2.2502170","3":"-3.610569","4":"2.602036915","5":"-3.6105692","6":"3.48449520","7":"-0.144833278","8":"-3.6105692","9":"-0.35247264","10":"3.699981","11":"5.60912729","12":"1.64692619","13":"-3.610569","14":"-2.2242748","15":"0.3967640049","16":"-1.664659031","17":"-0.83798046","18":"-2.224275","19":"2.39084570","20":"-0.47507496","21":"-3.6105692","22":"3.00540906","23":"bact","24":"1","25":"0","26":"0","27":"0","28":"0","29":"0","30":"0","31":"0"},{"1":"4.4826114","2":"2.5770402","3":"-4.123691","4":"2.849852083","5":"-4.1236909","6":"2.33777724","7":"-0.386021318","8":"-4.1236909","9":"0.20704240","10":"3.843936","11":"5.55996009","12":"0.68849342","13":"-4.123691","14":"-2.3319315","15":"1.1074176807","16":"-1.926466359","17":"-0.51277302","18":"-2.514253","19":"2.62389559","20":"-0.38602132","21":"-1.7257957","22":"0.04413438","23":"bact","24":"1","25":"0","26":"0","27":"0","28":"0","29":"1","30":"0","31":"0"},{"1":"3.0462823","2":"2.2129768","3":"-3.583081","4":"1.546817789","5":"-1.7913215","6":"3.54541502","7":"-0.181883544","8":"-1.7913215","9":"-0.21578510","10":"4.272076","11":"5.73242994","12":"3.42180106","13":"-3.583081","14":"-2.8899337","15":"0.6935851929","16":"-2.889933746","17":"-1.97364301","18":"-1.973643","19":"0.47736208","20":"-0.49203847","21":"-3.5830809","22":"1.86645726","23":"bact","24":"0","25":"1","26":"0","27":"0","28":"0","29":"0","30":"0","31":"0"},{"1":"3.6296966","2":"2.4068277","3":"-4.331325","4":"2.136373885","5":"-0.9640290","6":"1.33855608","7":"-0.804964317","8":"-0.8973376","9":"-0.23698028","10":"4.053936","11":"5.44194012","12":"2.85102727","13":"-4.331325","14":"-2.7218869","15":"0.6991130799","16":"-2.251883300","17":"-1.62327464","18":"-2.539565","19":"0.87816131","20":"-0.48117724","21":"-2.2518833","22":"-0.06976080","23":"bact","24":"0","25":"1","26":"0","27":"0","28":"0","29":"1","30":"0","31":"0"},{"1":"3.9114580","2":"2.1604767","3":"-3.598425","4":"2.163626273","5":"-3.5984251","6":"3.41369018","7":"-0.825836387","8":"-3.5984251","9":"0.54470962","10":"4.261760","11":"5.71474257","12":"2.24801367","13":"-2.905278","14":"-1.9889872","15":"0.9233634677","16":"-3.598425109","17":"-0.82583639","18":"-1.988987","19":"1.45143090","20":"-0.26622060","21":"-3.5984251","22":"3.34709460","23":"bact","24":"0","25":"0","26":"1","27":"0","28":"0","29":"0","30":"0","31":"0"},{"1":"4.0727447","2":"2.3195900","3":"-4.338421","4":"2.578293944","5":"-0.6007515","6":"2.00545936","7":"-0.783073015","8":"-0.4882735","9":"0.76144535","10":"3.393071","11":"5.11690261","12":"-0.62484901","13":"-4.338421","14":"-3.6452739","15":"0.1502152936","16":"-2.728983164","17":"-1.00621657","18":"-2.546662","19":"2.13082924","20":"-0.13372846","21":"-1.2938986","22":"1.01224341","23":"bact","24":"0","25":"0","26":"1","27":"0","28":"0","29":"0","30":"1","31":"0"},{"1":"3.9817093","2":"2.0716353","3":"-3.963846","4":"1.229110756","5":"-2.8652338","6":"3.39562154","7":"0.006445819","8":"-2.8652338","9":"1.39274018","10":"4.284421","11":"5.42631270","12":"2.20785450","13":"-3.963846","14":"-2.3544082","15":"1.0333661789","16":"-2.577551734","17":"-1.13063275","18":"-2.354408","19":"1.18944550","20":"-0.17965646","21":"-3.9638461","22":"3.11930424","23":"bact","24":"0","25":"0","26":"0","27":"1","28":"0","29":"0","30":"0","31":"0"},{"1":"4.5503412","2":"2.1204432","3":"-3.790353","4":"2.104049427","5":"-3.7903534","6":"2.30772087","7":"-0.324617505","8":"-3.7903534","9":"1.24659919","10":"4.041264","11":"5.62439612","12":"0.44375310","13":"-3.790353","14":"-2.4040590","15":"0.9971383354","16":"-1.710911866","17":"-0.79462113","18":"-2.691741","19":"2.06757975","20":"-0.57147758","21":"-1.8444433","22":"0.55666269","23":"bact","24":"0","25":"0","26":"0","27":"1","28":"0","29":"1","30":"0","31":"0"},{"1":"4.3598860","2":"2.4931754","3":"-3.938156","4":"2.414473705","5":"-3.9381557","6":"2.38440955","7":"-0.536958310","8":"-3.9381557","9":"0.82401824","10":"3.409144","11":"5.50186681","12":"-0.04633539","13":"-3.938156","14":"-2.5518613","15":"0.4926611076","16":"-1.992245542","17":"-0.24927624","18":"-2.146396","19":"2.73134240","20":"-0.44164813","21":"-0.8936333","22":"0.84140064","23":"bact","24":"0","25":"0","26":"0","27":"0","28":"1","29":"0","30":"1","31":"0"},{"1":"-0.5207299","2":"2.7373666","3":"-3.159787","4":"2.973610823","5":"-3.1597872","6":"6.08495458","7":"0.207508610","8":"-3.1597872","9":"2.71514351","10":"3.360834","11":"0.60141290","12":"4.42346030","13":"-3.159787","14":"-3.1597872","15":"0.9990958630","16":"-3.159787220","17":"-3.15978722","18":"-3.159787","19":"3.69772684","20":"1.15770089","21":"-3.1597872","22":"-0.52534152","23":"bact","24":"0","25":"0","26":"0","27":"0","28":"0","29":"1","30":"0","31":"1"},{"1":"0.8417405","2":"3.1024784","3":"-3.269133","4":"3.242611927","5":"-3.2691334","6":"6.53093619","7":"0.196602500","8":"-3.2691334","9":"1.99872476","10":"4.101097","11":"-0.37876164","12":"1.55918033","13":"-3.269133","14":"-3.2691334","15":"0.9935464747","16":"-1.882839041","17":"-2.17052111","18":"-3.269133","19":"4.18962929","20":"0.55950799","21":"-3.2691334","22":"-0.63923670","23":"bact","24":"1","25":"0","26":"0","27":"0","28":"0","29":"0","30":"0","31":"1"},{"1":"0.9034880","2":"2.9594416","3":"-3.345007","4":"3.471728651","5":"-3.3450072","6":"5.98551330","7":"0.056190153","8":"-3.3450072","9":"2.04406450","10":"3.130425","11":"0.62528468","12":"3.81739027","13":"-3.345007","14":"-3.3450072","15":"0.2385117093","16":"-0.860100579","17":"-3.34500723","18":"-3.345007","19":"3.63878274","20":"0.74933733","21":"-3.3450072","22":"-0.86702706","23":"bact","24":"1","25":"0","26":"0","27":"0","28":"0","29":"1","30":"0","31":"1"},{"1":"0.9305473","2":"2.5031447","3":"-3.612747","4":"3.754329625","5":"-3.6127474","6":"5.50668306","7":"-0.116239874","8":"-3.6127474","9":"2.00038067","10":"3.283947","11":"0.41260426","12":"4.26046962","13":"-3.612747","14":"-3.6127474","15":"0.4476955752","16":"-0.147011533","17":"-3.61274744","18":"-3.612747","19":"4.06140549","20":"2.00402366","21":"-3.6127474","22":"0.10108197","23":"bact","24":"1","25":"0","26":"0","27":"0","28":"0","29":"0","30":"1","31":"1"},{"1":"-3.3593379","2":"2.3642472","3":"-3.359338","4":"3.307618847","5":"-3.3593379","6":"5.99795584","7":"0.074649259","8":"-3.3593379","9":"2.82892618","10":"3.818444","11":"4.70561295","12":"1.82244560","13":"-3.359338","14":"-1.9730436","15":"0.7677964394","16":"-0.314815508","17":"-3.35933795","18":"-3.359338","19":"3.94383211","20":"-0.46896619","21":"-3.3593379","22":"-0.63923670","23":"bact","24":"0","25":"1","26":"0","27":"0","28":"0","29":"0","30":"0","31":"1"},{"1":"-0.4328858","2":"2.8288670","3":"-3.477408","4":"1.911663488","5":"-3.4774082","6":"4.68425221","7":"0.106110696","8":"-3.4774082","9":"2.85231266","10":"3.563128","11":"5.82130924","12":"3.83913994","13":"-3.477408","14":"-0.4328858","15":"0.3292542476","16":"-2.091113881","17":"-3.47740824","18":"-3.477408","19":"1.28476569","20":"0.07793982","21":"-3.4774082","22":"-0.69618429","23":"bact","24":"0","25":"1","26":"0","27":"0","28":"0","29":"1","30":"0","31":"1"},{"1":"0.5087327","2":"2.4476498","3":"-3.204839","4":"2.582058032","5":"-3.2048393","6":"3.61080064","7":"-0.719932699","8":"-3.2048393","9":"2.29232888","10":"3.677598","11":"5.76087844","12":"3.94507749","13":"-3.204839","14":"-1.2589292","15":"-0.2091070753","16":"-2.106227060","17":"-3.20483935","18":"-3.204839","19":"1.88891085","20":"0.01403648","21":"-3.2048393","22":"0.04413438","23":"bact","24":"0","25":"1","26":"0","27":"0","28":"0","29":"0","30":"1","31":"1"},{"1":"-1.5901784","2":"2.9007026","3":"-3.199616","4":"3.887121599","5":"-3.1996163","6":"6.42903956","7":"0.411301577","8":"-3.1996163","9":"2.47713747","10":"4.288677","11":"-0.63466698","12":"1.31124317","13":"-3.199616","14":"-3.1996163","15":"1.4155041812","16":"-0.203884062","17":"-3.19961634","18":"-3.199616","19":"4.44098749","20":"0.46394531","21":"-3.1996163","22":"-0.81007947","23":"bact","24":"0","25":"0","26":"1","27":"0","28":"0","29":"0","30":"0","31":"1"},{"1":"-0.9604817","2":"2.5052542","3":"-3.445388","4":"4.819489937","5":"-2.0590940","6":"5.80896893","7":"-0.500949347","8":"-3.4453883","9":"1.85292904","10":"3.746794","11":"0.97345228","12":"2.58047765","13":"-3.445388","14":"-3.4453883","15":"0.1921978339","16":"-1.365946784","17":"-1.24816375","18":"-2.346776","19":"2.61373487","20":"0.61505468","21":"-3.4453883","22":"-0.69618429","23":"bact","24":"0","25":"0","26":"1","27":"0","28":"0","29":"1","30":"0","31":"1"},{"1":"-2.9883650","2":"2.8317179","3":"-2.988365","4":"3.799479971","5":"-2.9883650","6":"6.53203028","7":"0.508142550","8":"-2.9883650","9":"3.05664030","10":"4.470974","11":"-1.04245486","12":"1.73902281","13":"-2.988365","14":"-2.9883650","15":"0.9434606213","16":"-0.908923470","17":"-2.98836501","18":"-2.988365","19":"4.08235910","20":"0.88283600","21":"-2.9883650","22":"-0.92397465","23":"bact","24":"0","25":"0","26":"0","27":"1","28":"0","29":"0","30":"0","31":"1"},{"1":"-1.1516855","2":"2.5670995","3":"-3.790743","4":"2.907525243","5":"-3.7907428","6":"5.59321468","7":"-0.153156651","8":"-3.7907428","9":"2.94740968","10":"3.240998","11":"4.78245257","12":"3.97142780","13":"-3.790743","14":"-1.8448327","15":"0.2165903744","16":"-2.692130522","17":"-0.17982490","18":"-2.404448","19":"1.68572074","20":"-0.53264627","21":"-3.7907428","22":"-0.63923670","23":"bact","24":"0","25":"0","26":"0","27":"1","28":"0","29":"1","30":"0","31":"1"},{"1":"-0.9271184","2":"2.4906083","3":"-3.699707","4":"3.021718614","5":"-3.6997071","6":"4.12713501","7":"-0.755268107","8":"-3.6997071","9":"2.63001382","10":"3.732777","11":"5.71699684","12":"3.93849116","13":"-3.699707","14":"-1.5024825","15":"-0.2657198818","16":"-2.313412725","17":"-0.23397118","18":"-2.090269","19":"1.22754660","20":"-0.29850970","21":"-3.6997071","22":"-0.06976080","23":"bact","24":"0","25":"0","26":"0","27":"1","28":"0","29":"0","30":"1","31":"1"},{"1":"-1.6340022","2":"2.6914540","3":"-3.243440","4":"3.627651148","5":"-3.2434401","6":"6.17821408","7":"0.648380152","8":"-3.2434401","9":"2.57960575","10":"4.001501","11":"0.47013192","12":"0.08876436","13":"-3.243440","14":"-3.2434401","15":"1.2891593468","16":"-0.758533497","17":"-3.24344015","18":"-1.451681","19":"4.20954218","20":"0.76389304","21":"-3.2434401","22":"-0.63923670","23":"bact","24":"0","25":"0","26":"0","27":"0","28":"1","29":"0","30":"0","31":"1"},{"1":"1.0362876","2":"2.6819051","3":"-3.699911","4":"3.574568684","5":"-3.6999109","6":"6.00182762","7":"-0.404074009","8":"-3.6999109","9":"2.42913934","10":"3.948352","11":"-0.17355035","12":"1.48187268","13":"-3.699911","14":"-3.6999109","15":"0.3944336874","16":"-0.866697531","17":"-0.56441666","18":"-1.908151","19":"3.74609062","20":"0.82187770","21":"-3.6999109","22":"-0.92397465","23":"bact","24":"0","25":"0","26":"0","27":"0","28":"1","29":"1","30":"0","31":"1"},{"1":"1.0975169","2":"2.2789154","3":"-3.620982","4":"4.662764771","5":"-3.6209820","6":"5.53141144","7":"0.330261742","8":"-3.6209820","9":"2.17811068","10":"3.004410","11":"-0.25368615","12":"2.08280050","13":"-3.620982","14":"-2.9278348","15":"0.5837106429","16":"-1.136075327","17":"-0.91293178","18":"-3.620982","19":"3.74609508","20":"1.46042239","21":"-3.6209820","22":"-0.41144634","23":"bact","24":"0","25":"0","26":"0","27":"0","28":"1","29":"0","30":"1","31":"1"},{"1":"4.4051369","2":"2.5736861","3":"-3.701076","4":"0.306257226","5":"-3.7010760","6":"2.95821796","7":"-0.012196506","8":"-3.7010760","9":"-0.14572790","10":"3.500095","11":"5.57280243","12":"2.13080652","13":"-3.701076","14":"-1.5038514","15":"1.0084542417","16":"-2.602463671","17":"-0.92848724","18":"-1.398491","19":"2.62864495","20":"0.01249611","21":"-3.7010760","22":"0.04413438","23":"bact_strep","24":"1","25":"0","26":"0","27":"0","28":"0","29":"1","30":"0","31":"0"},{"1":"4.6084034","2":"2.9998597","3":"-3.796964","4":"2.140572204","5":"-3.7969640","6":"0.07423701","7":"0.465715876","8":"-3.7969640","9":"0.76738419","10":"3.828631","11":"5.67627895","12":"1.10087580","13":"-3.796964","14":"-2.4106696","15":"0.5850626333","16":"-1.851053852","17":"-0.96375066","18":"-2.187526","19":"2.73827727","20":"0.31390986","21":"-2.6983517","22":"-0.01281321","23":"bact_strep","24":"1","25":"0","26":"0","27":"0","28":"0","29":"0","30":"1","31":"0"},{"1":"3.4177074","2":"2.0794598","3":"-4.000473","4":"-0.129272367","5":"-2.9018611","6":"4.64335246","7":"-0.909430924","8":"-2.9018611","9":"0.38155326","10":"3.747555","11":"5.34054432","12":"4.10694543","13":"-4.000473","14":"-2.9018611","15":"1.0429517392","16":"-2.208713908","17":"-1.11010162","18":"-1.697888","19":"2.28924219","20":"-0.28690131","21":"-4.0004734","22":"1.12613859","23":"bact_strep","24":"0","25":"1","26":"0","27":"0","28":"0","29":"0","30":"0","31":"0"},{"1":"4.4338053","2":"2.7190916","3":"-3.843353","4":"-0.129780441","5":"-3.8433525","6":"0.90157962","7":"0.315530575","8":"-3.8433525","9":"1.25651392","10":"3.624019","11":"5.38207350","12":"1.67007624","13":"-3.843353","14":"-2.4570581","15":"0.6109947882","16":"-1.540767415","17":"-0.44215513","18":"-1.646128","19":"2.82105651","20":"0.08847312","21":"-2.2339146","22":"0.67055787","23":"bact_strep","24":"0","25":"1","26":"0","27":"0","28":"0","29":"0","30":"1","31":"0"},{"1":"3.9361847","2":"2.5097681","3":"-3.934363","4":"0.176510750","5":"-3.9343631","6":"4.31834356","7":"-0.468627211","8":"-3.9343631","9":"0.44766352","10":"3.938473","11":"5.59282971","12":"3.93082484","13":"-3.934363","14":"-2.1426036","15":"0.7661172520","16":"-1.631778021","17":"-0.93863084","18":"-1.988453","19":"2.02406158","20":"-0.79886890","21":"-3.9343631","22":"1.98035244","23":"bact_strep","24":"0","25":"0","26":"1","27":"0","28":"0","29":"0","30":"0","31":"0"},{"1":"4.4587039","2":"2.9190826","3":"-3.623389","4":"-0.678950384","5":"-3.6233894","6":"1.63930083","7":"0.065490091","8":"-3.6233894","9":"0.06549009","10":"4.076453","11":"5.83490424","12":"2.97239115","13":"-3.623389","14":"-2.5247771","15":"1.3110845698","16":"-1.543947822","17":"-0.85080064","18":"-2.013951","19":"2.42634409","20":"-0.03987042","21":"-3.6233894","22":"-0.12670839","23":"bact_strep","24":"0","25":"0","26":"1","27":"0","28":"0","29":"1","30":"0","31":"0"},{"1":"4.6172200","2":"3.0144456","3":"-3.945902","4":"-0.390554093","5":"-1.8664606","6":"1.26358400","7":"0.061431031","8":"-1.8664606","9":"0.09714911","10":"3.779428","11":"5.64677116","12":"2.18096703","13":"-3.945902","14":"-3.9459022","15":"0.7725967168","16":"-2.559607793","17":"-0.95016988","18":"-2.154143","19":"2.58205576","20":"-0.05408186","21":"-2.3364642","22":"0.67055787","23":"bact_strep","24":"0","25":"0","26":"1","27":"0","28":"0","29":"0","30":"1","31":"0"},{"1":"3.9218185","2":"2.1973646","3":"-4.150025","4":"2.348257509","5":"-4.1500246","6":"4.83416767","7":"-0.782728811","8":"-4.1500246","9":"1.31803550","10":"4.103463","11":"5.31457028","12":"3.78126012","13":"-4.150025","14":"-1.6651180","15":"0.4246863376","16":"-2.763730280","17":"-0.74882726","18":"-2.070583","19":"1.35530690","20":"-0.81782013","21":"-4.1500246","22":"1.24003377","23":"bact_strep","24":"0","25":"0","26":"0","27":"1","28":"0","29":"0","30":"0","31":"0"},{"1":"4.2189209","2":"2.4731677","3":"-3.847601","4":"2.590151062","5":"-3.8476006","6":"2.88102803","7":"-0.803078150","8":"-3.8476006","9":"0.37190712","10":"4.153084","11":"5.71219876","12":"2.76444045","13":"-3.847601","14":"-2.4613062","15":"0.6956941943","16":"-1.768159046","17":"-0.95722883","18":"-2.238163","19":"1.81535989","20":"-0.21001443","21":"-3.8476006","22":"-0.41144634","23":"bact_strep","24":"0","25":"0","26":"0","27":"1","28":"0","29":"1","30":"0","31":"0"},{"1":"4.2836345","2":"2.5144333","3":"-3.985354","4":"2.925397049","5":"-3.9853537","6":"2.25492211","7":"-0.374435826","8":"-3.9853537","9":"1.05159886","10":"3.784869","11":"5.51773087","12":"2.06201844","13":"-3.985354","14":"-2.3759158","15":"0.3321343749","16":"-1.682768646","17":"-1.42040438","18":"-2.599059","19":"1.65655333","20":"-0.20116410","21":"-1.7881292","22":"0.61361028","23":"bact_strep","24":"0","25":"0","26":"0","27":"1","28":"0","29":"0","30":"1","31":"0"},{"1":"3.4790425","2":"2.4557689","3":"-4.244962","4":"1.731388734","5":"-4.2449622","6":"4.31777783","7":"-0.843764794","8":"-4.2449622","9":"0.68951176","10":"3.915270","11":"5.53239510","12":"3.94733156","13":"-3.551815","14":"-1.6059048","15":"0.5753193901","16":"-2.858667814","17":"-0.33293917","18":"-2.299052","19":"2.01270541","20":"-0.18451916","21":"-4.2449622","22":"0.38581992","23":"bact_strep","24":"0","25":"0","26":"0","27":"0","28":"1","29":"0","30":"0","31":"0"},{"1":"4.2999913","2":"2.6450103","3":"-3.848744","4":"2.978885727","5":"-3.8487435","6":"2.88584815","7":"-0.211157348","8":"-3.8487435","9":"0.31013958","10":"3.986440","11":"5.79888358","12":"2.83836510","13":"-3.848744","14":"-2.4624491","15":"0.5820732910","16":"-2.462449147","17":"-1.14069331","18":"-2.239306","19":"1.61931663","20":"-0.18518186","21":"-3.8487435","22":"-0.24060357","23":"bact_strep","24":"0","25":"0","26":"0","27":"0","28":"1","29":"1","30":"0","31":"0"},{"1":"4.3742665","2":"2.7167663","3":"-3.661660","4":"3.171371827","5":"-3.6616599","6":"2.31469100","7":"-0.165152344","8":"-3.6616599","9":"0.75718070","10":"3.774368","11":"5.53255108","12":"2.16434020","13":"-3.661660","14":"-2.5630476","15":"0.5430327137","16":"-1.582218364","17":"-1.09671055","18":"-3.661660","19":"2.10666109","20":"-0.07814097","21":"-3.6616599","22":"0.15802956","23":"bact_strep","24":"0","25":"0","26":"0","27":"0","28":"1","29":"0","30":"1","31":"0"},{"1":"5.0397545","2":"2.4100086","3":"-3.692550","4":"3.297706478","5":"-3.6925500","6":"5.26560411","7":"-0.748111044","8":"-3.6925500","9":"1.79224691","10":"4.548626","11":"-3.69255002","12":"3.64503772","13":"-3.692550","14":"-3.6925500","15":"1.0523821056","16":"-3.692550023","17":"1.17498443","18":"-1.900791","19":"3.05033061","20":"0.91262016","21":"-3.6925500","22":"0.21497715","23":"bact_strep","24":"0","25":"0","26":"0","27":"0","28":"0","29":"0","30":"0","31":"1"},{"1":"4.8108580","2":"2.0682275","3":"-3.817877","4":"3.311420990","5":"-3.8178766","6":"5.24477554","7":"-0.128997104","8":"-3.8178766","9":"1.17255603","10":"4.553134","11":"-0.08020694","12":"2.62625470","13":"-3.817877","14":"-3.8178766","15":"0.3092578265","16":"-3.817876559","17":"-0.12899710","18":"-2.431582","19":"3.13866888","20":"2.25976568","21":"-3.8178766","22":"0.27192474","23":"bact_strep","24":"0","25":"0","26":"0","27":"0","28":"0","29":"1","30":"0","31":"1"},{"1":"-1.1229290","2":"1.9831514","3":"-3.607836","4":"3.900951561","5":"-3.6078356","6":"5.91797222","7":"0.220805787","8":"-3.6078356","9":"2.50805652","10":"3.483074","11":"-2.50922332","12":"4.24226794","13":"-3.607836","14":"-3.6078356","15":"1.1628490151","16":"-0.774622265","17":"0.68262383","18":"-2.509223","19":"3.77863524","20":"0.68262383","21":"-3.6078356","22":"-0.35449875","23":"bact_strep","24":"1","25":"0","26":"0","27":"0","28":"0","29":"0","30":"0","31":"1"},{"1":"-0.9052017","2":"2.1152232","3":"-3.677790","4":"4.433837647","5":"-3.6777904","6":"5.63040234","7":"-0.276593049","8":"-3.6777904","9":"2.33102275","10":"3.602907","11":"-0.63326799","12":"4.26172483","13":"-3.677790","14":"-3.6777904","15":"0.1508509654","16":"-1.375205338","17":"0.10639920","18":"-1.886031","19":"3.35218248","20":"1.15849148","21":"-3.6777904","22":"-0.29755116","23":"bact_strep","24":"1","25":"0","26":"0","27":"0","28":"0","29":"1","30":"0","31":"1"},{"1":"-0.9977428","2":"2.0015545","3":"-3.636800","4":"4.836650122","5":"-3.6368001","6":"5.33515613","7":"-0.378703608","8":"-3.6368001","9":"1.94669616","10":"3.311137","11":"-1.23890487","12":"3.71049955","13":"-3.636800","14":"-1.6908900","15":"0.1008694721","16":"-1.238904873","17":"-0.54575769","18":"-1.845041","19":"3.31017585","20":"1.56720654","21":"-3.6368001","22":"0.15802956","23":"bact_strep","24":"1","25":"0","26":"0","27":"0","28":"0","29":"0","30":"1","31":"1"},{"1":"-3.6563453","2":"2.0204085","3":"-3.656345","4":"3.049293808","5":"-3.6563453","6":"5.80755144","7":"0.533309455","8":"-3.6563453","9":"1.82845165","10":"3.865514","11":"-0.47829146","12":"4.61443573","13":"-3.656345","14":"-3.6563453","15":"1.2852971354","16":"-0.072826349","17":"0.35098790","18":"-2.270051","19":"3.84914699","20":"1.21118916","21":"-3.6563453","22":"-0.35449875","23":"bact_strep","24":"0","25":"1","26":"0","27":"0","28":"0","29":"0","30":"0","31":"1"},{"1":"-1.0439977","2":"2.0758467","3":"-3.683055","4":"2.666083914","5":"-3.6830551","6":"5.25927512","7":"0.078145038","8":"-3.6830551","9":"2.10077010","10":"3.640116","11":"-1.38046998","12":"4.75898344","13":"-3.683055","14":"-3.6830551","15":"0.7357855303","16":"0.188145933","17":"-0.04546892","18":"-1.737145","19":"3.47468041","20":"1.32758022","21":"-3.6830551","22":"-0.01281321","23":"bact_strep","24":"0","25":"1","26":"0","27":"0","28":"0","29":"0","30":"1","31":"1"},{"1":"-2.1172519","2":"2.5461872","3":"-3.503546","4":"0.827187121","5":"-3.5035462","6":"5.62958908","7":"-0.207709354","8":"-3.5035462","9":"2.03771733","10":"4.179857","11":"-0.61317446","12":"5.21609790","13":"-3.503546","14":"-3.5035462","15":"1.8763511338","16":"-1.894108307","17":"0.70114640","18":"-1.306322","19":"3.41514900","20":"0.73056028","21":"-3.5035462","22":"-0.41144634","23":"bact_strep","24":"0","25":"0","26":"1","27":"0","28":"0","29":"0","30":"0","31":"1"},{"1":"1.1619139","2":"0.4687667","3":"-1.322993","4":"1.672739513","5":"-1.3229928","6":"3.93450261","7":"-0.629845580","8":"-1.3229928","9":"0.75644878","10":"1.672740","11":"1.93510378","12":"2.50564864","13":"-1.322993","14":"-1.3229928","15":"-1.3229927604","16":"-1.322992760","17":"-1.32299276","18":"-1.322993","19":"1.07490251","20":"-1.32299276","21":"-1.3229928","22":"-4.11303969","23":"bact_strep","24":"0","25":"0","26":"1","27":"0","28":"0","29":"1","30":"0","31":"1"},{"1":"-0.7290464","2":"2.6031581","3":"-2.808488","4":"0.880391497","5":"-2.8084880","6":"6.30446007","7":"-2.808487957","8":"-2.8084880","9":"2.95670315","10":"3.800861","11":"0.88039150","12":"4.70248980","13":"-2.808488","14":"-2.8084880","15":"-2.1153407763","16":"-2.808487957","17":"-0.16943063","18":"-2.808488","19":"4.14996044","20":"2.01179361","21":"-2.8084880","22":"0.27192474","23":"bact_strep","24":"0","25":"0","26":"1","27":"0","28":"0","29":"0","30":"1","31":"1"},{"1":"-1.0641224","2":"2.3066158","3":"-3.366708","4":"3.665033751","5":"-3.3667075","6":"5.66330931","7":"-0.231213292","8":"-3.3667075","9":"2.91929059","10":"4.003523","11":"-0.27566505","12":"4.80404392","13":"-3.366708","14":"-3.3667075","15":"0.0005883224","16":"-1.574948038","17":"-0.59411879","18":"-2.268095","19":"1.48532276","20":"1.36068031","21":"-3.3667075","22":"-0.46839393","23":"bact_strep","24":"0","25":"0","26":"0","27":"1","28":"0","29":"1","30":"0","31":"1"},{"1":"-1.4637394","2":"2.2874439","3":"-3.409650","4":"4.168495932","5":"-3.4096495","6":"5.52940690","7":"-0.008452159","8":"-3.4096495","9":"2.62103572","10":"3.703493","11":"0.05608636","12":"4.49836990","13":"-3.409650","14":"-3.4096495","15":"0.2792299133","16":"-1.463739392","17":"-0.51927778","18":"-3.409650","19":"2.51993960","20":"1.65925466","21":"-3.4096495","22":"0.15802956","23":"bact_strep","24":"0","25":"0","26":"0","27":"1","28":"0","29":"0","30":"1","31":"1"},{"1":"-3.3733949","2":"2.4437163","3":"-3.373395","4":"3.215531600","5":"-3.3733949","6":"4.91488817","7":"-0.377662604","8":"-3.3733949","9":"3.05471040","10":"4.063811","11":"5.71973729","12":"4.11992237","13":"-3.373395","14":"-3.3733949","15":"0.4767527243","16":"-3.373394877","17":"0.97041054","18":"-3.373395","19":"2.49307318","20":"-0.73433755","21":"-3.3733949","22":"-0.58228911","23":"bact_strep","24":"0","25":"0","26":"0","27":"0","28":"1","29":"0","30":"0","31":"1"},{"1":"-0.9980623","2":"2.5596638","3":"-3.482969","4":"3.403562659","5":"-3.4829690","6":"4.20731704","7":"-0.843911654","8":"-3.4829690","9":"2.79555244","10":"3.601257","11":"5.72817107","12":"3.82020107","13":"-3.482969","14":"-3.4829690","15":"-0.5385300046","16":"-2.789821803","17":"0.20591047","18":"-1.180384","19":"1.15176000","20":"-0.22487245","21":"-3.4829690","22":"-0.75313188","23":"bact_strep","24":"0","25":"0","26":"0","27":"0","28":"1","29":"1","30":"0","31":"1"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
<section id="sec-specs" class="level3" data-number="5.1.3">
<h3 data-number="5.1.3" class="anchored" data-anchor-id="sec-specs"><span class="header-section-number">5.1.3</span> Model specifications</h3>
<p>The process of specifying models is:</p>
<ol type="1">
<li>Pick a model type</li>
<li>Set the engine</li>
<li>Set the mode: regression or classification</li>
</ol>
<div class="cell">
<details open="" class="code-fold">
<summary>Show/hide code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="fu">library</span>(rules)</span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="fu">library</span>(baguette)</span>
<span id="cb15-3"><a href="#cb15-3"></a></span>
<span id="cb15-4"><a href="#cb15-4"></a>svm_r_spec <span class="ot">&lt;-</span> </span>
<span id="cb15-5"><a href="#cb15-5"></a>   parsnip<span class="sc">::</span><span class="fu">svm_rbf</span>(<span class="at">cost =</span> <span class="fu">tune</span>(), <span class="at">rbf_sigma =</span> <span class="fu">tune</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb15-6"><a href="#cb15-6"></a>   parsnip<span class="sc">::</span><span class="fu">set_engine</span>(<span class="st">"kernlab"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-7"><a href="#cb15-7"></a>   parsnip<span class="sc">::</span><span class="fu">set_mode</span>(<span class="st">"classification"</span>)</span>
<span id="cb15-8"><a href="#cb15-8"></a></span>
<span id="cb15-9"><a href="#cb15-9"></a>svm_p_spec <span class="ot">&lt;-</span> </span>
<span id="cb15-10"><a href="#cb15-10"></a>   parsnip<span class="sc">::</span><span class="fu">svm_poly</span>(<span class="at">cost =</span> <span class="fu">tune</span>(), <span class="at">degree =</span> <span class="fu">tune</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb15-11"><a href="#cb15-11"></a>   parsnip<span class="sc">::</span><span class="fu">set_engine</span>(<span class="st">"kernlab"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-12"><a href="#cb15-12"></a>   parsnip<span class="sc">::</span><span class="fu">set_mode</span>(<span class="st">"classification"</span>)</span>
<span id="cb15-13"><a href="#cb15-13"></a></span>
<span id="cb15-14"><a href="#cb15-14"></a>cart_spec <span class="ot">&lt;-</span> </span>
<span id="cb15-15"><a href="#cb15-15"></a>   parsnip<span class="sc">::</span><span class="fu">decision_tree</span>(<span class="at">cost_complexity =</span> <span class="fu">tune</span>(), <span class="at">min_n =</span> <span class="fu">tune</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb15-16"><a href="#cb15-16"></a>   parsnip<span class="sc">::</span><span class="fu">set_engine</span>(<span class="st">"rpart"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-17"><a href="#cb15-17"></a>   parsnip<span class="sc">::</span><span class="fu">set_mode</span>(<span class="st">"classification"</span>)</span>
<span id="cb15-18"><a href="#cb15-18"></a></span>
<span id="cb15-19"><a href="#cb15-19"></a>bag_cart_spec <span class="ot">&lt;-</span> </span>
<span id="cb15-20"><a href="#cb15-20"></a>   parsnip<span class="sc">::</span><span class="fu">bag_tree</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb15-21"><a href="#cb15-21"></a>   parsnip<span class="sc">::</span><span class="fu">set_engine</span>(<span class="st">"rpart"</span>, <span class="at">times =</span> <span class="dv">50</span>L) <span class="sc">%&gt;%</span> </span>
<span id="cb15-22"><a href="#cb15-22"></a>   parsnip<span class="sc">::</span><span class="fu">set_mode</span>(<span class="st">"classification"</span>)</span>
<span id="cb15-23"><a href="#cb15-23"></a></span>
<span id="cb15-24"><a href="#cb15-24"></a>rf_spec <span class="ot">&lt;-</span> </span>
<span id="cb15-25"><a href="#cb15-25"></a>   parsnip<span class="sc">::</span><span class="fu">rand_forest</span>(<span class="at">mtry =</span> <span class="fu">tune</span>(), <span class="at">min_n =</span> <span class="fu">tune</span>(), <span class="at">trees =</span> <span class="dv">1000</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-26"><a href="#cb15-26"></a>   parsnip<span class="sc">::</span><span class="fu">set_engine</span>(<span class="st">"ranger"</span>, <span class="at">importance =</span> <span class="st">"impurity"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-27"><a href="#cb15-27"></a>   parsnip<span class="sc">::</span><span class="fu">set_mode</span>(<span class="st">"classification"</span>)</span>
<span id="cb15-28"><a href="#cb15-28"></a></span>
<span id="cb15-29"><a href="#cb15-29"></a>xgb_spec <span class="ot">&lt;-</span> </span>
<span id="cb15-30"><a href="#cb15-30"></a>   parsnip<span class="sc">::</span><span class="fu">boost_tree</span>(<span class="at">tree_depth =</span> <span class="fu">tune</span>(), <span class="at">learn_rate =</span> <span class="fu">tune</span>(), <span class="at">loss_reduction =</span> <span class="fu">tune</span>(), </span>
<span id="cb15-31"><a href="#cb15-31"></a>              <span class="at">min_n =</span> <span class="fu">tune</span>(), <span class="at">sample_size =</span> <span class="fu">tune</span>(), <span class="at">trees =</span> <span class="fu">tune</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb15-32"><a href="#cb15-32"></a>   parsnip<span class="sc">::</span><span class="fu">set_engine</span>(<span class="st">"xgboost"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-33"><a href="#cb15-33"></a>   parsnip<span class="sc">::</span><span class="fu">set_mode</span>(<span class="st">"classification"</span>)</span>
<span id="cb15-34"><a href="#cb15-34"></a></span>
<span id="cb15-35"><a href="#cb15-35"></a>nnet_spec <span class="ot">&lt;-</span> </span>
<span id="cb15-36"><a href="#cb15-36"></a>   parsnip<span class="sc">::</span><span class="fu">mlp</span>(<span class="at">hidden_units =</span> <span class="fu">tune</span>(), <span class="at">penalty =</span> <span class="fu">tune</span>(), <span class="at">epochs =</span> <span class="fu">tune</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb15-37"><a href="#cb15-37"></a>   parsnip<span class="sc">::</span><span class="fu">set_engine</span>(<span class="st">"nnet"</span>, <span class="at">MaxNWts =</span> <span class="dv">2600</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-38"><a href="#cb15-38"></a>   parsnip<span class="sc">::</span><span class="fu">set_mode</span>(<span class="st">"classification"</span>)</span>
<span id="cb15-39"><a href="#cb15-39"></a></span>
<span id="cb15-40"><a href="#cb15-40"></a>fda_spec <span class="ot">&lt;-</span> </span>
<span id="cb15-41"><a href="#cb15-41"></a>   parsnip<span class="sc">::</span><span class="fu">discrim_flexible</span>(<span class="at">prod_degree =</span> <span class="fu">tune</span>()) <span class="sc">%&gt;%</span>  <span class="co">#&lt;- use GCV to choose terms</span></span>
<span id="cb15-42"><a href="#cb15-42"></a>   parsnip<span class="sc">::</span><span class="fu">set_engine</span>(<span class="st">"earth"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-43"><a href="#cb15-43"></a>   parsnip<span class="sc">::</span><span class="fu">set_mode</span>(<span class="st">"classification"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="sec-wf" class="level3" data-number="5.1.4">
<h3 data-number="5.1.4" class="anchored" data-anchor-id="sec-wf"><span class="header-section-number">5.1.4</span> Create workflow set</h3>
<p>Now we need to specify the workflows that will be followed for the different model types</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show/hide code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>balclr_3c_wf <span class="ot">&lt;-</span> </span>
<span id="cb16-2"><a href="#cb16-2"></a>   workflowsets<span class="sc">::</span><span class="fu">workflow_set</span>(</span>
<span id="cb16-3"><a href="#cb16-3"></a>      <span class="at">preproc =</span> <span class="fu">list</span>(<span class="at">balclr_3c =</span> balclr_3c_rec), </span>
<span id="cb16-4"><a href="#cb16-4"></a>      <span class="at">models =</span> <span class="fu">list</span>(</span>
<span id="cb16-5"><a href="#cb16-5"></a>        <span class="at">SVM_radial =</span> svm_r_spec, </span>
<span id="cb16-6"><a href="#cb16-6"></a>        <span class="at">SVM_poly =</span> svm_p_spec, </span>
<span id="cb16-7"><a href="#cb16-7"></a>        <span class="at">CART =</span> cart_spec, </span>
<span id="cb16-8"><a href="#cb16-8"></a>        <span class="at">CART_bagged =</span> bag_cart_spec,</span>
<span id="cb16-9"><a href="#cb16-9"></a>        <span class="at">NNET =</span> nnet_spec,</span>
<span id="cb16-10"><a href="#cb16-10"></a>        <span class="at">boosting =</span> xgb_spec,</span>
<span id="cb16-11"><a href="#cb16-11"></a>        <span class="at">fda =</span> fda_spec,</span>
<span id="cb16-12"><a href="#cb16-12"></a>        <span class="at">RF =</span> rf_spec)</span>
<span id="cb16-13"><a href="#cb16-13"></a>   )</span>
<span id="cb16-14"><a href="#cb16-14"></a></span>
<span id="cb16-15"><a href="#cb16-15"></a>balclr_3c_wf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["wflow_id"],"name":[1],"type":["chr"],"align":["left"]},{"label":["info"],"name":[2],"type":["list"],"align":["right"]},{"label":["option"],"name":[3],"type":["list"],"align":["right"]},{"label":["result"],"name":[4],"type":["list"],"align":["right"]}],"data":[{"1":"balclr_3c_SVM_radial","2":"<tibble[,4]>","3":"<wrkflw__>","4":"<list [0]>"},{"1":"balclr_3c_SVM_poly","2":"<tibble[,4]>","3":"<wrkflw__>","4":"<list [0]>"},{"1":"balclr_3c_CART","2":"<tibble[,4]>","3":"<wrkflw__>","4":"<list [0]>"},{"1":"balclr_3c_CART_bagged","2":"<tibble[,4]>","3":"<wrkflw__>","4":"<list [0]>"},{"1":"balclr_3c_NNET","2":"<tibble[,4]>","3":"<wrkflw__>","4":"<list [0]>"},{"1":"balclr_3c_boosting","2":"<tibble[,4]>","3":"<wrkflw__>","4":"<list [0]>"},{"1":"balclr_3c_fda","2":"<tibble[,4]>","3":"<wrkflw__>","4":"<list [0]>"},{"1":"balclr_3c_RF","2":"<tibble[,4]>","3":"<wrkflw__>","4":"<list [0]>"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
<section id="sec-tune" class="level3" data-number="5.1.5">
<h3 data-number="5.1.5" class="anchored" data-anchor-id="sec-tune"><span class="header-section-number">5.1.5</span> Tune</h3>
<p>Train and test performance for all the different models over the different train/test and 5-fold cv splits. This takes a long time to run…</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show/hide code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>balclr_3c_grid_results <span class="ot">&lt;-</span></span>
<span id="cb17-2"><a href="#cb17-2"></a>   workflowsets<span class="sc">::</span><span class="fu">workflow_map</span>(balclr_3c_wf, </span>
<span id="cb17-3"><a href="#cb17-3"></a>      <span class="at">seed =</span> <span class="dv">1578</span>,</span>
<span id="cb17-4"><a href="#cb17-4"></a>      <span class="at">resamples =</span> balclr_3c_folds,</span>
<span id="cb17-5"><a href="#cb17-5"></a>      <span class="at">grid =</span> <span class="dv">15</span>,</span>
<span id="cb17-6"><a href="#cb17-6"></a>      <span class="at">control =</span> tune<span class="sc">::</span><span class="fu">control_grid</span>(<span class="at">save_pred =</span> <span class="cn">TRUE</span>, <span class="at">parallel_over =</span> <span class="st">"everything"</span>, <span class="at">save_workflow =</span> <span class="cn">TRUE</span>),</span>
<span id="cb17-7"><a href="#cb17-7"></a>      <span class="at">metrics =</span> yardstick<span class="sc">::</span><span class="fu">metric_set</span>(recall, precision, f_meas, j_index, accuracy, kap, roc_auc, sens, spec),</span>
<span id="cb17-8"><a href="#cb17-8"></a>   )</span>
<span id="cb17-9"><a href="#cb17-9"></a></span>
<span id="cb17-10"><a href="#cb17-10"></a><span class="co"># save this for later</span></span>
<span id="cb17-11"><a href="#cb17-11"></a>readr<span class="sc">::</span><span class="fu">write_rds</span>(balclr_3c_grid_results, here<span class="sc">::</span><span class="fu">here</span>(data_ml, <span class="st">"model_tune_3_class.rds"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="best-tuning-parameters-and-best-performing-models" class="level3" data-number="5.1.6">
<h3 data-number="5.1.6" class="anchored" data-anchor-id="best-tuning-parameters-and-best-performing-models"><span class="header-section-number">5.1.6</span> Best tuning parameters and best performing models</h3>
<p>First look at which of the models performed best according to area under the reciever operator curve</p>
<details open="" class="code-fold">
<summary>Show/hide code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a>mymetric <span class="ot">&lt;-</span> <span class="st">"roc_auc"</span></span>
<span id="cb18-2"><a href="#cb18-2"></a></span>
<span id="cb18-3"><a href="#cb18-3"></a>tune<span class="sc">::</span><span class="fu">autoplot</span>(</span>
<span id="cb18-4"><a href="#cb18-4"></a>  <span class="co"># bart fails must filter out</span></span>
<span id="cb18-5"><a href="#cb18-5"></a>  <span class="fu">filter</span>(balclr_3c_grid_results, wflow_id <span class="sc">!=</span> <span class="st">"balclr_3c_bart"</span>),</span>
<span id="cb18-6"><a href="#cb18-6"></a>  <span class="at">rank_metric =</span> mymetric,  </span>
<span id="cb18-7"><a href="#cb18-7"></a>  <span class="at">metric =</span> mymetric,       </span>
<span id="cb18-8"><a href="#cb18-8"></a>  <span class="co"># one point per workflow </span></span>
<span id="cb18-9"><a href="#cb18-9"></a>  <span class="at">select_best =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb18-10"><a href="#cb18-10"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">y =</span> mean <span class="sc">+</span> <span class="fl">0.15</span>, <span class="at">label =</span> wflow_id), <span class="at">angle =</span> <span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb18-11"><a href="#cb18-11"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-01" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-01-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="01_machine_learn_home_env_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-01-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Mean and standard deviation across train-test splits of the areas under the receiver operator curves for the different models. SVM_radial = Radial kernel Support Vector Classifier, SVM_poly = Polynomial kernel Support Vector Classifier, CART = classification and regression tree, CART_bagged = classification and regression tree with bootstrap aggregation (bagging), NNET = Neural Network Classifier, boosting = Gradient Boosted Trees Classifier (XGBoost), FDA = Flexible discriminant analysis (FDA) using MARS features, RF = Random Forest Classifier (Ranger).
</figcaption>
</figure>
</div>
<section id="peformance-metrics" class="level4" data-number="5.1.6.1">
<h4 data-number="5.1.6.1" class="anchored" data-anchor-id="peformance-metrics"><span class="header-section-number">5.1.6.1</span> Peformance metrics</h4>
<p>Defines a function for easily extracting metrics of interest</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show/hide code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a>getmymetrics <span class="ot">&lt;-</span> <span class="cf">function</span>(gridresults, myworkflow, mymetric, mysplit){</span>
<span id="cb19-2"><a href="#cb19-2"></a>  best_results <span class="ot">&lt;-</span> gridresults <span class="sc">%&gt;%</span> </span>
<span id="cb19-3"><a href="#cb19-3"></a>   workflowsets<span class="sc">::</span><span class="fu">extract_workflow_set_result</span>(myworkflow) <span class="sc">%&gt;%</span> </span>
<span id="cb19-4"><a href="#cb19-4"></a>   tune<span class="sc">::</span><span class="fu">select_best</span>(<span class="at">metric =</span> mymetric)</span>
<span id="cb19-5"><a href="#cb19-5"></a>  </span>
<span id="cb19-6"><a href="#cb19-6"></a>   gridresults <span class="sc">%&gt;%</span> </span>
<span id="cb19-7"><a href="#cb19-7"></a>     hardhat<span class="sc">::</span><span class="fu">extract_workflow</span>(myworkflow) <span class="sc">%&gt;%</span> </span>
<span id="cb19-8"><a href="#cb19-8"></a>     tune<span class="sc">::</span><span class="fu">finalize_workflow</span>(best_results) <span class="sc">%&gt;%</span> </span>
<span id="cb19-9"><a href="#cb19-9"></a>     tune<span class="sc">::</span><span class="fu">last_fit</span>(<span class="at">split =</span> mysplit,</span>
<span id="cb19-10"><a href="#cb19-10"></a>             <span class="at">metrics =</span> yardstick<span class="sc">::</span><span class="fu">metric_set</span>(recall, precision, f_meas, j_index, accuracy, kap, roc_auc, sens, spec))</span>
<span id="cb19-11"><a href="#cb19-11"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Call the function to get performance metrics of different models</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show/hide code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="fu">set.seed</span>(<span class="dv">23784</span>)</span>
<span id="cb20-2"><a href="#cb20-2"></a>balclr_3c_SVM_radial_test_results <span class="ot">&lt;-</span> <span class="fu">getmymetrics</span>(balclr_3c_grid_results,</span>
<span id="cb20-3"><a href="#cb20-3"></a>                                                <span class="st">"balclr_3c_SVM_radial"</span>,</span>
<span id="cb20-4"><a href="#cb20-4"></a>                                                <span class="st">"roc_auc"</span>,</span>
<span id="cb20-5"><a href="#cb20-5"></a>                                                balclr_3c_split)</span>
<span id="cb20-6"><a href="#cb20-6"></a></span>
<span id="cb20-7"><a href="#cb20-7"></a>balclr_3c_SVM_poly_test_results <span class="ot">&lt;-</span> <span class="fu">getmymetrics</span>(balclr_3c_grid_results,</span>
<span id="cb20-8"><a href="#cb20-8"></a>                                                <span class="st">"balclr_3c_SVM_poly"</span>,</span>
<span id="cb20-9"><a href="#cb20-9"></a>                                                <span class="st">"roc_auc"</span>,</span>
<span id="cb20-10"><a href="#cb20-10"></a>                                                balclr_3c_split)</span>
<span id="cb20-11"><a href="#cb20-11"></a></span>
<span id="cb20-12"><a href="#cb20-12"></a>balclr_3c_CART_test_results <span class="ot">&lt;-</span> <span class="fu">getmymetrics</span>(balclr_3c_grid_results,</span>
<span id="cb20-13"><a href="#cb20-13"></a>                                                <span class="st">"balclr_3c_CART"</span>,</span>
<span id="cb20-14"><a href="#cb20-14"></a>                                                <span class="st">"roc_auc"</span>,</span>
<span id="cb20-15"><a href="#cb20-15"></a>                                                balclr_3c_split)</span>
<span id="cb20-16"><a href="#cb20-16"></a></span>
<span id="cb20-17"><a href="#cb20-17"></a>balclr_3c_CART_bagged_test_results <span class="ot">&lt;-</span> <span class="fu">getmymetrics</span>(balclr_3c_grid_results,</span>
<span id="cb20-18"><a href="#cb20-18"></a>                                                <span class="st">"balclr_3c_CART_bagged"</span>,</span>
<span id="cb20-19"><a href="#cb20-19"></a>                                                <span class="st">"roc_auc"</span>,</span>
<span id="cb20-20"><a href="#cb20-20"></a>                                                balclr_3c_split)</span>
<span id="cb20-21"><a href="#cb20-21"></a></span>
<span id="cb20-22"><a href="#cb20-22"></a>balclr_3c_NNET_test_results <span class="ot">&lt;-</span> <span class="fu">getmymetrics</span>(balclr_3c_grid_results,</span>
<span id="cb20-23"><a href="#cb20-23"></a>                                                <span class="st">"balclr_3c_NNET"</span>,</span>
<span id="cb20-24"><a href="#cb20-24"></a>                                                <span class="st">"roc_auc"</span>,</span>
<span id="cb20-25"><a href="#cb20-25"></a>                                                balclr_3c_split)</span>
<span id="cb20-26"><a href="#cb20-26"></a></span>
<span id="cb20-27"><a href="#cb20-27"></a>balclr_3c_boosting_test_results <span class="ot">&lt;-</span> <span class="fu">getmymetrics</span>(balclr_3c_grid_results,</span>
<span id="cb20-28"><a href="#cb20-28"></a>                                                <span class="st">"balclr_3c_boosting"</span>,</span>
<span id="cb20-29"><a href="#cb20-29"></a>                                                <span class="st">"roc_auc"</span>,</span>
<span id="cb20-30"><a href="#cb20-30"></a>                                                balclr_3c_split)</span>
<span id="cb20-31"><a href="#cb20-31"></a></span>
<span id="cb20-32"><a href="#cb20-32"></a>balclr_3c_fda_test_results <span class="ot">&lt;-</span> <span class="fu">getmymetrics</span>(balclr_3c_grid_results,</span>
<span id="cb20-33"><a href="#cb20-33"></a>                                          <span class="st">"balclr_3c_fda"</span>,</span>
<span id="cb20-34"><a href="#cb20-34"></a>                                          <span class="st">"roc_auc"</span>,</span>
<span id="cb20-35"><a href="#cb20-35"></a>                                          balclr_3c_split)</span>
<span id="cb20-36"><a href="#cb20-36"></a></span>
<span id="cb20-37"><a href="#cb20-37"></a>balclr_3c_rf_test_results <span class="ot">&lt;-</span> <span class="fu">getmymetrics</span>(balclr_3c_grid_results,</span>
<span id="cb20-38"><a href="#cb20-38"></a>                                          <span class="st">"balclr_3c_RF"</span>,</span>
<span id="cb20-39"><a href="#cb20-39"></a>                                          <span class="st">"roc_auc"</span>,</span>
<span id="cb20-40"><a href="#cb20-40"></a>                                          balclr_3c_split)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Defines a function to collect and format metrics of different models and calls the function on all the different trained models</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show/hide code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a>collect_format <span class="ot">&lt;-</span> <span class="cf">function</span>(res, name){</span>
<span id="cb21-2"><a href="#cb21-2"></a>  tune<span class="sc">::</span><span class="fu">collect_metrics</span>(res) <span class="sc">%&gt;%</span></span>
<span id="cb21-3"><a href="#cb21-3"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="at">metric =</span> .metric,</span>
<span id="cb21-4"><a href="#cb21-4"></a>                {{ name }} <span class="sc">:</span><span class="er">=</span> .estimate,</span>
<span id="cb21-5"><a href="#cb21-5"></a>                <span class="at">estimate_type =</span> .estimator)</span>
<span id="cb21-6"><a href="#cb21-6"></a>}</span>
<span id="cb21-7"><a href="#cb21-7"></a></span>
<span id="cb21-8"><a href="#cb21-8"></a><span class="fu">collect_format</span>(balclr_3c_SVM_radial_test_results, <span class="st">"SVM_rad"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb21-9"><a href="#cb21-9"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(<span class="fu">collect_format</span>(balclr_3c_SVM_poly_test_results, <span class="st">"SVM_poly"</span>), <span class="at">by =</span> <span class="fu">join_by</span>(metric, estimate_type)) <span class="sc">%&gt;%</span></span>
<span id="cb21-10"><a href="#cb21-10"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(<span class="fu">collect_format</span>(balclr_3c_CART_test_results, <span class="st">"CART"</span>), <span class="at">by =</span> <span class="fu">join_by</span>(metric, estimate_type)) <span class="sc">%&gt;%</span></span>
<span id="cb21-11"><a href="#cb21-11"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(<span class="fu">collect_format</span>(balclr_3c_CART_bagged_test_results, <span class="st">"CART_bag"</span>), <span class="at">by =</span> <span class="fu">join_by</span>(metric, estimate_type)) <span class="sc">%&gt;%</span></span>
<span id="cb21-12"><a href="#cb21-12"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(<span class="fu">collect_format</span>(balclr_3c_NNET_test_results, <span class="st">"NNET"</span>), <span class="at">by =</span> <span class="fu">join_by</span>(metric, estimate_type)) <span class="sc">%&gt;%</span></span>
<span id="cb21-13"><a href="#cb21-13"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(<span class="fu">collect_format</span>(balclr_3c_boosting_test_results, <span class="st">"boosting"</span>), <span class="at">by =</span> <span class="fu">join_by</span>(metric, estimate_type)) <span class="sc">%&gt;%</span></span>
<span id="cb21-14"><a href="#cb21-14"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(<span class="fu">collect_format</span>(balclr_3c_fda_test_results, <span class="st">"FDA"</span>), <span class="at">by =</span> <span class="fu">join_by</span>(metric, estimate_type)) <span class="sc">%&gt;%</span> </span>
<span id="cb21-15"><a href="#cb21-15"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(<span class="fu">collect_format</span>(balclr_3c_rf_test_results, <span class="st">"random_forest"</span>), <span class="at">by =</span> <span class="fu">join_by</span>(metric, estimate_type)) <span class="sc">%&gt;%</span> </span>
<span id="cb21-16"><a href="#cb21-16"></a>  dplyr<span class="sc">::</span><span class="fu">relocate</span>(estimate_type, metric)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["estimate_type"],"name":[1],"type":["chr"],"align":["left"]},{"label":["metric"],"name":[2],"type":["chr"],"align":["left"]},{"label":["SVM_rad"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["SVM_poly"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["CART"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["CART_bag"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["NNET"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["boosting"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["FDA"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["random_forest"],"name":[10],"type":["dbl"],"align":["right"]}],"data":[{"1":"macro","2":"recall","3":"0.8518519","4":"0.8518519","5":"0.7037037","6":"0.8888889","7":"0.9259259","8":"0.9259259","9":"0.8888889","10":"0.8518519"},{"1":"macro","2":"precision","3":"0.8614719","4":"0.8974359","5":"0.7702020","6":"0.8962963","7":"0.9393939","8":"0.9259259","9":"0.8962963","10":"0.8666667"},{"1":"macro","2":"f_meas","3":"0.8500000","4":"0.8531194","5":"0.6940171","6":"0.8907235","7":"0.9274510","8":"0.9259259","9":"0.8907235","10":"0.8530702"},{"1":"macro","2":"j_index","3":"0.7777778","4":"0.7777778","5":"0.5555556","6":"0.8333333","7":"0.8888889","8":"0.8888889","9":"0.8333333","10":"0.7777778"},{"1":"multiclass","2":"accuracy","3":"0.8518519","4":"0.8518519","5":"0.7037037","6":"0.8888889","7":"0.9259259","8":"0.9259259","9":"0.8888889","10":"0.8518519"},{"1":"multiclass","2":"kap","3":"0.7777778","4":"0.7777778","5":"0.5555556","6":"0.8333333","7":"0.8888889","8":"0.8888889","9":"0.8333333","10":"0.7777778"},{"1":"macro","2":"sens","3":"0.8518519","4":"0.8518519","5":"0.7037037","6":"0.8888889","7":"0.9259259","8":"0.9259259","9":"0.8888889","10":"0.8518519"},{"1":"macro","2":"spec","3":"0.9259259","4":"0.9259259","5":"0.8518519","6":"0.9444444","7":"0.9629630","8":"0.9629630","9":"0.9444444","10":"0.9259259"},{"1":"hand_till","2":"roc_auc","3":"0.9794239","4":"0.8271605","5":"0.8179012","6":"0.9578189","7":"0.9917695","8":"0.9567901","9":"0.9691358","10":"0.9547325"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Overall it looks like Gradient boosting is performing the best so we will go with that model</p>
</section>
<section id="roc-curve-for-chosen-model" class="level4" data-number="5.1.6.2">
<h4 data-number="5.1.6.2" class="anchored" data-anchor-id="roc-curve-for-chosen-model"><span class="header-section-number">5.1.6.2</span> ROC-curve for chosen model</h4>
<p><a href="https://www.nature.com/articles/nmeth.3945">This is a useful resource</a> for understanding ROC curves and PR curves.</p>
<p>ROC curves here indicate that there is quite good performance for the gradient boosting model in distinguishing the evolutionary history of any particular microcosm from the experiment!</p>
<details open="" class="code-fold">
<summary>Show/hide code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a>balclr_3c_boosting_test_results <span class="sc">%&gt;%</span> </span>
<span id="cb22-2"><a href="#cb22-2"></a>  tune<span class="sc">::</span><span class="fu">collect_predictions</span>() <span class="sc">%&gt;%</span></span>
<span id="cb22-3"><a href="#cb22-3"></a>  yardstick<span class="sc">::</span><span class="fu">roc_curve</span>(home_env_3c, .pred_anc<span class="sc">:</span>.pred_bact_strep) <span class="sc">%&gt;%</span> </span>
<span id="cb22-4"><a href="#cb22-4"></a>  tune<span class="sc">::</span><span class="fu">autoplot</span>() <span class="sc">+</span></span>
<span id="cb22-5"><a href="#cb22-5"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"FP rate"</span>, <span class="at">y =</span> <span class="st">"TP rate"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-02" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-02-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="01_machine_learn_home_env_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-02-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: ROC curve for True positive rate (TPR, vertical axis) versus the false positive rate (FPR, horizontal axis) for the three different evolutionary histories in the experiment from the hold-out testing data. The dashed 1:1 line is the expected performance of a random classifier. Curves above the 1:1 are better performance than random. Curves below 1:1 are worse performance than random.
</figcaption>
</figure>
</div>
<details open="" class="code-fold">
<summary>Show/hide code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a>balclr_3c_boosting_test_results <span class="sc">%&gt;%</span> </span>
<span id="cb23-2"><a href="#cb23-2"></a>  tune<span class="sc">::</span><span class="fu">collect_predictions</span>() <span class="sc">%&gt;%</span></span>
<span id="cb23-3"><a href="#cb23-3"></a>  yardstick<span class="sc">::</span><span class="fu">pr_curve</span>(home_env_3c, .pred_anc<span class="sc">:</span>.pred_bact_strep) <span class="sc">%&gt;%</span> </span>
<span id="cb23-4"><a href="#cb23-4"></a>  tune<span class="sc">::</span><span class="fu">autoplot</span>() <span class="sc">+</span></span>
<span id="cb23-5"><a href="#cb23-5"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Recall"</span>, <span class="at">y =</span> <span class="st">"Precision"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-03" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-03-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="01_machine_learn_home_env_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-03-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Precision recall curves for the three different evolutionary histories in the experiment from the hold-out testing data. There is a good tuorial for interpretation of these plots on <a href="https://scikit-learn.org/1.5/auto_examples/model_selection/plot_precision_recall.html">scikit-learn</a>. All of them suggest good performance.
</figcaption>
</figure>
</div>
</section>
<section id="confusion-matrix" class="level4" data-number="5.1.6.3">
<h4 data-number="5.1.6.3" class="anchored" data-anchor-id="confusion-matrix"><span class="header-section-number">5.1.6.3</span> Confusion matrix</h4>
<p>The confusion matrix shows that the model is doing a very nice job predicting whether the community had an ancestral origin while there are only two mixups for the other two classes combined. Again this is quite good performance…</p>
<details open="" class="code-fold">
<summary>Show/hide code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a>balclr_3c_boosting_test_results <span class="sc">%&gt;%</span> </span>
<span id="cb24-2"><a href="#cb24-2"></a>  tune<span class="sc">::</span><span class="fu">collect_predictions</span>() <span class="sc">%&gt;%</span></span>
<span id="cb24-3"><a href="#cb24-3"></a>  yardstick<span class="sc">::</span><span class="fu">conf_mat</span>(home_env_3c, .pred_class) <span class="sc">%&gt;%</span></span>
<span id="cb24-4"><a href="#cb24-4"></a>  tune<span class="sc">::</span><span class="fu">autoplot</span>(<span class="at">type =</span> <span class="st">"heatmap"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-04" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-04-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="01_machine_learn_home_env_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-04-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Confusion matrix showing the classifier performance on each of the three evolutionary history classes using the hold-out testing data.
</figcaption>
</figure>
</div>
</section>
<section id="probability-distributions-for-the-3-classes" class="level4" data-number="5.1.6.4">
<h4 data-number="5.1.6.4" class="anchored" data-anchor-id="probability-distributions-for-the-3-classes"><span class="header-section-number">5.1.6.4</span> Probability distributions for the 3 classes</h4>
<p>Gradient boosting trees give each prediction a probability for every class. The higher the probability the higher the confidence in the prediction. We can visualize the distribution of these prediction probabilities to get some insight as to which classes the model has trouble distinguishing and which are very clearly separated.</p>
<details open="" class="code-fold">
<summary>Show/hide code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a>balclr_3c_boosting_test_results <span class="sc">%&gt;%</span></span>
<span id="cb25-2"><a href="#cb25-2"></a>  tune<span class="sc">::</span><span class="fu">collect_predictions</span>() <span class="sc">%&gt;%</span></span>
<span id="cb25-3"><a href="#cb25-3"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="fu">c</span>(</span>
<span id="cb25-4"><a href="#cb25-4"></a>    .pred_anc,</span>
<span id="cb25-5"><a href="#cb25-5"></a>    .pred_bact,</span>
<span id="cb25-6"><a href="#cb25-6"></a>    .pred_bact_strep</span>
<span id="cb25-7"><a href="#cb25-7"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="cb25-8"><a href="#cb25-8"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb25-9"><a href="#cb25-9"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">fill =</span> home_env_3c), <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb25-10"><a href="#cb25-10"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Prediction Probability"</span>, <span class="at">y =</span> <span class="st">"Density"</span>) <span class="sc">+</span></span>
<span id="cb25-11"><a href="#cb25-11"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_wrap</span>( <span class="sc">~</span> name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-05" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-05-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="01_machine_learn_home_env_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-05-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: Prediction probability densities (colors) for each observation of the three evolutionary history classes (grid columns) tested with the model.
</figcaption>
</figure>
</div>
</section>
</section>
</section>
</section>
<section id="conclusion" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Conclusion</h1>
<p>Our Gradient Boosting model seems to be performing pretty well here… We can conclude that there is sufficient signal in the community composition data to distinguish the evolutionary history of the species used to inoculate the experiment.</p>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb26" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb26-1"><a href="#cb26-1"></a><span class="co">---</span></span>
<span id="cb26-2"><a href="#cb26-2"></a><span class="an">title:</span><span class="co"> "Machine learning evolutionary history from community structure"</span></span>
<span id="cb26-3"><a href="#cb26-3"></a><span class="an">subtitle:</span><span class="co"> "From the STR community composition workflow"</span></span>
<span id="cb26-4"><a href="#cb26-4"></a><span class="an">author:</span><span class="co"> "Shane Hogle"</span></span>
<span id="cb26-5"><a href="#cb26-5"></a><span class="an">date:</span><span class="co"> today</span></span>
<span id="cb26-6"><a href="#cb26-6"></a><span class="an">abstract:</span><span class="co"> "Here we ask whether there is a signal of the evolutionary history of each community in its response to the different experimental treatmensts. If we can use a machine learning algorithm to skillfully classify the evolutionary history of each treatment then it implies that there is a signal of the past in the present community structure."</span></span>
<span id="cb26-7"><a href="#cb26-7"></a><span class="co">---</span></span>
<span id="cb26-8"><a href="#cb26-8"></a></span>
<span id="cb26-9"><a href="#cb26-9"></a><span class="fu"># Setup </span></span>
<span id="cb26-10"><a href="#cb26-10"></a></span>
<span id="cb26-11"><a href="#cb26-11"></a>Loads required libraries and sets global variables</span>
<span id="cb26-12"><a href="#cb26-12"></a></span>
<span id="cb26-15"><a href="#cb26-15"></a><span class="in">```{r}</span></span>
<span id="cb26-16"><a href="#cb26-16"></a><span class="co">#| output: false</span></span>
<span id="cb26-17"><a href="#cb26-17"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb26-18"><a href="#cb26-18"></a><span class="fu">library</span>(here)</span>
<span id="cb26-19"><a href="#cb26-19"></a><span class="fu">library</span>(fs)</span>
<span id="cb26-20"><a href="#cb26-20"></a><span class="fu">source</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"R"</span>, <span class="st">"utils_generic.R"</span>))</span>
<span id="cb26-21"><a href="#cb26-21"></a><span class="in">```</span></span>
<span id="cb26-22"><a href="#cb26-22"></a></span>
<span id="cb26-23"><a href="#cb26-23"></a><span class="fu"># Read</span></span>
<span id="cb26-24"><a href="#cb26-24"></a></span>
<span id="cb26-25"><a href="#cb26-25"></a>Read and format 16S amplicon data</span>
<span id="cb26-26"><a href="#cb26-26"></a></span>
<span id="cb26-29"><a href="#cb26-29"></a><span class="in">```{r}</span></span>
<span id="cb26-30"><a href="#cb26-30"></a><span class="co">#| output: false</span></span>
<span id="cb26-31"><a href="#cb26-31"></a><span class="co">#| warning: false</span></span>
<span id="cb26-32"><a href="#cb26-32"></a>sptable <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_tsv</span>(here<span class="sc">::</span><span class="fu">here</span>(data_sp, <span class="st">"species_counts_md.tsv"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb26-33"><a href="#cb26-33"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">transfer =</span> day<span class="sc">/</span><span class="dv">7</span>)</span>
<span id="cb26-34"><a href="#cb26-34"></a></span>
<span id="cb26-35"><a href="#cb26-35"></a>counts_f <span class="ot">&lt;-</span> sptable <span class="sc">%&gt;%</span> </span>
<span id="cb26-36"><a href="#cb26-36"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(sample) <span class="sc">%&gt;%</span> </span>
<span id="cb26-37"><a href="#cb26-37"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">f=</span>count_correct<span class="sc">/</span><span class="fu">sum</span>(count_correct)) <span class="sc">%&gt;%</span> </span>
<span id="cb26-38"><a href="#cb26-38"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb26-39"><a href="#cb26-39"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">measure_env_short =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb26-40"><a href="#cb26-40"></a>                                      measure_env <span class="sc">==</span> <span class="st">"bact"</span> <span class="sc">~</span> <span class="st">"Meas: B"</span>,</span>
<span id="cb26-41"><a href="#cb26-41"></a>                                      measure_env <span class="sc">==</span> <span class="st">"bact_strep"</span> <span class="sc">~</span> <span class="st">"Meas: BS"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb26-42"><a href="#cb26-42"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">home_env_short =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb26-43"><a href="#cb26-43"></a>                                    evolution_env <span class="sc">==</span> <span class="st">"anc"</span> <span class="sc">~</span> <span class="st">"Home: Anc"</span>,</span>
<span id="cb26-44"><a href="#cb26-44"></a>                                    evolution_env <span class="sc">==</span> <span class="st">"bact"</span> <span class="sc">~</span> <span class="st">"Home: B"</span>,</span>
<span id="cb26-45"><a href="#cb26-45"></a>                                    evolution_env <span class="sc">==</span> <span class="st">"bact_strep"</span> <span class="sc">~</span> <span class="st">"Home: BS"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb26-46"><a href="#cb26-46"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">measure_env_short =</span> <span class="fu">factor</span>(measure_env_short, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Meas: B"</span>, <span class="st">"Meas: BS"</span>)),</span>
<span id="cb26-47"><a href="#cb26-47"></a>         <span class="at">home_env_short =</span> <span class="fu">factor</span>(home_env_short, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Home: Anc"</span>, <span class="st">"Home: B"</span>, <span class="st">"Home: BS"</span>)),</span>
<span id="cb26-48"><a href="#cb26-48"></a>         <span class="at">day =</span> <span class="fu">factor</span>(day),</span>
<span id="cb26-49"><a href="#cb26-49"></a>         <span class="at">replicate =</span> <span class="fu">factor</span>(replicate),</span>
<span id="cb26-50"><a href="#cb26-50"></a>         <span class="at">strainID =</span> <span class="fu">factor</span>(strainID, <span class="at">levels =</span> <span class="fu">names</span>(hambi_colors)))</span>
<span id="cb26-51"><a href="#cb26-51"></a><span class="in">```</span></span>
<span id="cb26-52"><a href="#cb26-52"></a></span>
<span id="cb26-53"><a href="#cb26-53"></a>Read population density data</span>
<span id="cb26-54"><a href="#cb26-54"></a></span>
<span id="cb26-57"><a href="#cb26-57"></a><span class="in">```{r}</span></span>
<span id="cb26-58"><a href="#cb26-58"></a><span class="co">#| output: false</span></span>
<span id="cb26-59"><a href="#cb26-59"></a>celldens <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_tsv</span>(here<span class="sc">::</span><span class="fu">here</span>(data_ml, <span class="st">"density4ML.tsv"</span>))</span>
<span id="cb26-60"><a href="#cb26-60"></a><span class="in">```</span></span>
<span id="cb26-61"><a href="#cb26-61"></a></span>
<span id="cb26-62"><a href="#cb26-62"></a><span class="fu"># Data formatting</span></span>
<span id="cb26-63"><a href="#cb26-63"></a></span>
<span id="cb26-64"><a href="#cb26-64"></a>Separate the samples to only include those from the experiment. These are the samples that will be used in the machine learning pipeline</span>
<span id="cb26-65"><a href="#cb26-65"></a></span>
<span id="cb26-68"><a href="#cb26-68"></a><span class="in">```{r}</span></span>
<span id="cb26-69"><a href="#cb26-69"></a><span class="co"># these are communities of a (supposedly) known composition. Can be used with metacal</span></span>
<span id="cb26-70"><a href="#cb26-70"></a>pos_ctrl_samples <span class="ot">&lt;-</span> counts_f <span class="sc">%&gt;%</span> </span>
<span id="cb26-71"><a href="#cb26-71"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">str_detect</span>(sample, <span class="st">"pos_ctrl"</span>))</span>
<span id="cb26-72"><a href="#cb26-72"></a></span>
<span id="cb26-73"><a href="#cb26-73"></a><span class="co"># these are samples taken directly from YSK and represent the composition of the communities used to start the experiment</span></span>
<span id="cb26-74"><a href="#cb26-74"></a>t0_samples <span class="ot">&lt;-</span> counts_f <span class="sc">%&gt;%</span> </span>
<span id="cb26-75"><a href="#cb26-75"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">str_detect</span>(sample, <span class="st">"pos_ctrl"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb26-76"><a href="#cb26-76"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(day <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb26-77"><a href="#cb26-77"></a></span>
<span id="cb26-78"><a href="#cb26-78"></a><span class="co"># only samples from the experiment</span></span>
<span id="cb26-79"><a href="#cb26-79"></a>counts_f_experiment <span class="ot">&lt;-</span> <span class="fu">anti_join</span>(counts_f, pos_ctrl_samples, </span>
<span id="cb26-80"><a href="#cb26-80"></a>                                 <span class="at">by =</span> <span class="fu">join_by</span>(sample, strainID, genus, species, count, count_correct, replicate, </span>
<span id="cb26-81"><a href="#cb26-81"></a>                                              day, measure_env, evolution_env, transfer, f, </span>
<span id="cb26-82"><a href="#cb26-82"></a>                                              measure_env_short, home_env_short)) <span class="sc">%&gt;%</span> </span>
<span id="cb26-83"><a href="#cb26-83"></a>  dplyr<span class="sc">::</span><span class="fu">anti_join</span>(., t0_samples, </span>
<span id="cb26-84"><a href="#cb26-84"></a>                   <span class="at">by =</span> <span class="fu">join_by</span>(sample, strainID, genus, species, count, count_correct, </span>
<span id="cb26-85"><a href="#cb26-85"></a>                                replicate, day, measure_env, evolution_env, transfer, f, </span>
<span id="cb26-86"><a href="#cb26-86"></a>                                measure_env_short, home_env_short)) <span class="sc">%&gt;%</span> </span>
<span id="cb26-87"><a href="#cb26-87"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">measure_env_short =</span> <span class="fu">factor</span>(measure_env_short, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Meas: B"</span>, <span class="st">"Meas: BS"</span>)),</span>
<span id="cb26-88"><a href="#cb26-88"></a>         <span class="at">home_env_short =</span> <span class="fu">factor</span>(home_env_short, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Home: Anc"</span>, <span class="st">"Home: B"</span>, <span class="st">"Home: BS"</span>)),</span>
<span id="cb26-89"><a href="#cb26-89"></a>         <span class="at">day =</span> <span class="fu">factor</span>(day),</span>
<span id="cb26-90"><a href="#cb26-90"></a>         <span class="at">replicate =</span> <span class="fu">factor</span>(replicate),</span>
<span id="cb26-91"><a href="#cb26-91"></a>         <span class="at">strainID =</span> <span class="fu">factor</span>(strainID, <span class="at">levels =</span> <span class="fu">names</span>(hambi_colors)))</span>
<span id="cb26-92"><a href="#cb26-92"></a><span class="in">```</span></span>
<span id="cb26-93"><a href="#cb26-93"></a></span>
<span id="cb26-94"><a href="#cb26-94"></a><span class="fu"># Data normalization</span></span>
<span id="cb26-95"><a href="#cb26-95"></a></span>
<span id="cb26-96"><a href="#cb26-96"></a>Here we'll use the same filtering criteria as in <span class="co">[</span><span class="ot">the t-SNE analysis from section 3 of the last analysis.</span><span class="co">](../amplicon_sp_counts/02_composition_analysis.qmd)</span></span>
<span id="cb26-97"><a href="#cb26-97"></a></span>
<span id="cb26-100"><a href="#cb26-100"></a><span class="in">```{r}</span></span>
<span id="cb26-101"><a href="#cb26-101"></a>counts_f_experiment <span class="sc">%&gt;%</span> </span>
<span id="cb26-102"><a href="#cb26-102"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(strainID) <span class="sc">%&gt;%</span> </span>
<span id="cb26-103"><a href="#cb26-103"></a>  dplyr<span class="sc">::</span><span class="fu">summarize</span>(<span class="at">n_samples =</span> <span class="fu">n</span>(),</span>
<span id="cb26-104"><a href="#cb26-104"></a>            <span class="at">n_gt0 =</span> <span class="fu">sum</span>(count <span class="sc">&gt;</span> <span class="dv">0</span>),</span>
<span id="cb26-105"><a href="#cb26-105"></a>            <span class="at">p_gt0 =</span> n_gt0 <span class="sc">/</span> n_samples) <span class="sc">%&gt;%</span> </span>
<span id="cb26-106"><a href="#cb26-106"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb26-107"><a href="#cb26-107"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(n_gt0)</span>
<span id="cb26-108"><a href="#cb26-108"></a><span class="in">```</span></span>
<span id="cb26-109"><a href="#cb26-109"></a></span>
<span id="cb26-110"><a href="#cb26-110"></a>Briefly, we will use the <span class="co">[</span><span class="ot">centered log-ratio transformation</span><span class="co">](https://en.wikipedia.org/wiki/Compositional_data#Center_log_ratio_transform)</span> for the species abundances. The centered log-ratio can be interpreted as the log-fold change of species i relative to the average microbe in a sample. The formula for the transformation is:</span>
<span id="cb26-111"><a href="#cb26-111"></a></span>
<span id="cb26-112"><a href="#cb26-112"></a>$$</span>
<span id="cb26-113"><a href="#cb26-113"></a>\text{clr}(\mathbf x)= \left(log</span>
<span id="cb26-114"><a href="#cb26-114"></a>\frac{x_i}{g(\mathbf x)} \right)_{i=1,...,D} \qquad \text{with} \quad</span>
<span id="cb26-115"><a href="#cb26-115"></a>g(\mathbf x) = \left(\prod_{i=1}^Dx_i\right)^{1/D} =</span>
<span id="cb26-116"><a href="#cb26-116"></a>\exp\left(\frac{1}{D}\sum_{i=1}^D \log x_i\right)\text{,}</span>
<span id="cb26-117"><a href="#cb26-117"></a>$$</span>
<span id="cb26-118"><a href="#cb26-118"></a></span>
<span id="cb26-119"><a href="#cb26-119"></a>We will use the implementation of centered log-ratio transform in the <span class="in">`compositions`</span> package</span>
<span id="cb26-120"><a href="#cb26-120"></a></span>
<span id="cb26-123"><a href="#cb26-123"></a><span class="in">```{r}</span></span>
<span id="cb26-124"><a href="#cb26-124"></a><span class="fu">set.seed</span>(<span class="dv">12353</span>)</span>
<span id="cb26-125"><a href="#cb26-125"></a></span>
<span id="cb26-126"><a href="#cb26-126"></a>lowstrainsv <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb26-127"><a href="#cb26-127"></a>  <span class="st">"HAMBI_0097"</span>,</span>
<span id="cb26-128"><a href="#cb26-128"></a>  <span class="st">"HAMBI_2792"</span></span>
<span id="cb26-129"><a href="#cb26-129"></a>)</span>
<span id="cb26-130"><a href="#cb26-130"></a></span>
<span id="cb26-131"><a href="#cb26-131"></a>mymat <span class="ot">&lt;-</span> counts_f_experiment <span class="sc">%&gt;%</span> </span>
<span id="cb26-132"><a href="#cb26-132"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span>(strainID <span class="sc">%in%</span> lowstrainsv)) <span class="sc">%&gt;%</span> </span>
<span id="cb26-133"><a href="#cb26-133"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(sample, strainID, count) <span class="sc">%&gt;%</span> </span>
<span id="cb26-134"><a href="#cb26-134"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">count =</span> count <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb26-135"><a href="#cb26-135"></a>  <span class="co"># important to arrange by sample as this makes some later joins easier</span></span>
<span id="cb26-136"><a href="#cb26-136"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(sample) <span class="sc">%&gt;%</span> </span>
<span id="cb26-137"><a href="#cb26-137"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">"strainID"</span>, <span class="at">values_from =</span> <span class="st">"count"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb26-138"><a href="#cb26-138"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="at">var =</span> <span class="st">"sample"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb26-139"><a href="#cb26-139"></a>  <span class="fu">data.frame</span>()</span>
<span id="cb26-140"><a href="#cb26-140"></a></span>
<span id="cb26-141"><a href="#cb26-141"></a><span class="co"># calculate clr transform</span></span>
<span id="cb26-142"><a href="#cb26-142"></a>balclr <span class="ot">&lt;-</span> compositions<span class="sc">::</span><span class="fu">clr</span>(mymat)</span>
<span id="cb26-143"><a href="#cb26-143"></a><span class="in">```</span></span>
<span id="cb26-144"><a href="#cb26-144"></a></span>
<span id="cb26-145"><a href="#cb26-145"></a><span class="fu"># Machine learning the home environment</span></span>
<span id="cb26-146"><a href="#cb26-146"></a></span>
<span id="cb26-147"><a href="#cb26-147"></a>The goal is to see if we can reliably predict which home environment a community came from (either ancestral clonal, or co-evolved in YSK) using only the species abundances, knowledge of the experiment structure (e.g., replicate and experimental transfer), and the measurement environment. The motivation behind this is that if we can learn the evolutionary home environment there must be some kind of "ecological signal" embedded in the community data that is a function of the evolutionary home environment. We are using machine learning approaches because they are flexible, powerful, and we are most interested in prediction. We care less about which features/variables are driving the signal...</span>
<span id="cb26-148"><a href="#cb26-148"></a></span>
<span id="cb26-149"><a href="#cb26-149"></a>Load the <span class="in">`tidymodels`</span> ecosystem. We are using <span class="co">[</span><span class="ot">`tidymodels`</span><span class="co">](https://www.tidymodels.org/)</span> because it allows us to work with familiar <span class="in">`tidyverse`</span> syntax while making sure we adhere to best practices in training and assessing the performance of machine learning models.</span>
<span id="cb26-150"><a href="#cb26-150"></a></span>
<span id="cb26-153"><a href="#cb26-153"></a><span class="in">```{r}</span></span>
<span id="cb26-154"><a href="#cb26-154"></a><span class="co">#| output: false</span></span>
<span id="cb26-155"><a href="#cb26-155"></a><span class="co">#| warning: false</span></span>
<span id="cb26-156"><a href="#cb26-156"></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb26-157"><a href="#cb26-157"></a><span class="fu">library</span>(discrim)</span>
<span id="cb26-158"><a href="#cb26-158"></a><span class="fu">library</span>(themis)</span>
<span id="cb26-159"><a href="#cb26-159"></a><span class="fu">tidymodels_prefer</span>()</span>
<span id="cb26-160"><a href="#cb26-160"></a><span class="in">```</span></span>
<span id="cb26-161"><a href="#cb26-161"></a></span>
<span id="cb26-162"><a href="#cb26-162"></a>First doing some basic data preparations. We will create some additional classification structures that we will investigate further below</span>
<span id="cb26-163"><a href="#cb26-163"></a></span>
<span id="cb26-166"><a href="#cb26-166"></a><span class="in">```{r}</span></span>
<span id="cb26-167"><a href="#cb26-167"></a>balclr_md <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(balclr) <span class="sc">%&gt;%</span></span>
<span id="cb26-168"><a href="#cb26-168"></a>  tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"sample"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb26-169"><a href="#cb26-169"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(<span class="fu">distinct</span>(dplyr<span class="sc">::</span><span class="fu">select</span>(counts_f_experiment, sample, replicate, transfer, measure_env, evolution_env)), </span>
<span id="cb26-170"><a href="#cb26-170"></a>                   <span class="at">by =</span> <span class="fu">join_by</span>(sample)) <span class="sc">%&gt;%</span></span>
<span id="cb26-171"><a href="#cb26-171"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(celldens, <span class="at">by =</span> <span class="fu">join_by</span>(replicate, transfer, measure_env, evolution_env)) <span class="sc">%&gt;%</span> </span>
<span id="cb26-172"><a href="#cb26-172"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">replicate =</span> <span class="fu">factor</span>(replicate),</span>
<span id="cb26-173"><a href="#cb26-173"></a>         <span class="at">transfer =</span> <span class="fu">factor</span>(transfer),</span>
<span id="cb26-174"><a href="#cb26-174"></a>         <span class="at">measure_env =</span> <span class="fu">factor</span>(measure_env),</span>
<span id="cb26-175"><a href="#cb26-175"></a>         <span class="at">home_env_3c =</span> <span class="fu">factor</span>(evolution_env),</span>
<span id="cb26-176"><a href="#cb26-176"></a>         <span class="co"># whether sample is from YSK or not</span></span>
<span id="cb26-177"><a href="#cb26-177"></a>         <span class="at">home_env_ae =</span> <span class="fu">factor</span>(<span class="fu">if_else</span>(evolution_env <span class="sc">==</span> <span class="st">"anc"</span>, <span class="st">"anc"</span>, <span class="st">"evo"</span>)),</span>
<span id="cb26-178"><a href="#cb26-178"></a>         <span class="co"># whether sample had streptomycin present</span></span>
<span id="cb26-179"><a href="#cb26-179"></a>         <span class="at">home_env_sns =</span> <span class="fu">factor</span>(<span class="fu">case_when</span>(evolution_env <span class="sc">==</span> <span class="st">"bact_strep"</span> <span class="sc">~</span> <span class="st">"strep"</span>, </span>
<span id="cb26-180"><a href="#cb26-180"></a>                                         evolution_env <span class="sc">==</span> <span class="st">"anc"</span> <span class="sc">~</span> <span class="cn">NA_character_</span>,</span>
<span id="cb26-181"><a href="#cb26-181"></a>                                         <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"nostrep"</span>))) <span class="sc">%&gt;%</span>  </span>
<span id="cb26-182"><a href="#cb26-182"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>sample, <span class="sc">-</span>evolution_env)</span>
<span id="cb26-183"><a href="#cb26-183"></a><span class="in">```</span></span>
<span id="cb26-184"><a href="#cb26-184"></a></span>
<span id="cb26-185"><a href="#cb26-185"></a><span class="fu">## 3 classes (ancestral, B, BS)</span></span>
<span id="cb26-186"><a href="#cb26-186"></a></span>
<span id="cb26-187"><a href="#cb26-187"></a>First were going to try and predict all 3 different home evolution environments. We are going to train and analyze the performance of many different types of models</span>
<span id="cb26-188"><a href="#cb26-188"></a></span>
<span id="cb26-189"><a href="#cb26-189"></a><span class="fu">### Spliting {#sec-split}</span></span>
<span id="cb26-190"><a href="#cb26-190"></a></span>
<span id="cb26-191"><a href="#cb26-191"></a>Split the data using the default 3:1 ratio of training-to-test. Here we also set the strata argument. This argument makes sure that both sides of the split have roughly the same distribution for each value of strata. If a numeric variable is passed to strata then it is binned and distributions are matched within bins. In this case there will be roughly the same distribution of the 3 classes within each side of the test/train split.</span>
<span id="cb26-192"><a href="#cb26-192"></a></span>
<span id="cb26-195"><a href="#cb26-195"></a><span class="in">```{r}</span></span>
<span id="cb26-196"><a href="#cb26-196"></a>balclr_3c <span class="ot">&lt;-</span> balclr_md <span class="sc">%&gt;%</span> </span>
<span id="cb26-197"><a href="#cb26-197"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>home_env_ae, <span class="sc">-</span>home_env_sns) <span class="sc">%&gt;%</span> </span>
<span id="cb26-198"><a href="#cb26-198"></a>  tidyr<span class="sc">::</span><span class="fu">drop_na</span>()</span>
<span id="cb26-199"><a href="#cb26-199"></a></span>
<span id="cb26-200"><a href="#cb26-200"></a><span class="fu">table</span>(balclr_3c<span class="sc">$</span>home_env_3c)</span>
<span id="cb26-201"><a href="#cb26-201"></a><span class="in">```</span></span>
<span id="cb26-202"><a href="#cb26-202"></a></span>
<span id="cb26-203"><a href="#cb26-203"></a>The data is balanced</span>
<span id="cb26-204"><a href="#cb26-204"></a></span>
<span id="cb26-207"><a href="#cb26-207"></a><span class="in">```{r}</span></span>
<span id="cb26-208"><a href="#cb26-208"></a><span class="fu">set.seed</span>(<span class="dv">1501</span>)</span>
<span id="cb26-209"><a href="#cb26-209"></a>balclr_3c_split <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">initial_split</span>(balclr_3c, <span class="at">strata =</span> home_env_3c)</span>
<span id="cb26-210"><a href="#cb26-210"></a>balclr_3c_train <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">training</span>(balclr_3c_split)</span>
<span id="cb26-211"><a href="#cb26-211"></a>balclr_3c_test  <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">testing</span>(balclr_3c_split)</span>
<span id="cb26-212"><a href="#cb26-212"></a><span class="in">```</span></span>
<span id="cb26-213"><a href="#cb26-213"></a></span>
<span id="cb26-214"><a href="#cb26-214"></a>Resample the training set using five repeats of 10-fold cross-validation</span>
<span id="cb26-215"><a href="#cb26-215"></a></span>
<span id="cb26-218"><a href="#cb26-218"></a><span class="in">```{r}</span></span>
<span id="cb26-219"><a href="#cb26-219"></a><span class="fu">set.seed</span>(<span class="dv">1502</span>)</span>
<span id="cb26-220"><a href="#cb26-220"></a>balclr_3c_folds <span class="ot">&lt;-</span> rsample<span class="sc">::</span><span class="fu">vfold_cv</span>(balclr_3c_train, <span class="at">strata =</span> home_env_3c)</span>
<span id="cb26-221"><a href="#cb26-221"></a><span class="in">```</span></span>
<span id="cb26-222"><a href="#cb26-222"></a></span>
<span id="cb26-223"><a href="#cb26-223"></a><span class="fu">### Recipe {#sec-recipe}</span></span>
<span id="cb26-224"><a href="#cb26-224"></a></span>
<span id="cb26-225"><a href="#cb26-225"></a>First we need to preprocess the data so that it is in optimal format for Ml. Some useful steps include:</span>
<span id="cb26-226"><a href="#cb26-226"></a></span>
<span id="cb26-227"><a href="#cb26-227"></a><span class="ss">- </span><span class="in">`step_novel():`</span> converts all nominal variables to factors and takes care of other issues related to categorical variables.</span>
<span id="cb26-228"><a href="#cb26-228"></a><span class="ss">- </span><span class="in">`step_normalize():`</span> normalizes (center and scales) the numeric variables to have a standard deviation of one and a mean of zero. (i.e., z-standardization).</span>
<span id="cb26-229"><a href="#cb26-229"></a><span class="ss">- </span><span class="in">`step_dummy():`</span> converts our factor column ocean_proximity into numeric binary (0 and 1) variables.</span>
<span id="cb26-230"><a href="#cb26-230"></a><span class="ss">  - </span>Note that this step may cause problems if your categorical variable has too many levels - especially if some of the levels are very infrequent. In this case you should either drop the variable or pool infrequently occurring values into an “other” category with step_other. This steps has to be performed before step_dummy.</span>
<span id="cb26-231"><a href="#cb26-231"></a><span class="ss">- </span><span class="in">`step_zv():`</span> removes any numeric variables that have zero variance.</span>
<span id="cb26-232"><a href="#cb26-232"></a><span class="ss">- </span><span class="in">`step_corr():`</span> will remove predictor variables that have large correlations with other predictor variables.</span>
<span id="cb26-233"><a href="#cb26-233"></a></span>
<span id="cb26-234"><a href="#cb26-234"></a>**Edit: data is already in centered log-ratio transform and further normalization doesn't really help.**</span>
<span id="cb26-235"><a href="#cb26-235"></a></span>
<span id="cb26-238"><a href="#cb26-238"></a><span class="in">```{r}</span></span>
<span id="cb26-239"><a href="#cb26-239"></a>balclr_3c_rec <span class="ot">&lt;-</span> recipes<span class="sc">::</span><span class="fu">recipe</span>(home_env_3c <span class="sc">~</span> ., <span class="at">data =</span> balclr_3c_train) <span class="sc">%&gt;%</span> </span>
<span id="cb26-240"><a href="#cb26-240"></a>  recipes<span class="sc">::</span><span class="fu">step_normalize</span>(od600) <span class="sc">%&gt;%</span> </span>
<span id="cb26-241"><a href="#cb26-241"></a>  recipes<span class="sc">::</span><span class="fu">step_dummy</span>(<span class="fu">all_nominal</span>(), <span class="sc">-</span><span class="fu">all_outcomes</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb26-242"><a href="#cb26-242"></a>  recipes<span class="sc">::</span><span class="fu">step_zv</span>(od600)</span>
<span id="cb26-243"><a href="#cb26-243"></a><span class="in">```</span></span>
<span id="cb26-244"><a href="#cb26-244"></a></span>
<span id="cb26-245"><a href="#cb26-245"></a>You can take a peek at the what the preprocessing recipe does using <span class="in">`prep`</span> and <span class="in">`bake`</span></span>
<span id="cb26-246"><a href="#cb26-246"></a></span>
<span id="cb26-249"><a href="#cb26-249"></a><span class="in">```{r}</span></span>
<span id="cb26-250"><a href="#cb26-250"></a>balclr_3c_rec <span class="sc">%&gt;%</span> </span>
<span id="cb26-251"><a href="#cb26-251"></a>  <span class="co"># perform the recipe on training data</span></span>
<span id="cb26-252"><a href="#cb26-252"></a>  recipes<span class="sc">::</span><span class="fu">prep</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb26-253"><a href="#cb26-253"></a>  <span class="co"># extract only the preprocessed dataframe </span></span>
<span id="cb26-254"><a href="#cb26-254"></a>  recipes<span class="sc">::</span><span class="fu">bake</span>(<span class="at">new_data =</span> <span class="cn">NULL</span>)</span>
<span id="cb26-255"><a href="#cb26-255"></a><span class="in">```</span></span>
<span id="cb26-256"><a href="#cb26-256"></a></span>
<span id="cb26-257"><a href="#cb26-257"></a><span class="fu">### Model specifications  {#sec-specs}</span></span>
<span id="cb26-258"><a href="#cb26-258"></a></span>
<span id="cb26-259"><a href="#cb26-259"></a>The process of specifying models is:</span>
<span id="cb26-260"><a href="#cb26-260"></a></span>
<span id="cb26-261"><a href="#cb26-261"></a><span class="ss">1. </span>Pick a model type</span>
<span id="cb26-262"><a href="#cb26-262"></a><span class="ss">2. </span>Set the engine</span>
<span id="cb26-263"><a href="#cb26-263"></a><span class="ss">3. </span>Set the mode: regression or classification</span>
<span id="cb26-264"><a href="#cb26-264"></a></span>
<span id="cb26-267"><a href="#cb26-267"></a><span class="in">```{r}</span></span>
<span id="cb26-268"><a href="#cb26-268"></a><span class="fu">library</span>(rules)</span>
<span id="cb26-269"><a href="#cb26-269"></a><span class="fu">library</span>(baguette)</span>
<span id="cb26-270"><a href="#cb26-270"></a></span>
<span id="cb26-271"><a href="#cb26-271"></a>svm_r_spec <span class="ot">&lt;-</span> </span>
<span id="cb26-272"><a href="#cb26-272"></a>   parsnip<span class="sc">::</span><span class="fu">svm_rbf</span>(<span class="at">cost =</span> <span class="fu">tune</span>(), <span class="at">rbf_sigma =</span> <span class="fu">tune</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb26-273"><a href="#cb26-273"></a>   parsnip<span class="sc">::</span><span class="fu">set_engine</span>(<span class="st">"kernlab"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb26-274"><a href="#cb26-274"></a>   parsnip<span class="sc">::</span><span class="fu">set_mode</span>(<span class="st">"classification"</span>)</span>
<span id="cb26-275"><a href="#cb26-275"></a></span>
<span id="cb26-276"><a href="#cb26-276"></a>svm_p_spec <span class="ot">&lt;-</span> </span>
<span id="cb26-277"><a href="#cb26-277"></a>   parsnip<span class="sc">::</span><span class="fu">svm_poly</span>(<span class="at">cost =</span> <span class="fu">tune</span>(), <span class="at">degree =</span> <span class="fu">tune</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb26-278"><a href="#cb26-278"></a>   parsnip<span class="sc">::</span><span class="fu">set_engine</span>(<span class="st">"kernlab"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb26-279"><a href="#cb26-279"></a>   parsnip<span class="sc">::</span><span class="fu">set_mode</span>(<span class="st">"classification"</span>)</span>
<span id="cb26-280"><a href="#cb26-280"></a></span>
<span id="cb26-281"><a href="#cb26-281"></a>cart_spec <span class="ot">&lt;-</span> </span>
<span id="cb26-282"><a href="#cb26-282"></a>   parsnip<span class="sc">::</span><span class="fu">decision_tree</span>(<span class="at">cost_complexity =</span> <span class="fu">tune</span>(), <span class="at">min_n =</span> <span class="fu">tune</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb26-283"><a href="#cb26-283"></a>   parsnip<span class="sc">::</span><span class="fu">set_engine</span>(<span class="st">"rpart"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb26-284"><a href="#cb26-284"></a>   parsnip<span class="sc">::</span><span class="fu">set_mode</span>(<span class="st">"classification"</span>)</span>
<span id="cb26-285"><a href="#cb26-285"></a></span>
<span id="cb26-286"><a href="#cb26-286"></a>bag_cart_spec <span class="ot">&lt;-</span> </span>
<span id="cb26-287"><a href="#cb26-287"></a>   parsnip<span class="sc">::</span><span class="fu">bag_tree</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb26-288"><a href="#cb26-288"></a>   parsnip<span class="sc">::</span><span class="fu">set_engine</span>(<span class="st">"rpart"</span>, <span class="at">times =</span> <span class="dv">50</span>L) <span class="sc">%&gt;%</span> </span>
<span id="cb26-289"><a href="#cb26-289"></a>   parsnip<span class="sc">::</span><span class="fu">set_mode</span>(<span class="st">"classification"</span>)</span>
<span id="cb26-290"><a href="#cb26-290"></a></span>
<span id="cb26-291"><a href="#cb26-291"></a>rf_spec <span class="ot">&lt;-</span> </span>
<span id="cb26-292"><a href="#cb26-292"></a>   parsnip<span class="sc">::</span><span class="fu">rand_forest</span>(<span class="at">mtry =</span> <span class="fu">tune</span>(), <span class="at">min_n =</span> <span class="fu">tune</span>(), <span class="at">trees =</span> <span class="dv">1000</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb26-293"><a href="#cb26-293"></a>   parsnip<span class="sc">::</span><span class="fu">set_engine</span>(<span class="st">"ranger"</span>, <span class="at">importance =</span> <span class="st">"impurity"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb26-294"><a href="#cb26-294"></a>   parsnip<span class="sc">::</span><span class="fu">set_mode</span>(<span class="st">"classification"</span>)</span>
<span id="cb26-295"><a href="#cb26-295"></a></span>
<span id="cb26-296"><a href="#cb26-296"></a>xgb_spec <span class="ot">&lt;-</span> </span>
<span id="cb26-297"><a href="#cb26-297"></a>   parsnip<span class="sc">::</span><span class="fu">boost_tree</span>(<span class="at">tree_depth =</span> <span class="fu">tune</span>(), <span class="at">learn_rate =</span> <span class="fu">tune</span>(), <span class="at">loss_reduction =</span> <span class="fu">tune</span>(), </span>
<span id="cb26-298"><a href="#cb26-298"></a>              <span class="at">min_n =</span> <span class="fu">tune</span>(), <span class="at">sample_size =</span> <span class="fu">tune</span>(), <span class="at">trees =</span> <span class="fu">tune</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb26-299"><a href="#cb26-299"></a>   parsnip<span class="sc">::</span><span class="fu">set_engine</span>(<span class="st">"xgboost"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb26-300"><a href="#cb26-300"></a>   parsnip<span class="sc">::</span><span class="fu">set_mode</span>(<span class="st">"classification"</span>)</span>
<span id="cb26-301"><a href="#cb26-301"></a></span>
<span id="cb26-302"><a href="#cb26-302"></a>nnet_spec <span class="ot">&lt;-</span> </span>
<span id="cb26-303"><a href="#cb26-303"></a>   parsnip<span class="sc">::</span><span class="fu">mlp</span>(<span class="at">hidden_units =</span> <span class="fu">tune</span>(), <span class="at">penalty =</span> <span class="fu">tune</span>(), <span class="at">epochs =</span> <span class="fu">tune</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb26-304"><a href="#cb26-304"></a>   parsnip<span class="sc">::</span><span class="fu">set_engine</span>(<span class="st">"nnet"</span>, <span class="at">MaxNWts =</span> <span class="dv">2600</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb26-305"><a href="#cb26-305"></a>   parsnip<span class="sc">::</span><span class="fu">set_mode</span>(<span class="st">"classification"</span>)</span>
<span id="cb26-306"><a href="#cb26-306"></a></span>
<span id="cb26-307"><a href="#cb26-307"></a>fda_spec <span class="ot">&lt;-</span> </span>
<span id="cb26-308"><a href="#cb26-308"></a>   parsnip<span class="sc">::</span><span class="fu">discrim_flexible</span>(<span class="at">prod_degree =</span> <span class="fu">tune</span>()) <span class="sc">%&gt;%</span>  <span class="co">#&lt;- use GCV to choose terms</span></span>
<span id="cb26-309"><a href="#cb26-309"></a>   parsnip<span class="sc">::</span><span class="fu">set_engine</span>(<span class="st">"earth"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb26-310"><a href="#cb26-310"></a>   parsnip<span class="sc">::</span><span class="fu">set_mode</span>(<span class="st">"classification"</span>)</span>
<span id="cb26-311"><a href="#cb26-311"></a><span class="in">```</span></span>
<span id="cb26-312"><a href="#cb26-312"></a></span>
<span id="cb26-313"><a href="#cb26-313"></a><span class="fu">### Create workflow set {#sec-wf}</span></span>
<span id="cb26-314"><a href="#cb26-314"></a></span>
<span id="cb26-315"><a href="#cb26-315"></a>Now we need to specify the workflows that will be followed for the different model types</span>
<span id="cb26-316"><a href="#cb26-316"></a></span>
<span id="cb26-319"><a href="#cb26-319"></a><span class="in">```{r}</span></span>
<span id="cb26-320"><a href="#cb26-320"></a>balclr_3c_wf <span class="ot">&lt;-</span> </span>
<span id="cb26-321"><a href="#cb26-321"></a>   workflowsets<span class="sc">::</span><span class="fu">workflow_set</span>(</span>
<span id="cb26-322"><a href="#cb26-322"></a>      <span class="at">preproc =</span> <span class="fu">list</span>(<span class="at">balclr_3c =</span> balclr_3c_rec), </span>
<span id="cb26-323"><a href="#cb26-323"></a>      <span class="at">models =</span> <span class="fu">list</span>(</span>
<span id="cb26-324"><a href="#cb26-324"></a>        <span class="at">SVM_radial =</span> svm_r_spec, </span>
<span id="cb26-325"><a href="#cb26-325"></a>        <span class="at">SVM_poly =</span> svm_p_spec, </span>
<span id="cb26-326"><a href="#cb26-326"></a>        <span class="at">CART =</span> cart_spec, </span>
<span id="cb26-327"><a href="#cb26-327"></a>        <span class="at">CART_bagged =</span> bag_cart_spec,</span>
<span id="cb26-328"><a href="#cb26-328"></a>        <span class="at">NNET =</span> nnet_spec,</span>
<span id="cb26-329"><a href="#cb26-329"></a>        <span class="at">boosting =</span> xgb_spec,</span>
<span id="cb26-330"><a href="#cb26-330"></a>        <span class="at">fda =</span> fda_spec,</span>
<span id="cb26-331"><a href="#cb26-331"></a>        <span class="at">RF =</span> rf_spec)</span>
<span id="cb26-332"><a href="#cb26-332"></a>   )</span>
<span id="cb26-333"><a href="#cb26-333"></a></span>
<span id="cb26-334"><a href="#cb26-334"></a>balclr_3c_wf</span>
<span id="cb26-335"><a href="#cb26-335"></a><span class="in">```</span></span>
<span id="cb26-336"><a href="#cb26-336"></a></span>
<span id="cb26-337"><a href="#cb26-337"></a><span class="fu">### Tune {#sec-tune}</span></span>
<span id="cb26-338"><a href="#cb26-338"></a></span>
<span id="cb26-339"><a href="#cb26-339"></a>Train and test performance for all the different models over the different train/test and 5-fold cv splits. This takes a long time to run...</span>
<span id="cb26-340"><a href="#cb26-340"></a></span>
<span id="cb26-343"><a href="#cb26-343"></a><span class="in">```{r}</span></span>
<span id="cb26-344"><a href="#cb26-344"></a><span class="co">#| eval: false</span></span>
<span id="cb26-345"><a href="#cb26-345"></a><span class="co">#| echo: true</span></span>
<span id="cb26-346"><a href="#cb26-346"></a>balclr_3c_grid_results <span class="ot">&lt;-</span></span>
<span id="cb26-347"><a href="#cb26-347"></a>   workflowsets<span class="sc">::</span><span class="fu">workflow_map</span>(balclr_3c_wf, </span>
<span id="cb26-348"><a href="#cb26-348"></a>      <span class="at">seed =</span> <span class="dv">1578</span>,</span>
<span id="cb26-349"><a href="#cb26-349"></a>      <span class="at">resamples =</span> balclr_3c_folds,</span>
<span id="cb26-350"><a href="#cb26-350"></a>      <span class="at">grid =</span> <span class="dv">15</span>,</span>
<span id="cb26-351"><a href="#cb26-351"></a>      <span class="at">control =</span> tune<span class="sc">::</span><span class="fu">control_grid</span>(<span class="at">save_pred =</span> <span class="cn">TRUE</span>, <span class="at">parallel_over =</span> <span class="st">"everything"</span>, <span class="at">save_workflow =</span> <span class="cn">TRUE</span>),</span>
<span id="cb26-352"><a href="#cb26-352"></a>      <span class="at">metrics =</span> yardstick<span class="sc">::</span><span class="fu">metric_set</span>(recall, precision, f_meas, j_index, accuracy, kap, roc_auc, sens, spec),</span>
<span id="cb26-353"><a href="#cb26-353"></a>   )</span>
<span id="cb26-354"><a href="#cb26-354"></a></span>
<span id="cb26-355"><a href="#cb26-355"></a><span class="co"># save this for later</span></span>
<span id="cb26-356"><a href="#cb26-356"></a>readr<span class="sc">::</span><span class="fu">write_rds</span>(balclr_3c_grid_results, here<span class="sc">::</span><span class="fu">here</span>(data_ml, <span class="st">"model_tune_3_class.rds"</span>))</span>
<span id="cb26-357"><a href="#cb26-357"></a><span class="in">```</span></span>
<span id="cb26-358"><a href="#cb26-358"></a></span>
<span id="cb26-361"><a href="#cb26-361"></a><span class="in">```{r}</span></span>
<span id="cb26-362"><a href="#cb26-362"></a><span class="co">#| eval: true</span></span>
<span id="cb26-363"><a href="#cb26-363"></a><span class="co">#| echo: false</span></span>
<span id="cb26-364"><a href="#cb26-364"></a>balclr_3c_grid_results <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_rds</span>(here<span class="sc">::</span><span class="fu">here</span>(data_ml, <span class="st">"model_tune_3_class.rds"</span>))</span>
<span id="cb26-365"><a href="#cb26-365"></a><span class="in">```</span></span>
<span id="cb26-366"><a href="#cb26-366"></a></span>
<span id="cb26-367"><a href="#cb26-367"></a><span class="fu">### Best tuning parameters and best performing models</span></span>
<span id="cb26-368"><a href="#cb26-368"></a></span>
<span id="cb26-369"><a href="#cb26-369"></a>First look at which of the models performed best according to area under the reciever operator curve</span>
<span id="cb26-370"><a href="#cb26-370"></a></span>
<span id="cb26-371"><a href="#cb26-371"></a>::: {#fig-01}</span>
<span id="cb26-374"><a href="#cb26-374"></a><span class="in">```{r}</span></span>
<span id="cb26-375"><a href="#cb26-375"></a>mymetric <span class="ot">&lt;-</span> <span class="st">"roc_auc"</span></span>
<span id="cb26-376"><a href="#cb26-376"></a></span>
<span id="cb26-377"><a href="#cb26-377"></a>tune<span class="sc">::</span><span class="fu">autoplot</span>(</span>
<span id="cb26-378"><a href="#cb26-378"></a>  <span class="co"># bart fails must filter out</span></span>
<span id="cb26-379"><a href="#cb26-379"></a>  <span class="fu">filter</span>(balclr_3c_grid_results, wflow_id <span class="sc">!=</span> <span class="st">"balclr_3c_bart"</span>),</span>
<span id="cb26-380"><a href="#cb26-380"></a>  <span class="at">rank_metric =</span> mymetric,  </span>
<span id="cb26-381"><a href="#cb26-381"></a>  <span class="at">metric =</span> mymetric,       </span>
<span id="cb26-382"><a href="#cb26-382"></a>  <span class="co"># one point per workflow </span></span>
<span id="cb26-383"><a href="#cb26-383"></a>  <span class="at">select_best =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb26-384"><a href="#cb26-384"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">y =</span> mean <span class="sc">+</span> <span class="fl">0.15</span>, <span class="at">label =</span> wflow_id), <span class="at">angle =</span> <span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb26-385"><a href="#cb26-385"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb26-386"><a href="#cb26-386"></a><span class="in">```</span></span>
<span id="cb26-387"><a href="#cb26-387"></a>Mean and standard deviation across train-test splits of the areas under the receiver operator curves for the different models.  SVM_radial = Radial kernel Support Vector Classifier, SVM_poly = Polynomial kernel Support Vector Classifier, CART = classification and regression tree, CART_bagged = classification and regression tree with bootstrap aggregation (bagging), NNET = Neural Network Classifier, boosting = Gradient Boosted Trees Classifier (XGBoost), FDA = Flexible discriminant analysis (FDA) using MARS features, RF = Random Forest Classifier (Ranger).</span>
<span id="cb26-388"><a href="#cb26-388"></a>:::</span>
<span id="cb26-389"><a href="#cb26-389"></a></span>
<span id="cb26-390"><a href="#cb26-390"></a><span class="fu">#### Peformance metrics</span></span>
<span id="cb26-391"><a href="#cb26-391"></a></span>
<span id="cb26-392"><a href="#cb26-392"></a>Defines a function for easily extracting metrics of interest</span>
<span id="cb26-393"><a href="#cb26-393"></a></span>
<span id="cb26-396"><a href="#cb26-396"></a><span class="in">```{r}</span></span>
<span id="cb26-397"><a href="#cb26-397"></a>getmymetrics <span class="ot">&lt;-</span> <span class="cf">function</span>(gridresults, myworkflow, mymetric, mysplit){</span>
<span id="cb26-398"><a href="#cb26-398"></a>  best_results <span class="ot">&lt;-</span> gridresults <span class="sc">%&gt;%</span> </span>
<span id="cb26-399"><a href="#cb26-399"></a>   workflowsets<span class="sc">::</span><span class="fu">extract_workflow_set_result</span>(myworkflow) <span class="sc">%&gt;%</span> </span>
<span id="cb26-400"><a href="#cb26-400"></a>   tune<span class="sc">::</span><span class="fu">select_best</span>(<span class="at">metric =</span> mymetric)</span>
<span id="cb26-401"><a href="#cb26-401"></a>  </span>
<span id="cb26-402"><a href="#cb26-402"></a>   gridresults <span class="sc">%&gt;%</span> </span>
<span id="cb26-403"><a href="#cb26-403"></a>     hardhat<span class="sc">::</span><span class="fu">extract_workflow</span>(myworkflow) <span class="sc">%&gt;%</span> </span>
<span id="cb26-404"><a href="#cb26-404"></a>     tune<span class="sc">::</span><span class="fu">finalize_workflow</span>(best_results) <span class="sc">%&gt;%</span> </span>
<span id="cb26-405"><a href="#cb26-405"></a>     tune<span class="sc">::</span><span class="fu">last_fit</span>(<span class="at">split =</span> mysplit,</span>
<span id="cb26-406"><a href="#cb26-406"></a>             <span class="at">metrics =</span> yardstick<span class="sc">::</span><span class="fu">metric_set</span>(recall, precision, f_meas, j_index, accuracy, kap, roc_auc, sens, spec))</span>
<span id="cb26-407"><a href="#cb26-407"></a>}</span>
<span id="cb26-408"><a href="#cb26-408"></a><span class="in">```</span></span>
<span id="cb26-409"><a href="#cb26-409"></a></span>
<span id="cb26-410"><a href="#cb26-410"></a>Call the function to get performance metrics of different models</span>
<span id="cb26-411"><a href="#cb26-411"></a></span>
<span id="cb26-414"><a href="#cb26-414"></a><span class="in">```{r}</span></span>
<span id="cb26-415"><a href="#cb26-415"></a><span class="fu">set.seed</span>(<span class="dv">23784</span>)</span>
<span id="cb26-416"><a href="#cb26-416"></a>balclr_3c_SVM_radial_test_results <span class="ot">&lt;-</span> <span class="fu">getmymetrics</span>(balclr_3c_grid_results,</span>
<span id="cb26-417"><a href="#cb26-417"></a>                                                <span class="st">"balclr_3c_SVM_radial"</span>,</span>
<span id="cb26-418"><a href="#cb26-418"></a>                                                <span class="st">"roc_auc"</span>,</span>
<span id="cb26-419"><a href="#cb26-419"></a>                                                balclr_3c_split)</span>
<span id="cb26-420"><a href="#cb26-420"></a></span>
<span id="cb26-421"><a href="#cb26-421"></a>balclr_3c_SVM_poly_test_results <span class="ot">&lt;-</span> <span class="fu">getmymetrics</span>(balclr_3c_grid_results,</span>
<span id="cb26-422"><a href="#cb26-422"></a>                                                <span class="st">"balclr_3c_SVM_poly"</span>,</span>
<span id="cb26-423"><a href="#cb26-423"></a>                                                <span class="st">"roc_auc"</span>,</span>
<span id="cb26-424"><a href="#cb26-424"></a>                                                balclr_3c_split)</span>
<span id="cb26-425"><a href="#cb26-425"></a></span>
<span id="cb26-426"><a href="#cb26-426"></a>balclr_3c_CART_test_results <span class="ot">&lt;-</span> <span class="fu">getmymetrics</span>(balclr_3c_grid_results,</span>
<span id="cb26-427"><a href="#cb26-427"></a>                                                <span class="st">"balclr_3c_CART"</span>,</span>
<span id="cb26-428"><a href="#cb26-428"></a>                                                <span class="st">"roc_auc"</span>,</span>
<span id="cb26-429"><a href="#cb26-429"></a>                                                balclr_3c_split)</span>
<span id="cb26-430"><a href="#cb26-430"></a></span>
<span id="cb26-431"><a href="#cb26-431"></a>balclr_3c_CART_bagged_test_results <span class="ot">&lt;-</span> <span class="fu">getmymetrics</span>(balclr_3c_grid_results,</span>
<span id="cb26-432"><a href="#cb26-432"></a>                                                <span class="st">"balclr_3c_CART_bagged"</span>,</span>
<span id="cb26-433"><a href="#cb26-433"></a>                                                <span class="st">"roc_auc"</span>,</span>
<span id="cb26-434"><a href="#cb26-434"></a>                                                balclr_3c_split)</span>
<span id="cb26-435"><a href="#cb26-435"></a></span>
<span id="cb26-436"><a href="#cb26-436"></a>balclr_3c_NNET_test_results <span class="ot">&lt;-</span> <span class="fu">getmymetrics</span>(balclr_3c_grid_results,</span>
<span id="cb26-437"><a href="#cb26-437"></a>                                                <span class="st">"balclr_3c_NNET"</span>,</span>
<span id="cb26-438"><a href="#cb26-438"></a>                                                <span class="st">"roc_auc"</span>,</span>
<span id="cb26-439"><a href="#cb26-439"></a>                                                balclr_3c_split)</span>
<span id="cb26-440"><a href="#cb26-440"></a></span>
<span id="cb26-441"><a href="#cb26-441"></a>balclr_3c_boosting_test_results <span class="ot">&lt;-</span> <span class="fu">getmymetrics</span>(balclr_3c_grid_results,</span>
<span id="cb26-442"><a href="#cb26-442"></a>                                                <span class="st">"balclr_3c_boosting"</span>,</span>
<span id="cb26-443"><a href="#cb26-443"></a>                                                <span class="st">"roc_auc"</span>,</span>
<span id="cb26-444"><a href="#cb26-444"></a>                                                balclr_3c_split)</span>
<span id="cb26-445"><a href="#cb26-445"></a></span>
<span id="cb26-446"><a href="#cb26-446"></a>balclr_3c_fda_test_results <span class="ot">&lt;-</span> <span class="fu">getmymetrics</span>(balclr_3c_grid_results,</span>
<span id="cb26-447"><a href="#cb26-447"></a>                                          <span class="st">"balclr_3c_fda"</span>,</span>
<span id="cb26-448"><a href="#cb26-448"></a>                                          <span class="st">"roc_auc"</span>,</span>
<span id="cb26-449"><a href="#cb26-449"></a>                                          balclr_3c_split)</span>
<span id="cb26-450"><a href="#cb26-450"></a></span>
<span id="cb26-451"><a href="#cb26-451"></a>balclr_3c_rf_test_results <span class="ot">&lt;-</span> <span class="fu">getmymetrics</span>(balclr_3c_grid_results,</span>
<span id="cb26-452"><a href="#cb26-452"></a>                                          <span class="st">"balclr_3c_RF"</span>,</span>
<span id="cb26-453"><a href="#cb26-453"></a>                                          <span class="st">"roc_auc"</span>,</span>
<span id="cb26-454"><a href="#cb26-454"></a>                                          balclr_3c_split)</span>
<span id="cb26-455"><a href="#cb26-455"></a><span class="in">```</span></span>
<span id="cb26-456"><a href="#cb26-456"></a></span>
<span id="cb26-457"><a href="#cb26-457"></a>Defines a function to collect and format metrics of different models and calls the function on all the different trained models</span>
<span id="cb26-458"><a href="#cb26-458"></a></span>
<span id="cb26-461"><a href="#cb26-461"></a><span class="in">```{r}</span></span>
<span id="cb26-462"><a href="#cb26-462"></a>collect_format <span class="ot">&lt;-</span> <span class="cf">function</span>(res, name){</span>
<span id="cb26-463"><a href="#cb26-463"></a>  tune<span class="sc">::</span><span class="fu">collect_metrics</span>(res) <span class="sc">%&gt;%</span></span>
<span id="cb26-464"><a href="#cb26-464"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="at">metric =</span> .metric,</span>
<span id="cb26-465"><a href="#cb26-465"></a>                {{ name }} <span class="sc">:</span><span class="er">=</span> .estimate,</span>
<span id="cb26-466"><a href="#cb26-466"></a>                <span class="at">estimate_type =</span> .estimator)</span>
<span id="cb26-467"><a href="#cb26-467"></a>}</span>
<span id="cb26-468"><a href="#cb26-468"></a></span>
<span id="cb26-469"><a href="#cb26-469"></a><span class="fu">collect_format</span>(balclr_3c_SVM_radial_test_results, <span class="st">"SVM_rad"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb26-470"><a href="#cb26-470"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(<span class="fu">collect_format</span>(balclr_3c_SVM_poly_test_results, <span class="st">"SVM_poly"</span>), <span class="at">by =</span> <span class="fu">join_by</span>(metric, estimate_type)) <span class="sc">%&gt;%</span></span>
<span id="cb26-471"><a href="#cb26-471"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(<span class="fu">collect_format</span>(balclr_3c_CART_test_results, <span class="st">"CART"</span>), <span class="at">by =</span> <span class="fu">join_by</span>(metric, estimate_type)) <span class="sc">%&gt;%</span></span>
<span id="cb26-472"><a href="#cb26-472"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(<span class="fu">collect_format</span>(balclr_3c_CART_bagged_test_results, <span class="st">"CART_bag"</span>), <span class="at">by =</span> <span class="fu">join_by</span>(metric, estimate_type)) <span class="sc">%&gt;%</span></span>
<span id="cb26-473"><a href="#cb26-473"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(<span class="fu">collect_format</span>(balclr_3c_NNET_test_results, <span class="st">"NNET"</span>), <span class="at">by =</span> <span class="fu">join_by</span>(metric, estimate_type)) <span class="sc">%&gt;%</span></span>
<span id="cb26-474"><a href="#cb26-474"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(<span class="fu">collect_format</span>(balclr_3c_boosting_test_results, <span class="st">"boosting"</span>), <span class="at">by =</span> <span class="fu">join_by</span>(metric, estimate_type)) <span class="sc">%&gt;%</span></span>
<span id="cb26-475"><a href="#cb26-475"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(<span class="fu">collect_format</span>(balclr_3c_fda_test_results, <span class="st">"FDA"</span>), <span class="at">by =</span> <span class="fu">join_by</span>(metric, estimate_type)) <span class="sc">%&gt;%</span> </span>
<span id="cb26-476"><a href="#cb26-476"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(<span class="fu">collect_format</span>(balclr_3c_rf_test_results, <span class="st">"random_forest"</span>), <span class="at">by =</span> <span class="fu">join_by</span>(metric, estimate_type)) <span class="sc">%&gt;%</span> </span>
<span id="cb26-477"><a href="#cb26-477"></a>  dplyr<span class="sc">::</span><span class="fu">relocate</span>(estimate_type, metric)</span>
<span id="cb26-478"><a href="#cb26-478"></a><span class="in">```</span></span>
<span id="cb26-479"><a href="#cb26-479"></a></span>
<span id="cb26-480"><a href="#cb26-480"></a>Overall it looks like Gradient boosting is performing the best so we will go with that model</span>
<span id="cb26-481"><a href="#cb26-481"></a></span>
<span id="cb26-482"><a href="#cb26-482"></a><span class="fu">#### ROC-curve for chosen model</span></span>
<span id="cb26-483"><a href="#cb26-483"></a></span>
<span id="cb26-484"><a href="#cb26-484"></a><span class="co">[</span><span class="ot">This is a useful resource</span><span class="co">](https://www.nature.com/articles/nmeth.3945)</span> for understanding ROC curves and PR curves.</span>
<span id="cb26-485"><a href="#cb26-485"></a></span>
<span id="cb26-486"><a href="#cb26-486"></a>ROC curves here indicate that there is quite good performance for the gradient boosting model in distinguishing the evolutionary history of any particular microcosm from the experiment!</span>
<span id="cb26-487"><a href="#cb26-487"></a></span>
<span id="cb26-488"><a href="#cb26-488"></a>::: {#fig-02}</span>
<span id="cb26-491"><a href="#cb26-491"></a><span class="in">```{r}</span></span>
<span id="cb26-492"><a href="#cb26-492"></a>balclr_3c_boosting_test_results <span class="sc">%&gt;%</span> </span>
<span id="cb26-493"><a href="#cb26-493"></a>  tune<span class="sc">::</span><span class="fu">collect_predictions</span>() <span class="sc">%&gt;%</span></span>
<span id="cb26-494"><a href="#cb26-494"></a>  yardstick<span class="sc">::</span><span class="fu">roc_curve</span>(home_env_3c, .pred_anc<span class="sc">:</span>.pred_bact_strep) <span class="sc">%&gt;%</span> </span>
<span id="cb26-495"><a href="#cb26-495"></a>  tune<span class="sc">::</span><span class="fu">autoplot</span>() <span class="sc">+</span></span>
<span id="cb26-496"><a href="#cb26-496"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"FP rate"</span>, <span class="at">y =</span> <span class="st">"TP rate"</span>)</span>
<span id="cb26-497"><a href="#cb26-497"></a><span class="in">```</span></span>
<span id="cb26-498"><a href="#cb26-498"></a>ROC curve for True positive rate (TPR, vertical axis) versus the false positive rate (FPR, horizontal axis) for the three different evolutionary histories in the experiment from the hold-out testing data. The dashed 1:1 line is the expected performance of a random classifier. Curves above the 1:1 are better performance than random. Curves below 1:1 are worse performance than random.</span>
<span id="cb26-499"><a href="#cb26-499"></a>:::</span>
<span id="cb26-500"><a href="#cb26-500"></a></span>
<span id="cb26-501"><a href="#cb26-501"></a>::: {#fig-03}</span>
<span id="cb26-504"><a href="#cb26-504"></a><span class="in">```{r}</span></span>
<span id="cb26-505"><a href="#cb26-505"></a>balclr_3c_boosting_test_results <span class="sc">%&gt;%</span> </span>
<span id="cb26-506"><a href="#cb26-506"></a>  tune<span class="sc">::</span><span class="fu">collect_predictions</span>() <span class="sc">%&gt;%</span></span>
<span id="cb26-507"><a href="#cb26-507"></a>  yardstick<span class="sc">::</span><span class="fu">pr_curve</span>(home_env_3c, .pred_anc<span class="sc">:</span>.pred_bact_strep) <span class="sc">%&gt;%</span> </span>
<span id="cb26-508"><a href="#cb26-508"></a>  tune<span class="sc">::</span><span class="fu">autoplot</span>() <span class="sc">+</span></span>
<span id="cb26-509"><a href="#cb26-509"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Recall"</span>, <span class="at">y =</span> <span class="st">"Precision"</span>)</span>
<span id="cb26-510"><a href="#cb26-510"></a><span class="in">```</span></span>
<span id="cb26-511"><a href="#cb26-511"></a>Precision recall curves for the three different evolutionary histories in the experiment from the hold-out testing data. There is a good tuorial for interpretation of these plots on <span class="co">[</span><span class="ot">scikit-learn</span><span class="co">](https://scikit-learn.org/1.5/auto_examples/model_selection/plot_precision_recall.html)</span>. All of them suggest good performance.</span>
<span id="cb26-512"><a href="#cb26-512"></a>:::</span>
<span id="cb26-513"><a href="#cb26-513"></a></span>
<span id="cb26-514"><a href="#cb26-514"></a><span class="fu">#### Confusion matrix</span></span>
<span id="cb26-515"><a href="#cb26-515"></a></span>
<span id="cb26-516"><a href="#cb26-516"></a>The confusion matrix shows that the model is doing a very nice job predicting whether the community had an ancestral origin while there are only two mixups for the other two classes combined. Again this is quite good performance...</span>
<span id="cb26-517"><a href="#cb26-517"></a></span>
<span id="cb26-518"><a href="#cb26-518"></a>::: {#fig-04}</span>
<span id="cb26-521"><a href="#cb26-521"></a><span class="in">```{r}</span></span>
<span id="cb26-522"><a href="#cb26-522"></a>balclr_3c_boosting_test_results <span class="sc">%&gt;%</span> </span>
<span id="cb26-523"><a href="#cb26-523"></a>  tune<span class="sc">::</span><span class="fu">collect_predictions</span>() <span class="sc">%&gt;%</span></span>
<span id="cb26-524"><a href="#cb26-524"></a>  yardstick<span class="sc">::</span><span class="fu">conf_mat</span>(home_env_3c, .pred_class) <span class="sc">%&gt;%</span></span>
<span id="cb26-525"><a href="#cb26-525"></a>  tune<span class="sc">::</span><span class="fu">autoplot</span>(<span class="at">type =</span> <span class="st">"heatmap"</span>) </span>
<span id="cb26-526"><a href="#cb26-526"></a><span class="in">```</span></span>
<span id="cb26-527"><a href="#cb26-527"></a>Confusion matrix showing the classifier performance on each of the three evolutionary history classes using the hold-out testing data.</span>
<span id="cb26-528"><a href="#cb26-528"></a>:::</span>
<span id="cb26-529"><a href="#cb26-529"></a></span>
<span id="cb26-530"><a href="#cb26-530"></a><span class="fu">#### Probability distributions for the 3 classes</span></span>
<span id="cb26-531"><a href="#cb26-531"></a></span>
<span id="cb26-532"><a href="#cb26-532"></a>Gradient boosting trees give each prediction a probability for every class. The higher the probability the higher the confidence in the prediction. We can visualize the distribution of these prediction probabilities to get some insight as to which classes the model has trouble distinguishing and which are very clearly separated. </span>
<span id="cb26-533"><a href="#cb26-533"></a></span>
<span id="cb26-534"><a href="#cb26-534"></a>::: {#fig-05}</span>
<span id="cb26-537"><a href="#cb26-537"></a><span class="in">```{r}</span></span>
<span id="cb26-538"><a href="#cb26-538"></a>balclr_3c_boosting_test_results <span class="sc">%&gt;%</span></span>
<span id="cb26-539"><a href="#cb26-539"></a>  tune<span class="sc">::</span><span class="fu">collect_predictions</span>() <span class="sc">%&gt;%</span></span>
<span id="cb26-540"><a href="#cb26-540"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="fu">c</span>(</span>
<span id="cb26-541"><a href="#cb26-541"></a>    .pred_anc,</span>
<span id="cb26-542"><a href="#cb26-542"></a>    .pred_bact,</span>
<span id="cb26-543"><a href="#cb26-543"></a>    .pred_bact_strep</span>
<span id="cb26-544"><a href="#cb26-544"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="cb26-545"><a href="#cb26-545"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb26-546"><a href="#cb26-546"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">fill =</span> home_env_3c), <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb26-547"><a href="#cb26-547"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Prediction Probability"</span>, <span class="at">y =</span> <span class="st">"Density"</span>) <span class="sc">+</span></span>
<span id="cb26-548"><a href="#cb26-548"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_wrap</span>( <span class="sc">~</span> name)</span>
<span id="cb26-549"><a href="#cb26-549"></a><span class="in">```</span></span>
<span id="cb26-550"><a href="#cb26-550"></a>Prediction probability densities (colors) for each observation of the three evolutionary history classes (grid columns) tested with the model.</span>
<span id="cb26-551"><a href="#cb26-551"></a>:::</span>
<span id="cb26-552"><a href="#cb26-552"></a></span>
<span id="cb26-553"><a href="#cb26-553"></a><span class="fu"># Conclusion</span></span>
<span id="cb26-554"><a href="#cb26-554"></a></span>
<span id="cb26-555"><a href="#cb26-555"></a>Our Gradient Boosting model seems to be performing pretty well here... We can conclude that there is sufficient signal in the community composition data to distinguish the evolutionary history of the species used to inoculate the experiment.</span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>